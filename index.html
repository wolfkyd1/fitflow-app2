<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>FitFlow - Your Personal Workout Companion</title>
    <style> 
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        input, textarea, select {
            -webkit-user-select: text;
            user-select: text;
            font-size: 16px !important;
        }
        
        @media (max-width: 390px) {
            input, textarea, select {
                font-size: 16px !important;
            }
        }
        
        html {
            height: 100%;
            height: 100vh;
            height: 100dvh;
            height: -webkit-fill-available;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }
        
        body {
            height: 100%;
            height: 100vh;
            height: 100dvh;
            height: -webkit-fill-available;
            width: 100%;
            overflow: hidden;
            position: fixed;
            margin: 0;
            padding: 0;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            -webkit-overflow-scrolling: touch;
            touch-action: manipulation;
            color: #ffffff;
        }
        
        .app-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            background: #1a1a1a;
            max-width: 100%;
            margin: 0 auto;
            width: 100%;
            height: 100%;
            height: 100vh;
            height: 100dvh;
            height: -webkit-fill-available;
            overflow: hidden;
        }
        
        @media (min-width: 430px) {
            .app-container {
                max-width: 430px;
                box-shadow: 0 0 40px rgba(0,0,0,0.5);
            }
        }
        
        @media (min-width: 768px) {
            .app-container {
                max-width: 430px;
                margin: 20px auto;
                border-radius: 20px;
                height: calc(100% - 40px);
                position: relative;
                top: auto;
                box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            }
        }
        
        .header {
            background: #1a1a1a;
            color: white;
            padding: 0 20px 8px 20px;
            padding-top: calc(16px + env(safe-area-inset-top, 0px));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: fit-content;
            flex-shrink: 0;
        }
        
        @supports not (padding-top: env(safe-area-inset-top)) {
            .header {
                padding-top: 28px;
            }
        }
        
        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin: 0;
            margin-bottom: 4px;
            position: relative;
            z-index: 1;
            text-align: center;
            color: #ffffff;
        }
        
        .header p {
            opacity: 0.7;
            font-size: 14px;
            position: relative;
            z-index: 1;
            margin: 0;
            text-align: center;
            color: #ffffff;
        }
        
        .content {
            flex: 1 1 auto;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            position: relative;
            min-height: 0;
            background: #1a1a1a;
            padding-bottom: calc(84px + env(safe-area-inset-bottom, 16px));
        }
        
        /* Fixed Navigation - Flush at bottom of screen */
        .nav {
            background: #2a2a2a;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            padding: 8px;
            padding-bottom: max(env(safe-area-inset-bottom, 8px), 8px);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
            position: relative;
            z-index: 100;
            flex-shrink: 0;
        }

        /* Remove the mobile-specific overrides since nav is now full-width by default */
        @supports not (padding-bottom: env(safe-area-inset-bottom)) {
            .nav {
                min-height: 84px;
                padding-bottom: 16px;
            }
            .content {
                padding-bottom: 100px;
            }
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px 8px;
            background: none;
            border: none;
            font-size: 11px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
            border-radius: 12px;
            position: relative;
            font-weight: 500;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .nav-item:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            transform: scale(1.02);
        }

        .nav-item .icon {
            font-size: 20px;
            margin-bottom: 4px;
            display: block;
        }

        .nav.hidden {
            display: none !important;
        }

        /* Adjust content padding when nav is hidden */
        .content.nav-hidden {
            padding-bottom: calc(20px + env(safe-area-inset-bottom, 16px));
        }
        
        .card {
            background: #2a2a2a;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            position: relative;
            overflow: hidden;
            animation: slideUp 0.4s ease;
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .workout-title {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 12px;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .workout-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 16px;
        }
        
        /* Enhanced Button Styles */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            border: none;
            padding: 14px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            font-size: 15px;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* Play/Pause Button */
        .btn-play {
            background: linear-gradient(135deg, #667eea, #764ba2);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .btn-play::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }
        
        .btn-play:hover::before {
            left: 100%;
        }
        
        .btn-play:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5);
        }
        
        .btn-play:active {
            transform: scale(0.95);
        }
        
        /* Complete Exercise Button */
        .btn-complete-exercise {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: #ffffff;
            border: none;
            padding: 16px 24px;
            border-radius: 16px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            font-size: 16px;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
            position: relative;
            overflow: hidden;
            margin-bottom: 12px;
        }
        
        .btn-complete-exercise::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }
        
        .btn-complete-exercise:hover::before {
            left: 100%;
        }
        
        .btn-complete-exercise:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.5);
        }
        
        /* End Workout Button */
        .btn-end-workout {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #ffffff;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            position: relative;
            overflow: hidden;
            width: auto;
        }
        
        .btn-end-workout::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }
        
        .btn-end-workout:hover::before {
            left: 100%;
        }
        
        .btn-end-workout:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(239, 68, 68, 0.4);
        }
        
        /* Button Variants */
        .btn-view {
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        
        .btn-ai {
            background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
        }
        
        .btn-custom {
            background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        
        .btn-start {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-edit {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);
        }
        
        .btn-share {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(55, 65, 81, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .dashboard-stats {
            padding: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            color: white;
            padding: 24px 20px;
            border-radius: 16px;
            text-align: left;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 225px;
            height: 225px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.2) 20%, transparent 70%);
            border-radius: 50%;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
            position: relative;
            z-index: 1;
            color: #ffffff;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.7;
            position: relative;
            z-index: 1;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }
        
        /* Workout Active Screen */
        .workout-active {
            text-align: center;
            padding: 20px;
            background: #1a1a1a;
            position: relative;
            min-height: calc(100vh - 100px);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        /* ALIGN FIX: Workout Header Layout */
        .workout-header {
            position: absolute;
            top: calc(10px + env(safe-area-inset-top, 0px)); /* Reduced from 20px */
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 10;
            min-height: 36px; /* Reduced from 44px */
        }
        
        /* Rest Screen Specific Styles */
        .rest-active {
            text-align: center;
            padding: 8px; /* Reduced from 20px */
            background: #1a1a1a;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding-bottom: calc(100px + env(safe-area-inset-bottom, 16px));
        }
        
        .rest-active .back-button {
            position: absolute;
            top: calc(20px + env(safe-area-inset-top, 0px));
            left: 20px;
            z-index: 60;
        }
        
        /* Back Button */
        .back-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 12px; /* Reduced from 12px 16px */
            border-radius: 16px; /* Reduced from 20px */
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px; /* Reduced from 8px */
            font-weight: 600;
            font-size: 12px; /* Reduced from 14px */
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        /* ALIGN FIX: Exercise Name - Dynamic Font Sizing */
        .exercise-name-right {
            flex: 1;
            margin-left: 16px;
            font-size: clamp(14px, 4vw, 28px); /* Reduced max from 28px */
            font-weight: 700;
            color: #ffffff;
            text-align: right;
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
            line-height: 1.1; /* Reduced from 1.2 */
            display: flex;
            align-items: center;
            justify-content: flex-end;
            max-width: calc(100% - 160px);
        }

        /* Exercise Name positioned in the center */
        .exercise-name-center {
            position: absolute;
            top: calc(55px + env(safe-area-inset-top, 0px));
            left: 20px;
            right: 20px;
            font-size: 30px;
            font-weight: 700;
            color: #ffffff;
            text-align: center;
            line-height: 1.2;
            padding-bottom: 20px; /* Add bottom padding */
            z-index: 10; /* Ensure it stays on top */
        }
        
        @supports not (top: env(safe-area-inset-top)) {
            .workout-header {
                top: 40px;
            }
            .exercise-name-center {
                top: 80px;
            }
        }

        @media (max-height: 700px) {
            .workout-header {
                top: calc(10px + env(safe-area-inset-top, 0px));
            }
            .exercise-name-center {
                top: calc(50px + env(safe-area-inset-top, 0px));
            }
        }
        
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
        }
        
        .back-button .icon {
            font-size: 16px;
        }
        
        .workout-hero {
            position: relative;
            bottom: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 24px;
            padding: 40px 20px;
            margin-bottom: 24px;
            color: #ffffff;
            overflow: hidden;
        }
        
        .workout-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 40%, rgba(255,255,255,0.1) 0%, transparent 50%);
        }

        .btn-browse-workouts {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            border: none;
            padding: 14px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            font-size: 15px;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            bottom: 200px;
            overflow: hidden;            
        }
        
        .timer {
            font-size: 48px; /* Reduced from 56px */
            font-weight: 700;
            margin: 12px 0; /* Reduced from 20px 0 */
            position: relative;
            z-index: 1;
            color: #ffffff;
        }
        
        .exercise-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #ffffff;
        }
        
        /* Exercise Instructions */
        .exercise-instructions {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .exercise-instructions h4 {
            color: #667eea;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .exercise-instructions p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
            margin: 0;
        }
        
        .exercise-details {
            display: grid;
            gap: 12px;
            margin-bottom: 24px;
        }

        /* Default: 1-3 cards in a single row */
        .exercise-details {
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        }

        /* When there are exactly 4 cards: 3 on top, 1 full-width below */
        .exercise-details.four-cards {
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: auto auto;
        }

        .exercise-details.four-cards .detail-card:nth-child(4) {
            grid-column: 1 / -1; /* Spans all columns */
            grid-row: 2;
        }
        
        .detail-card {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .detail-card strong {
            font-size: 20px;
            color: #ffffff;
        }
        
        .set-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
        }
        
        .set-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .set-dot.completed {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.4);
        }
        
        .set-dot.current {
            background: linear-gradient(135deg, #667eea, #764ba2);
            animation: pulse 2s infinite;
            transform: scale(1.2);
        }
        
        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                box-shadow: 0 0 10px rgba(102, 126, 234, 0.4);
            }
            50% { 
                opacity: 0.5; 
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
            }
        }
        
        .control-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .btn-control {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            color: #ffffff;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(55, 65, 81, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn-control::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }
        
        .btn-control:hover::before {
            left: 100%;
        }
        
        .btn-control:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(55, 65, 81, 0.4);
        }
        
        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 4px;
            margin: 24px 0;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 2s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .hide { display: none; }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            border-radius: 24px;
            padding: 24px;
            width: calc(100% - 40px);
            max-width: 420px;
            max-height: 80vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            animation: slideUpModal 0.3s ease;
            margin: 20px;
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @keyframes slideUpModal {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-header h3 {
            font-size: 20px;
            color: #ffffff;
            font-weight: 700;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.6);
            transition: color 0.3s ease;
            padding: 4px;
        }
        
        .close-btn:hover {
            color: #ef4444;
        }
        
        /* CARD FIX: Rest Display with Fixed Height */
        .rest-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 24px;
            padding: clamp(16px, 4vw, 24px);
            margin: 20px 0;
            text-align: center;
            height: clamp(400px, 65vh, 550px);
            width: calc(100% - 16px); /* Now this will be much wider */
            max-width: none;
            margin-left: auto;
            margin-right: auto;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        /* Background pattern */
        .rest-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 40%, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .rest-display > * {
            position: relative;
            z-index: 1;
        }

        .rest-display h3 {
            font-size: clamp(18px, 4vw, 24px);
            margin-bottom: 0;
            padding-top: clamp(8px, 2vh, 16px);
            font-weight: 700;
            opacity: 0.95;
            /* Fixed space allocation */
            height: clamp(40px, 8vh, 60px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rest-timer {
            font-size: clamp(48px, 12vw, 72px);
            font-weight: 800;
            color: #ffffff;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            letter-spacing: -0.02em;
            /* Fixed space allocation */
            height: clamp(80px, 15vh, 120px);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
        }

        .next-exercise {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: clamp(12px, 3vw, 16px);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            /* Fixed space allocation - takes remaining space */
            flex: 1;
            min-height: clamp(80px, 12vh, 140px);
            max-height: clamp(120px, 20vh, 180px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            margin: clamp(8px, 2vh, 16px) 0;
        }

        /* Button container with fixed height */
        .rest-buttons {
            height: clamp(60px, 12vh, 80px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px;
            padding-bottom: clamp(8px, 2vh, 16px);
        }

        .rest-skip-btn {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            color: #667eea;
            border: none;
            padding: clamp(10px, 2vh, 14px) 24px;
            border-radius: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: clamp(12px, 2.5vw, 14px);
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rest-skip-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.15), transparent);
            transition: left 0.8s ease;
        }

        .rest-skip-btn:hover::before {
            left: 100%;
        }

        .rest-skip-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 30px rgba(255, 255, 255, 0.4);
        }

        /* Responsive breakpoints for different screen sizes */
        @media (max-height: 600px) {
            .rest-display {
                height: clamp(350px, 85vh, 450px);
            }
        }

        @media (max-height: 500px) {
            .rest-display {
                height: clamp(300px, 90vh, 400px);
            }
        }

        @media (min-height: 800px) {
            .rest-display {
                height: clamp(450px, 55vh, 600px);
            }
        }

        @media (max-width: 375px) {
            .rest-display {
                width: calc(100% - 20px);
                margin: 10px auto;
            }
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ffffff;
            font-size: 14px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Equipment Lists */
        .equipment-list {
            max-height: 150px;
            overflow-y: auto;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .equipment-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 4px 0;
        }
        
        .equipment-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            cursor: pointer;
        }
        
        .equipment-item label {
            cursor: pointer;
            font-size: 14px;
            color: #ffffff;
            flex: 1;
        }
        
        /* Exercise Items */
        .exercise-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 12px;
            position: relative;
            transition: all 0.3s ease;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        .exercise-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .exercise-item.drag-over {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        .drag-handle {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.4);
            cursor: grab;
            font-size: 18px;
            padding: 8px 4px;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .drag-handle:hover {
            color: #667eea;
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }
        
        .drag-handle::before {
            content: ':::';
            display: block;
            line-height: 0.8;
            letter-spacing: -2px;
        }
        
        .exercise-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 8px;
            margin-top: 12px;
        }
        
        @media (max-width: 390px) {
            .exercise-controls {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
                gap: 4px;
            }
        }
        
        .exercise-control-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 4px;
            font-weight: 600;
            text-align: center;
        }
        
        @media (max-width: 390px) {
            .exercise-control-label {
                font-size: 9px;
            }
        }
        
        /* Superset styles */
        .superset-partner {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            padding: 8px;
        }
        
        .superset-checkbox {
            width: 16px !important;
            height: 16px !important;
            margin: 0 4px 0 0 !important;
        }
        
        /* Responsive Design */
        @media (max-width: 414px) {
            .header { 
                padding-top: calc(20px + env(safe-area-inset-top, 0px)); 
            }
            .workout-header {
                top: calc(20px + env(safe-area-inset-top, 0px));
            }
            .rest-active .back-button {
                top: calc(20px + env(safe-area-inset-top, 0px));
            }
        }
        
        @media (max-width: 390px) {
            .header h1 { font-size: 28px; }
            .header p { font-size: 12px; }
            .header { padding-bottom: 12px; }
            .timer { font-size: 48px; }
            .rest-timer { font-size: 48px; }
            .exercise-name { font-size: 22px; }
            .stat-number { font-size: 28px; }
            .btn { padding: 12px 16px; font-size: 14px; }
            .nav-item { font-size: 10px; padding: 12px 4px; }
            .nav-item .icon { font-size: 18px; }
            .exercise-controls { grid-template-columns: 1fr 1fr; }
            .card { padding: 16px; margin-bottom: 12px; }
            .workout-info { font-size: 12px; }
            .modal-content { padding: 16px; }
            .form-input, .form-select { font-size: 16px !important; }
            .workout-header {
                top: calc(15px + env(safe-area-inset-top, 0px));
            }
            .back-button {
                font-size: 12px;
                padding: 10px 14px;
            }
            .exercise-name-right {
                font-size: clamp(14px, 3.5vw, 24px); /* ALIGN FIX: Smaller on small screens */
            }
            .rest-active .back-button {
                top: calc(40px + env(safe-area-inset-top, 0px));
            }
            .rest-display {
                height: 360px; /* CARD FIX: Smaller height for small screens */
            }
        }
        
        @media (max-width: 375px) {
            .stats-grid { gap: 12px; }
            .stat-card { padding: 16px; }
            .exercise-details { grid-template-columns: 1fr 1fr; }
        }
        
        @media (min-width: 428px) {
            .header { 
                padding-top: calc(20px + env(safe-area-inset-top, 0px)); 
            }
            .workout-header {
                top: calc(25px + env(safe-area-inset-top, 0px));
            }
        }
        
        @media (min-width: 768px) {
            .app-container {
                max-width: 430px;
                margin: 20px auto;
                border-radius: 20px;
                height: calc(100% - 40px);
                position: relative;
                top: auto;
                box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="content" id="content">
            <div class="header">
                <h1>Fitflow</h1>
            </div>
            <!-- Dynamic content will be loaded here -->
        </div>
        
        <div class="nav">
            <button class="nav-item active" onclick="showTab('home')" aria-label="Home tab">
                <span class="icon" aria-hidden="true">𖠿</span>
                Home
            </button>
            <button class="nav-item" onclick="showTab('workout')" aria-label="Workout tab">
                <span class="icon" aria-hidden="true">▶</span>
                Workout
            </button>
            <button class="nav-item" onclick="showTab('profile')" aria-label="Profile tab">
                <span class="icon" aria-hidden="true">☰</span>
                Profile
            </button>
        </div>
    </div>

    <script>
        // App state
        let currentTab = 'home';
        let workouts = [];
        let customWorkouts = [];
        let workoutHistory = [];
        let currentWorkout = null;
        let workoutInProgress = false;
        let currentExercise = 0;
        let currentSet = 1;
        let timer = 0;
        let isTimerRunning = false;
        let restTimer = 0;
        let isResting = false;
        let exerciseTimer = 0;
        let exerciseTimeLimit = 0;
        let wakeLock = null;
        let manualSkip = false;
        let userStats = {
            totalWorkouts: 0,
            totalTime: 0,
            streak: 0
        };
        let userWeights = {};
        let exerciseHistory = {};
        let progressiveOverload = {
            enabled: false,
            percentage: 5,
            weeks: 2
        };
        let userBody = {
            weight: 0,
            height: 0
        };

        // Fixed calorie and minute tracking - only from actual workouts
        let dailyCalories = 0;
        let dailyMinutes = 0;

        // Equipment and workout types
        const equipmentOptions = [
            'Bodyweight', 'Dumbbells', 'Barbell', 'Kettlebells', 'Resistance Bands',
            'Cable Machine', 'Smith Machine', 'Pull-up Bar', 'Yoga Mat', 'Medicine Ball',
            'Battle Ropes', 'TRX', 'Bench', 'Squat Rack', 'Leg Press Machine',
            'Treadmill', 'Stationary Bike', 'Elliptical', 'Rowing Machine', 'Stair Climber'
        ];

        const workoutTypes = [
            'Strength Training', 'HIIT', 'Cardio', 'Yoga', 'Pilates', 'CrossFit',
            'Powerlifting', 'Bodybuilding', 'Calisthenics', 'Functional Training',
            'Circuit Training', 'Endurance', 'Flexibility', 'Core'
        ];

        const muscleGroups = [
            'Full Body', 'Upper Body', 'Lower Body', 
            'Chest', 'Back', 'Shoulders', 'Arms', 'Biceps', 'Triceps',
            'Legs', 'Glutes', 'Quadriceps', 'Hamstrings', 'Calves', 
            'Core/Abs'
        ];

        // Comprehensive Equipment Exercise Database - Anatomically Accurate
        const equipmentExerciseDatabase = {
            'Bodyweight': {
                'Full Body': [
                    'Burpees', 'Mountain Climbers', 'Jumping Jacks', 'Bear Crawls', 
                    'Sprawls', 'Hindu Push-ups', 'Dive Bomber Push-ups', 'Star Jumps'
                ],
                'Upper Body': [
                    'Push-ups', 'Pike Push-ups', 'Decline Push-ups', 'Tricep Dips',
                    'Pull-ups', 'Chin-ups', 'Handstand Push-ups', 'Diamond Push-ups'
                ],
                'Lower Body': [
                    'Squats', 'Jump Squats', 'Lunges', 'Reverse Lunges', 'Lateral Lunges',
                    'Single Leg Squats', 'Bulgarian Split Squats', 'Step-ups', 'Wall Sits',
                    'Cossack Squats', 'Curtsy Lunges'
                ],
                'Chest': [
                    'Push-ups', 'Wide Push-ups', 'Diamond Push-ups', 'Decline Push-ups',
                    'Incline Push-ups', 'Archer Push-ups', 'Clap Push-ups', 'One-Arm Push-ups'
                ],
                'Back': [
                    'Pull-ups', 'Chin-ups', 'Wide-Grip Pull-ups', 'Superman', 
                    'Reverse Snow Angels', 'Inverted Rows', 'Good Mornings'
                ],
                'Shoulders': [
                    'Pike Push-ups', 'Handstand Push-ups', 'Arm Circles', 'Wall Handstand Hold',
                    'Shoulder Shrugs', 'Y-Raises', 'T-Raises'
                ],
                'Arms': [
                    'Tricep Dips', 'Diamond Push-ups', 'Close-Grip Push-ups', 'Pike Push-ups',
                    'Chin-ups', 'Tricep Push-ups'
                ],
                'Biceps': [
                    'Chin-ups', 'Commando Pull-ups', 'Isometric Bicep Hold'
                ],
                'Triceps': [
                    'Tricep Dips', 'Diamond Push-ups', 'Close-Grip Push-ups', 'Tricep Push-ups'
                ],
                'Legs': [
                    'Squats', 'Jump Squats', 'Lunges', 'Single Leg Deadlifts', 'Wall Sits',
                    'Calf Raises', 'Single Leg Calf Raises', 'Lateral Lunges'
                ],
                'Glutes': [
                    'Glute Bridges', 'Single Leg Glute Bridges', 'Hip Thrusts', 'Clamshells',
                    'Fire Hydrants', 'Donkey Kicks', 'Reverse Lunges'
                ],
                'Quadriceps': [
                    'Squats', 'Jump Squats', 'Lunges', 'Wall Sits', 'Single Leg Squats'
                ],
                'Hamstrings': [
                    'Single Leg Deadlifts', 'Good Mornings', 'Glute Bridges', 'Nordic Curls'
                ],
                'Calves': [
                    'Calf Raises', 'Single Leg Calf Raises', 'Jump Rope (imaginary)', 'Toe Walks'
                ],
                'Core/Abs': [
                    'Plank', 'Side Plank', 'Russian Twists', 'Bicycle Crunches', 'Leg Raises',
                    'Dead Bug', 'Bird Dog', 'Hollow Body Hold', 'V-Ups', 'Mountain Climbers',
                    'High Knees', 'Knee-to-Elbow Crunches'
                ]
            },

            'Dumbbells': {
                'Full Body': [
                    'Thrusters', 'Man Makers', 'Dumbbell Burpees', 'Dumbbell Turkish Get-ups',
                    'Dumbbell Squat to Press', 'Dumbbell Deadlift to Row'
                ],
                'Upper Body': [
                    'Dumbbell Bench Press', 'Dumbbell Rows', 'Overhead Press', 'Dumbbell Pullover',
                    'Chest Flyes', 'Reverse Flyes'
                ],
                'Chest': [
                    'Dumbbell Bench Press', 'Incline Dumbbell Press', 'Decline Dumbbell Press',
                    'Dumbbell Flyes', 'Incline Dumbbell Flyes', 'Dumbbell Pullover',
                    'Single-Arm Dumbbell Press', 'Chest Press'
                ],
                'Back': [
                    'Bent-over Dumbbell Rows', 'Single Arm Dumbbell Rows', 'Chest-Supported Row',
                    'Reverse Flyes', 'Dumbbell Deadlifts', 'Dumbbell Pullovers',
                    'Renegade Rows', 'Wide-Grip Rows'
                ],
                'Shoulders': [
                    'Dumbbell Shoulder Press', 'Lateral Raises', 'Front Raises', 'Arnold Press',
                    'Rear Delt Flyes', 'Upright Rows', 'Dumbbell Shrugs', 'Cuban Press',
                    'Pike Press', '6-Way Shoulder Raise'
                ],
                'Arms': [
                    'Bicep Curls', 'Hammer Curls', 'Tricep Extensions', 'Overhead Tricep Press',
                    'Concentration Curls', 'Tricep Kickbacks', 'Zottman Curls', '21s Bicep Curls'
                ],
                'Biceps': [
                    'Dumbbell Bicep Curls', 'Hammer Curls', 'Concentration Curls', 
                    'Incline Dumbbell Curls', 'Zottman Curls', '21s', 'Cross-Body Hammer Curls'
                ],
                'Triceps': [
                    'Overhead Tricep Extension', 'Tricep Kickbacks', 'Close-Grip Dumbbell Press',
                    'Lying Tricep Extension', 'Single-Arm Tricep Extension', 'Tate Press'
                ],
                'Legs': [
                    'Dumbbell Squats', 'Dumbbell Lunges', 'Romanian Deadlifts', 'Step-ups',
                    'Bulgarian Split Squats', 'Goblet Squats', 'Single Leg Deadlifts'
                ],
                'Glutes': [
                    'Dumbbell Hip Thrusts', 'Dumbbell Deadlifts', 'Single Leg Deadlifts',
                    'Dumbbell Step-ups', 'Reverse Lunges', 'Lateral Lunges'
                ],
                'Quadriceps': [
                    'Dumbbell Squats', 'Goblet Squats', 'Dumbbell Lunges', 'Step-ups',
                    'Bulgarian Split Squats', 'Wall Squats with Dumbbells'
                ],
                'Hamstrings': [
                    'Romanian Deadlifts', 'Single Leg Deadlifts', 'Dumbbell Stiff Leg Deadlifts',
                    'Reverse Lunges', 'Good Mornings with Dumbbells'
                ],
                'Calves': [
                    'Dumbbell Calf Raises', 'Single Leg Calf Raises', 'Seated Dumbbell Calf Raises'
                ],
                'Core/Abs': [
                    'Russian Twists with Dumbbell', 'Dumbbell Side Bends', 'Weighted Sit-ups',
                    'Dumbbell Wood Chops', 'Farmer Walks', 'Suitcase Carries', 'Weighted Plank'
                ]
            },

            'Barbell': {
                'Full Body': [
                    'Deadlifts', 'Clean and Press', 'Thrusters', 'Barbell Complexes',
                    'Clean and Jerk', 'Snatch', 'Front Squat to Press'
                ],
                'Upper Body': [
                    'Bench Press', 'Bent-over Barbell Rows', 'Overhead Press', 'Upright Rows'
                ],
                'Chest': [
                    'Barbell Bench Press', 'Incline Barbell Press', 'Decline Barbell Press',
                    'Close-Grip Bench Press', 'Floor Press', 'Guillotine Press'
                ],
                'Back': [
                    'Deadlifts', 'Bent-over Barbell Rows', 'T-Bar Rows', 'Pendlay Rows',
                    'Rack Pulls', 'Good Mornings', 'Barbell Shrugs'
                ],
                'Shoulders': [
                    'Overhead Press', 'Behind-the-Neck Press', 'Push Press', 'Bradford Press',
                    'Upright Rows', 'Barbell Shrugs', 'High Pulls'
                ],
                'Arms': [
                    'Barbell Curls', 'Close-Grip Bench Press', 'Barbell Skull Crushers',
                    'Reverse Barbell Curls', 'EZ-Bar Curls'
                ],
                'Biceps': [
                    'Barbell Curls', 'EZ-Bar Curls', 'Reverse Barbell Curls', 'Drag Curls',
                    'Wide-Grip Barbell Curls', '21s Barbell Curls'
                ],
                'Triceps': [
                    'Close-Grip Bench Press', 'Barbell Skull Crushers', 'Overhead Barbell Extension',
                    'JM Press', 'California Press'
                ],
                'Legs': [
                    'Back Squats', 'Front Squats', 'Deadlifts', 'Romanian Deadlifts',
                    'Barbell Lunges', 'Hip Thrusts', 'Sumo Deadlifts'
                ],
                'Glutes': [
                    'Hip Thrusts', 'Romanian Deadlifts', 'Sumo Deadlifts', 'Good Mornings',
                    'Back Squats', 'Bulgarian Split Squats'
                ],
                'Quadriceps': [
                    'Back Squats', 'Front Squats', 'Zercher Squats', 'Overhead Squats',
                    'Barbell Lunges', 'Split Squats'
                ],
                'Hamstrings': [
                    'Romanian Deadlifts', 'Stiff Leg Deadlifts', 'Good Mornings',
                    'Deficit Deadlifts'
                ],
                'Calves': [
                    'Barbell Calf Raises', 'Donkey Calf Raises'
                ],
                'Core/Abs': [
                    'Barbell Rollouts', 'Landmine Twists', 'Overhead Barbell Carries',
                    'Front-Loaded Carries', 'Zercher Carries'
                ]
            },

            'Kettlebells': {
                'Full Body': [
                    'Kettlebell Swings', 'Turkish Get-ups', 'Kettlebell Snatches',
                    'Kettlebell Clean and Press', 'Kettlebell Complexes', 'Kettlebell Flow'
                ],
                'Upper Body': [
                    'Kettlebell Press', 'Kettlebell Rows', 'Kettlebell High Pulls',
                    'Kettlebell Upright Rows'
                ],
                'Chest': [
                    'Kettlebell Floor Press', 'Single-Arm Kettlebell Press', 
                    'Kettlebell Chest Flyes', 'Kettlebell Push-ups'
                ],
                'Back': [
                    'Single-Arm Kettlebell Rows', 'Kettlebell Deadlifts', 'Kettlebell High Pulls',
                    'Kettlebell Renegade Rows', 'Kettlebell Swings'
                ],
                'Shoulders': [
                    'Kettlebell Press', 'Kettlebell Clean and Press', 'Kettlebell Halos',
                    'Kettlebell Upright Rows', 'Kettlebell High Pulls', 'Bottoms-up Press'
                ],
                'Arms': [
                    'Kettlebell Curls', 'Kettlebell Tricep Press', 'Kettlebell Hammer Curls',
                    'Bottoms-up Press'
                ],
                'Biceps': [
                    'Kettlebell Curls', 'Kettlebell Hammer Curls', 'Kettlebell Drag Curls'
                ],
                'Triceps': [
                    'Kettlebell Tricep Press', 'Kettlebell Floor Press', 'Kettlebell Skull Crushers'
                ],
                'Legs': [
                    'Goblet Squats', 'Kettlebell Deadlifts', 'Kettlebell Lunges',
                    'Single Leg Deadlifts', 'Kettlebell Swings', 'Cossack Squats'
                ],
                'Glutes': [
                    'Kettlebell Swings', 'Kettlebell Deadlifts', 'Single Leg Deadlifts',
                    'Kettlebell Hip Thrusts', 'Goblet Squats'
                ],
                'Quadriceps': [
                    'Goblet Squats', 'Kettlebell Front Squats', 'Kettlebell Lunges',
                    'Kettlebell Step-ups'
                ],
                'Hamstrings': [
                    'Kettlebell Swings', 'Kettlebell Deadlifts', 'Single Leg Deadlifts',
                    'Kettlebell Good Mornings'
                ],
                'Calves': [
                    'Kettlebell Calf Raises', 'Single Leg Kettlebell Calf Raises'
                ],
                'Core/Abs': [
                    'Russian Twists with Kettlebell', 'Kettlebell Windmills', 'Kettlebell Carries',
                    'Turkish Get-ups', 'Kettlebell Figure 8s', 'Kettlebell Wood Chops'
                ]
            },

            'Resistance Bands': {
                'Full Body': [
                    'Band Thrusters', 'Band Squat-to-Press', 'Band Mountain Climbers',
                    'Band Burpees'
                ],
                'Upper Body': [
                    'Band Chest Press', 'Band Rows', 'Band Shoulder Press', 'Band Pull-aparts'
                ],
                'Chest': [
                    'Band Chest Press', 'Band Flyes', 'Band Push-ups', 'Incline Band Press',
                    'Single-Arm Band Press', 'Band Crossover'
                ],
                'Back': [
                    'Band Rows', 'Band Pull-aparts', 'Band Lat Pulldowns', 'Band Face Pulls',
                    'Single-Arm Band Rows', 'Wide-Grip Band Rows'
                ],
                'Shoulders': [
                    'Band Shoulder Press', 'Band Lateral Raises', 'Band Front Raises',
                    'Band Rear Delt Flyes', 'Band External Rotations', 'Band Face Pulls'
                ],
                'Arms': [
                    'Band Bicep Curls', 'Band Tricep Extensions', 'Band Hammer Curls',
                    'Band Tricep Pushdowns'
                ],
                'Biceps': [
                    'Band Bicep Curls', 'Band Hammer Curls', 'Band Concentration Curls',
                    'Band 21s', 'Single-Arm Band Curls'
                ],
                'Triceps': [
                    'Band Tricep Extensions', 'Band Tricep Pushdowns', 'Band Overhead Extensions',
                    'Band Tricep Kickbacks'
                ],
                'Legs': [
                    'Band Squats', 'Band Deadlifts', 'Band Lunges', 'Band Leg Press',
                    'Band Step-ups', 'Band Clamshells'
                ],
                'Glutes': [
                    'Band Glute Bridges', 'Band Hip Thrusts', 'Band Clamshells',
                    'Band Monster Walks', 'Band Fire Hydrants', 'Band Kickbacks'
                ],
                'Quadriceps': [
                    'Band Squats', 'Band Leg Extensions', 'Band Lunges', 'Band Wall Squats'
                ],
                'Hamstrings': [
                    'Band Deadlifts', 'Band Leg Curls', 'Band Good Mornings',
                    'Single Leg Band Deadlifts'
                ],
                'Calves': [
                    'Band Calf Raises', 'Band Ankle Flexion', 'Band Toe Points'
                ],
                'Core/Abs': [
                    'Band Wood Chops', 'Band Pallof Press', 'Band Russian Twists',
                    'Band Dead Bug', 'Band Bicycle Crunches'
                ]
            },

            'Cable Machine': {
                'Full Body': [
                    'Cable Wood Chops', 'Cable Squat to Press', 'Cable Thrusters'
                ],
                'Upper Body': [
                    'Cable Chest Press', 'Cable Rows', 'Cable Lat Pulldowns', 'Cable Flyes'
                ],
                'Chest': [
                    'Cable Chest Press', 'Cable Flyes', 'Incline Cable Press',
                    'Cable Crossover', 'Single-Arm Cable Press', 'Cable Chest Squeeze'
                ],
                'Back': [
                    'Cable Rows', 'Lat Pulldowns', 'Cable Face Pulls', 'Cable Reverse Flyes',
                    'Single-Arm Cable Rows', 'Wide-Grip Pulldowns', 'Cable Pullovers'
                ],
                'Shoulders': [
                    'Cable Lateral Raises', 'Cable Front Raises', 'Cable Rear Delt Flyes',
                    'Cable Shoulder Press', 'Cable Upright Rows', 'Cable External Rotations'
                ],
                'Arms': [
                    'Cable Bicep Curls', 'Cable Tricep Pushdowns', 'Cable Hammer Curls',
                    'Cable Overhead Tricep Extension'
                ],
                'Biceps': [
                    'Cable Bicep Curls', 'Cable Hammer Curls', 'Cable Concentration Curls',
                    'Cable Preacher Curls', 'Cable 21s'
                ],
                'Triceps': [
                    'Cable Tricep Pushdowns', 'Cable Overhead Tricep Extension',
                    'Cable Tricep Kickbacks', 'Cable Diamond Press'
                ],
                'Legs': [
                    'Cable Squats', 'Cable Leg Press', 'Cable Lunges', 'Cable Step-ups'
                ],
                'Glutes': [
                    'Cable Kickbacks', 'Cable Hip Abduction', 'Cable Deadlifts',
                    'Cable Glute Bridges'
                ],
                'Quadriceps': [
                    'Cable Leg Extensions', 'Cable Squats', 'Cable Lunges'
                ],
                'Hamstrings': [
                    'Cable Leg Curls', 'Cable Romanian Deadlifts', 'Cable Good Mornings'
                ],
                'Calves': [
                    'Cable Calf Raises', 'Single Leg Cable Calf Raises'
                ],
                'Core/Abs': [
                    'Cable Wood Chops', 'Cable Crunches', 'Cable Russian Twists',
                    'Cable Pallof Press', 'Cable Knee Raises'
                ]
            },

            'Pull-up Bar': {
                'Upper Body': [
                    'Pull-ups', 'Chin-ups', 'Wide-Grip Pull-ups', 'Neutral Grip Pull-ups'
                ],
                'Back': [
                    'Pull-ups', 'Wide-Grip Pull-ups', 'Chin-ups', 'Commando Pull-ups',
                    'L-Sit Pull-ups', 'Archer Pull-ups'
                ],
                'Arms': [
                    'Chin-ups', 'Close-Grip Chin-ups', 'Commando Pull-ups'
                ],
                'Biceps': [
                    'Chin-ups', 'Close-Grip Chin-ups', 'Commando Pull-ups',
                    'Supinated Pull-ups'
                ],
                'Core/Abs': [
                    'Hanging Leg Raises', 'Hanging Knee Raises', 'L-Sits',
                    'Hanging Windshield Wipers', 'Toes to Bar', 'Hanging Oblique Crunches'
                ],
                'Shoulders': [
                    'Pull-ups', 'Wide-Grip Pull-ups', 'Archer Pull-ups'
                ]
            },

            'Medicine Ball': {
                'Full Body': [
                    'Medicine Ball Slams', 'Medicine Ball Burpees', 'Medicine Ball Thrusters',
                    'Medicine Ball Turkish Get-ups'
                ],
                'Upper Body': [
                    'Medicine Ball Chest Pass', 'Medicine Ball Overhead Press',
                    'Medicine Ball Push-ups'
                ],
                'Chest': [
                    'Medicine Ball Push-ups', 'Medicine Ball Chest Pass', 
                    'Medicine Ball Chest Throw', 'Explosive Medicine Ball Push-ups'
                ],
                'Shoulders': [
                    'Medicine Ball Overhead Throws', 'Medicine Ball Shoulder Press',
                    'Medicine Ball Circles', 'Medicine Ball Slams'
                ],
                'Arms': [
                    'Medicine Ball Bicep Curls', 'Medicine Ball Tricep Extension'
                ],
                'Legs': [
                    'Medicine Ball Squats', 'Medicine Ball Lunges', 'Medicine Ball Wall Squats'
                ],
                'Core/Abs': [
                    'Medicine Ball Russian Twists', 'Medicine Ball Sit-ups', 
                    'Medicine Ball V-ups', 'Medicine Ball Wood Chops', 'Medicine Ball Crunches',
                    'Medicine Ball Dead Bug'
                ],
                'Glutes': [
                    'Medicine Ball Hip Thrusts', 'Medicine Ball Deadlifts', 'Medicine Ball Squats'
                ]
            },

            'Battle Ropes': {
                'Full Body': [
                    'Alternating Waves', 'Double Arm Waves', 'Battle Rope Slams',
                    'Battle Rope Spirals', 'Battle Rope Burpees'
                ],
                'Upper Body': [
                    'Alternating Waves', 'Double Arm Waves', 'Battle Rope Spirals'
                ],
                'Arms': [
                    'Alternating Waves', 'Double Arm Waves', 'Side-to-Side Waves',
                    'In-Out Waves'
                ],
                'Shoulders': [
                    'Battle Rope Circles', 'Overhead Slams', 'Lateral Waves',
                    'Shoulder Spirals'
                ],
                'Core/Abs': [
                    'Battle Rope Spirals', 'Seated Battle Ropes', 'Russian Twist Waves',
                    'Plank Battle Ropes'
                ],
                'Cardio': [
                    'Alternating Waves Sprint Intervals', 'Double Wave Intervals',
                    'Battle Rope Tabata'
                ]
            },

            'TRX': {
                'Full Body': [
                    'TRX Burpees', 'TRX Atomic Push-ups', 'TRX Mountain Climbers',
                    'TRX Jump Squats'
                ],
                'Upper Body': [
                    'TRX Rows', 'TRX Push-ups', 'TRX Chest Press', 'TRX Y-Pulls'
                ],
                'Chest': [
                    'TRX Push-ups', 'TRX Chest Press', 'TRX Chest Flye',
                    'Incline TRX Push-ups', 'Single-Arm TRX Press'
                ],
                'Back': [
                    'TRX Rows', 'TRX Y-Pulls', 'TRX T-Pulls', 'TRX Face Pulls',
                    'Single-Arm TRX Rows'
                ],
                'Shoulders': [
                    'TRX Y-Pulls', 'TRX T-Pulls', 'TRX Pike Push-ups',
                    'TRX Rear Delt Flye'
                ],
                'Arms': [
                    'TRX Bicep Curls', 'TRX Tricep Press', 'TRX Face Pulls'
                ],
                'Biceps': [
                    'TRX Bicep Curls', 'TRX Face Pulls'
                ],
                'Triceps': [
                    'TRX Tricep Press', 'TRX Push-ups'
                ],
                'Legs': [
                    'TRX Squats', 'TRX Lunges', 'TRX Single Leg Squats',
                    'TRX Jump Squats', 'TRX Hamstring Curls'
                ],
                'Glutes': [
                    'TRX Hip Press', 'TRX Single Leg Glute Bridge',
                    'TRX Hamstring Curls', 'TRX Side Lunge'
                ],
                'Quadriceps': [
                    'TRX Squats', 'TRX Lunges', 'TRX Single Leg Squats', 'TRX Jump Squats'
                ],
                'Hamstrings': [
                    'TRX Hamstring Curls', 'TRX Single Leg Deadlift'
                ],
                'Core/Abs': [
                    'TRX Pikes', 'TRX Mountain Climbers', 'TRX Knee Tucks',
                    'TRX Oblique Crunches', 'TRX Plank', 'TRX Side Plank'
                ]
            }
        };

        // Comprehensive Exercise Instructions Database - Detailed Step-by-Step Instructions
        const exerciseInstructions = {
            // === BODYWEIGHT EXERCISES ===
            
            // Full Body
            'Burpees': 'Stand with feet shoulder-width apart. Squat down and place palms flat on floor directly in front of feet. Jump feet straight back into plank position, keeping body in straight line. Perform one push-up (optional for beginners). Jump feet back to squat position. Explosively jump straight up with arms reaching overhead. Land softly with bent knees and immediately begin next rep. Keep core tight throughout entire movement.',            
            'Mountain Climbers': 'Start in plank position with hands directly under shoulders, arms straight. Body should form straight line from head to heels. Lift right foot and bring right knee toward chest, then quickly return to start. Immediately bring left knee toward chest. Continue alternating legs in rapid succession like you\'re running in place. Keep hips level - don\'t let them pike up or sag down. Maintain steady breathing throughout.',           
            'Jumping Jacks': 'Stand tall with feet together and arms at sides. Jump feet apart to shoulder-width while simultaneously raising arms out to sides and overhead until hands nearly touch. Immediately jump feet back together while lowering arms to sides. Land softly on balls of feet with slight knee bend. Maintain steady rhythm and controlled movements throughout.',            
            'Bear Crawls': 'Start on hands and knees with hands directly under shoulders, knees under hips. Lift knees 2-3 inches off ground, balancing on hands and toes. Move forward by stepping opposite hand and foot together (right hand with left foot). Take small steps, keeping knees low and close to ground. Keep back flat, core engaged, and head neutral. Move slowly and controlled.',
            'Sprawls': 'Stand with feet hip-width apart. Squat down and place hands on floor shoulder-width apart. Jump feet straight back into plank position. Immediately jump feet back toward hands into squat position. Stand up to complete the movement. Unlike burpees, no push-up or jump is performed. Focus on smooth, quick transitions between positions.',
            'Hindu Push-ups': 'Start in downward dog position (inverted V) with hands shoulder-width apart, hips high. Dive forward in swooping motion, lowering chest toward ground while moving forward. Push through hands to lift chest up into upward dog position (chest up, hips low, arms straight). Reverse the movement by pushing hips back up to starting downward dog position. Keep the movement fluid and controlled.',
            'Dive Bomber Push-ups': 'Begin in downward dog position with hands slightly wider than shoulders. Dive forward by lowering head and chest toward ground in swooping motion, keeping arms close to body. Continue swooping motion until reaching upward dog position (chest up, hips low). Return to start by reversing the exact same path back to downward dog. Imagine diving under a low barrier then back out.',
            'Star Jumps': 'Stand with feet together, arms at sides. Jump explosively while spreading feet wide and raising arms out to form star shape with body. Arms should be straight out to sides at shoulder height, legs spread wide. Land with feet together and arms at sides. Focus on full extension of limbs and controlled landing with bent knees.',
            
            // Upper Body
            'Push-ups': 'Start in plank position with hands slightly wider than shoulders, fingers spread. Body should form straight line from head to heels. Lower body by bending elbows until chest is within 2 inches of floor. Keep elbows at 45-degree angle to body, not flared wide. Push through palms to return to start position. Keep core tight and don\'t let hips sag or pike up.',
            'Pike Push-ups': 'Start in downward dog position with hands shoulder-width apart, walk feet closer to hands to create steep inverted V. Keep legs as straight as possible. Lower head toward floor by bending elbows, keeping them close to head. Press back up to start position. This targets shoulders more than regular push-ups. Beginners can elevate feet on step or bench.',
            'Decline Push-ups': 'Place feet on elevated surface (bench, step, or chair) with hands on ground in push-up position. Hands should be slightly wider than shoulders. Lower chest toward ground until just above floor level. Push back up to start position. The higher the feet, the more difficult the exercise becomes. This variation emphasizes upper chest and shoulders.',
            'Tricep Dips': 'Sit on edge of sturdy chair or bench with hands gripping edge beside hips, fingers pointing forward. Slide hips off edge with legs extended in front (bent knees for easier version). Lower body by bending elbows to 90 degrees, keeping back close to chair. Push through palms to lift back up. Keep shoulders down and elbows pointing back, not out to sides.',
            'Pull-ups': 'Hang from pull-up bar with overhand grip, hands shoulder-width apart. Start from dead hang with arms fully extended. Pull body up by driving elbows down and back until chin clears bar. Control the descent back to full arm extension. Keep shoulders back and chest up. Avoid swinging or using momentum. Engage core throughout movement.',
            'Chin-ups': 'Hang from bar with underhand grip (palms facing you), hands shoulder-width apart. From dead hang position, pull body up until chin clears bar. Focus on pulling elbows down and back while squeezing shoulder blades together. Lower with control to full arm extension. Chin-ups typically allow for more reps than pull-ups due to increased bicep involvement.',
            'Handstand Push-ups': 'Kick up into handstand against wall with hands shoulder-width apart, about 6 inches from wall. Keep body straight and tight. Lower head toward floor by bending elbows until head lightly touches ground. Press back up to full arm extension. This is an advanced exercise requiring significant shoulder and core strength. Start with pike push-ups to build strength.',
            'Diamond Push-ups': 'Start in push-up position but place hands close together under chest, forming diamond shape with thumbs and index fingers touching. Keep body in straight line. Lower chest toward hands until touching diamond. Push back up to start position. Keep elbows close to body throughout movement. This variation heavily targets triceps.',

            // Lower Body
            'Squats': 'Stand with feet shoulder-width apart, toes slightly turned out. Keep chest up and core engaged. Push hips back and bend knees as if sitting back into chair. Lower until thighs are parallel to floor or as low as comfortable. Keep weight on heels and full foot. Drive through heels to stand back up, pushing hips forward at top. Knees should track over toes, not cave inward.',
            'Jump Squats': 'Perform regular squat by sitting back until thighs are parallel to floor. Explosively drive through heels and jump straight up as high as possible. Swing arms up to add momentum. Land softly with bent knees immediately going into next squat. Focus on soft landing and quick transition between reps. Keep chest up throughout movement.',
            'Lunges': 'Stand tall with feet hip-width apart. Take large step forward with right foot (about 2-3 feet). Lower body until both knees are bent at 90 degrees - front thigh parallel to floor, back knee hovering just above ground. Keep front knee over ankle, not pushed forward over toes. Push through front heel to return to standing. Complete all reps on one side before switching legs.',
            'Reverse Lunges': 'Stand with feet hip-width apart. Step backward with right foot about 2-3 feet. Lower body until both knees are at 90 degrees - left thigh parallel to floor, right knee hovering above ground. Keep torso upright and core engaged. Push through left heel to return to standing. This variation is often easier on knees than forward lunges.',
            'Lateral Lunges': 'Stand with feet hip-width apart. Take large step to right side (about 3 feet). Shift weight to right leg and sit back into right hip while keeping left leg straight. Lower until right thigh is parallel to floor. Keep chest up and both feet flat on ground. Push through right heel to return to center. Complete all reps on one side before switching.',
            'Single Leg Squats': 'Stand on right leg with left leg extended straight in front of you. Extend arms forward for balance. Slowly squat down on right leg as low as possible while keeping left leg off ground. Keep chest up and core engaged. Push through right heel to return to standing. This is very challenging - use chair or TRX for assistance when learning.',
            'Bulgarian Split Squats': 'Stand 2-3 feet in front of bench or chair. Place top of left foot on bench behind you. Lower body until right thigh is parallel to floor and left knee nearly touches ground. Keep most weight on front leg. Push through right heel to return to start. Keep torso upright throughout movement. Complete all reps before switching legs.',
            'Step-ups': 'Stand facing sturdy bench or step that brings thigh parallel to floor when foot is placed on it. Step up with right foot, placing entire foot on surface. Drive through right heel to step up, bringing left foot to meet right. Step down with control, leading with left foot then right. Keep chest up and core engaged. Complete all reps on one side before switching.',
            'Wall Sits': 'Stand with back against wall, feet shoulder-width apart and about 2 feet from wall. Slide down wall until thighs are parallel to floor and knees are at 90 degrees. Keep back flat against wall and weight evenly distributed on both feet. Hold this position while maintaining normal breathing. Keep knees aligned over ankles, not pushed forward.',
            'Cossack Squats': 'Stand with feet wide (about 1.5 times shoulder width), toes pointing slightly out. Shift weight to right side and squat down on right leg while keeping left leg straight. Lower until right thigh is parallel to floor. Keep both feet flat and chest up. Push through right heel to return to center. Alternate sides or complete all reps on one side first.',
            'Curtsy Lunges': 'Stand with feet hip-width apart. Step left foot behind and across right leg as if curtsying. Lower body until right thigh is parallel to floor and left knee nearly touches ground. Keep most weight on front leg and torso upright. Push through right heel to return to standing. This targets glutes from different angle than regular lunges.',

            // Chest
            'Wide Push-ups': 'Perform push-up with hands placed wider than shoulders (about 1.5 times shoulder width). Lower chest toward ground until just above floor. Push back up to start position. Wider hand position emphasizes outer portion of chest muscles. Keep core tight and body in straight line throughout movement.',
            'Incline Push-ups': 'Place hands on elevated surface (bench, step, or wall) with body at downward angle. Higher the surface, easier the exercise. Keep body in straight line from head to heels. Lower chest toward surface until lightly touching. Push back to start position. This variation is easier than regular push-ups and targets lower chest.',
            'Archer Push-ups': 'Start in wide push-up position with hands wider than shoulders. Lower body toward right hand while straightening left arm out to side. Push back to center position. Repeat on left side. This unilateral movement builds single-arm strength and targets chest asymmetrically. Very challenging exercise requiring significant strength.',
            'Clap Push-ups': 'Start in regular push-up position. Lower chest toward ground then explosively push up with enough force to lift hands off ground. Quickly clap hands together before landing back in push-up position. Land with soft arms to absorb impact. This plyometric exercise builds explosive power. Ensure adequate strength before attempting.',
            'One-Arm Push-ups': 'Start in push-up position with feet wider than shoulders for stability. Place one hand behind back. Lower chest toward ground using only working arm. Push back up to start position. This extremely advanced exercise requires exceptional strength and stability. Work up to this with assisted versions using TRX or elevated surface.',

            // Back
            'Wide-Grip Pull-ups': 'Hang from bar with overhand grip, hands wider than shoulders (about 1.5 times shoulder width). Pull body up until chin clears bar, focusing on squeezing shoulder blades together. Lower with control to full arm extension. Wider grip emphasizes latissimus dorsi (wing muscles) more than biceps.',
            'Superman': 'Lie face down with arms extended overhead and legs straight. Simultaneously lift chest, arms, and legs off ground as high as comfortably possible. Squeeze shoulder blades together and glutes. Hold for 2-3 seconds then lower with control. Keep neck neutral - don\'t crane head up. Focus on squeezing back muscles.',
            'Reverse Snow Angels': 'Lie face down with arms at sides. Lift chest slightly off ground and move arms in large arc from hips to overhead position while keeping them straight. Reverse the movement back to sides. Focus on squeezing shoulder blades together throughout movement. Keep legs on ground and core engaged.',
            'Inverted Rows': 'Lie under bar or table that\'s about waist height. Grab bar with overhand grip, hands shoulder-width apart. Keep body straight from head to heels. Pull chest toward bar by driving elbows back and squeezing shoulder blades. Lower with control to full arm extension. Adjust difficulty by changing body angle.',
            'Good Mornings': 'Stand with feet hip-width apart, hands behind head with elbows wide. Keep slight bend in knees. Hinge at hips by pushing them back while lowering torso until parallel to floor. Keep back straight and chest up throughout movement. Drive hips forward to return to standing. Focus on feeling stretch in hamstrings.',

            // Shoulders
            'Arm Circles': 'Stand with feet shoulder-width apart, extend arms straight out to sides at shoulder height. Make small forward circles with arms, gradually increasing circle size. Perform for specified time then reverse direction. Keep shoulders down and back, core engaged. This serves as both exercise and warm-up for shoulders.',
            'Wall Handstand Hold': 'Place hands on floor about 6 inches from wall, shoulder-width apart. Kick legs up to rest heels against wall in handstand position. Keep body straight and tight, pressing through hands. Hold position while breathing normally. Keep shoulders directly over hands. Build up hold time gradually. Excellent for building shoulder stability.',
            'Shoulder Shrugs': 'Stand tall with arms at sides. Lift shoulders straight up toward ears as high as possible. Hold briefly then slowly lower shoulders back down. Keep arms straight and don\'t roll shoulders forward or backward. Focus on squeezing upper trap muscles. Can be performed with or without weight.',
            'Y-Raises': 'Lie face down with arms extended overhead in Y position (45 degrees from body). Lift arms and chest off ground while squeezing shoulder blades together. Hold briefly then lower with control. Keep thumbs pointing up throughout movement. This targets rear deltoids and rhomboids for better posture.',
            'T-Raises': 'Lie face down with arms extended straight out to sides forming T shape with body. Lift arms and chest off ground while squeezing shoulder blades together. Keep arms straight and parallel to floor. Hold briefly then lower with control. Focus on squeezing muscles between shoulder blades.',

            // Arms/Biceps/Triceps
            'Close-Grip Push-ups': 'Start in push-up position with hands close together under chest (6 inches apart or less). Keep elbows close to body throughout movement. Lower chest toward hands until lightly touching. Push back up to start position. This variation heavily emphasizes triceps over chest muscles.',
            'Tricep Push-ups': 'Perform push-up with hands in normal position but focus on keeping elbows very close to sides throughout movement. Lower body until chest nearly touches ground. Push back up while maintaining elbow position. This form emphasizes triceps engagement over chest.',
            'Commando Pull-ups': 'Hang from bar with hands closer than shoulder-width. Alternate pulling body up so chin goes to one side of bar, then lower and pull up to other side. This targets biceps and back muscles differently than regular pull-ups while adding core challenge from the lateral movement.',
            'Isometric Bicep Hold': 'Hang from pull-up bar and pull body up until elbows are bent at 90 degrees. Hold this position as long as possible while maintaining normal breathing. This builds bicep strength in mid-range position. Keep shoulders back and core engaged throughout hold.',

            // Legs/Glutes/Hamstrings/Calves
            'Single Leg Deadlifts': 'Stand on right leg with slight knee bend. Hinge at hip by pushing right hip back while lifting left leg straight behind you. Lower torso toward ground while keeping back straight. Feel stretch in right hamstring. Drive right hip forward to return to standing. Focus on balance and controlled movement.',
            'Glute Bridges': 'Lie on back with knees bent, feet flat on floor hip-width apart. Squeeze glutes and push hips up toward ceiling until body forms straight line from knees to shoulders. Hold briefly at top then lower with control. Keep core tight and avoid arching back. Focus on squeezing glutes at top position.',
            'Single Leg Glute Bridges': 'Lie on back with left knee bent, left foot flat on floor. Extend right leg straight up or out. Push left hip up while squeezing left glute until body forms straight line. Hold briefly then lower with control. Keep hips level throughout movement. Complete all reps before switching legs.',
            'Hip Thrusts': 'Sit with upper back against bench or couch, knees bent, feet flat on floor. Drive hips up by squeezing glutes until thighs are parallel to floor. Hold briefly at top then lower with control. Keep core tight and chin tucked. This provides greater range of motion than glute bridges.',
            'Clamshells': 'Lie on right side with knees bent at 90 degrees, feet together. Keep feet touching while lifting left knee as high as possible. Focus on squeezing left glute to create the movement. Lower with control. Keep hips stacked and core engaged. This targets gluteus medius for hip stability.',
            'Fire Hydrants': 'Start on hands and knees with wrists under shoulders, knees under hips. Keeping knee bent at 90 degrees, lift right leg out to side until thigh is parallel to floor. Focus on squeezing right glute to create movement. Lower with control. Keep hips level and core engaged throughout.',
            'Donkey Kicks': 'Start on hands and knees with wrists under shoulders, knees under hips. Keeping right knee bent at 90 degrees, kick right heel up toward ceiling. Squeeze glute at top of movement. Lower with control without touching knee to ground. Keep hips level and core tight throughout movement.',
            'Nordic Curls': 'Kneel with someone holding your ankles or feet anchored under heavy object. Keep body straight from knees to head. Slowly lower body forward using hamstrings to control descent. Go as far as possible then catch yourself with hands. This is extremely advanced - most people need assistance or resistance band.',
            'Calf Raises': 'Stand with feet hip-width apart. Rise up onto toes by lifting heels as high as possible. Hold briefly at top then slowly lower heels below starting position if on step. Focus on squeezing calf muscles at top. Keep body straight and avoid bouncing. Can be performed on flat ground or edge of step.',
            'Single Leg Calf Raises': 'Stand on right foot with left foot lifted off ground. Rise up onto right toes as high as possible. Hold briefly then lower with control. Use wall or rail for balance if needed. This increases difficulty and addresses any strength imbalances between legs.',
            'Toe Walks': 'Rise up onto toes and walk forward maintaining heel elevation. Take small steps and focus on staying high on toes throughout. Keep body upright and core engaged. This builds calf endurance and ankle stability. Distance or time can be varied based on fitness level.',

            // Core/Abs
            'Plank': 'Start in push-up position but support weight on forearms instead of hands. Keep body in straight line from head to heels. Engage core by pulling belly button toward spine. Hold position while breathing normally. Don\'t let hips sag down or pike up. Keep shoulders directly over elbows.',
            'Side Plank': 'Lie on right side with forearm on ground, elbow under shoulder. Stack feet and legs on top of each other. Lift hips up to create straight line from head to feet. Hold position while breathing normally. Keep top arm on hip or reach toward ceiling. Keep core tight and don\'t let hips sag.',
            'Russian Twists': 'Sit with knees bent, feet flat on floor. Lean back slightly while keeping back straight. Lift feet off ground for added difficulty. Rotate torso to right, touching ground beside right hip. Rotate to left side, touching ground beside left hip. Keep chest up and core engaged throughout movement.',
            'Bicycle Crunches': 'Lie on back with hands behind head, knees bent at 90 degrees. Bring right elbow toward left knee while extending right leg straight. Switch sides, bringing left elbow toward right knee while extending left leg. Continue alternating in cycling motion. Keep lower back pressed to floor.',
            'Leg Raises': 'Lie on back with hands at sides or under lower back for support. Keep legs straight and together. Lift legs up until feet are directly over hips. Slowly lower legs until heels are just above ground (don\'t touch). Raise legs back up. Keep lower back pressed to floor throughout movement.',
            'Dead Bug': 'Lie on back with arms extended toward ceiling, knees bent at 90 degrees. Slowly lower right arm overhead while extending left leg straight. Return to start position. Switch sides. Keep lower back pressed to floor throughout movement. Move slowly and focus on core stability.',
            'Bird Dog': 'Start on hands and knees with wrists under shoulders, knees under hips. Extend right arm forward while extending left leg back. Keep hips level and spine neutral. Hold briefly then return to start. Switch sides. Focus on balance and core stability rather than how high you can lift limbs.',
            'Hollow Body Hold': 'Lie on back with arms extended overhead. Press lower back into floor by engaging core. Lift shoulders and legs off ground, creating hollow shape with body. Hold position while breathing normally. Keep lower back pressed down and avoid arching. Start with knees bent if too difficult.',
            'V-Ups': 'Lie on back with arms extended overhead and legs straight. Simultaneously lift torso and legs up, reaching hands toward feet to form V shape with body. Lower back down with control. Keep core engaged throughout movement. Bend knees if needed to maintain proper form.',
            'High Knees': 'Stand tall and run in place, bringing knees up toward chest as high as possible. Pump arms naturally as if running. Land on balls of feet and maintain quick cadence. Keep chest up and core engaged. Focus on high knee lift rather than speed.',
            'Knee-to-Elbow Crunches': 'Lie on back with hands behind head. Bring right knee toward chest while lifting shoulders off ground and bringing left elbow toward right knee. Lower back down with control. Switch sides. Keep core engaged and avoid pulling on neck with hands.',

            // === DUMBBELL EXERCISES ===
            
            // Full Body
            'Thrusters': 'Hold dumbbells at shoulder level with palms facing forward. Stand with feet shoulder-width apart. Squat down until thighs are parallel to floor, keeping dumbbells at shoulders. Drive through heels to stand while simultaneously pressing dumbbells overhead. Lower dumbbells back to shoulders and immediately begin next rep. This combines front squat with overhead press.',
            'Man Makers': 'Start standing with dumbbells in hands. Squat down and place dumbbells on floor. Jump feet back to plank position with hands on dumbbells. Perform push-up. Row right dumbbell to ribs, lower. Row left dumbbell to ribs, lower. Jump feet back to squat position. Stand and perform thruster by pressing dumbbells overhead. This is very challenging full-body exercise.',
            'Dumbbell Burpees': 'Hold light dumbbells in hands throughout entire burpee movement. Squat down with dumbbells, jump back to plank, perform push-up while gripping dumbbells, jump feet back to squat, then jump up with dumbbells overhead. Adds resistance to traditional burpee. Use lighter weight to maintain proper form.',
            'Dumbbell Turkish Get-ups': 'Lie on back holding dumbbell in right hand, arm extended toward ceiling. Bend right knee, place right foot flat on floor. Roll onto left elbow, then left hand. Lift hips and slide left leg back into lunge position. Stand up while keeping dumbbell overhead. Reverse movement to return to lying position. Very complex movement requiring practice.',
            'Dumbbell Squat to Press': 'Hold dumbbells at shoulder level. Perform squat by sitting back until thighs are parallel to floor. Drive through heels to stand while simultaneously pressing dumbbells overhead. Lower dumbbells back to shoulders. This combines lower and upper body training in one efficient movement.',
            'Dumbbell Deadlift to Row': 'Hold dumbbells in front of thighs with overhand grip. Hinge at hips to lower dumbbells toward floor while keeping back straight. Drive hips forward to return to standing. At top, hinge forward slightly and row dumbbells to ribs. Lower dumbbells and repeat. Combines posterior chain training with pulling movement.',

            // Upper Body
            'Dumbbell Bench Press': 'Lie on bench with dumbbells in hands, arms extended over chest. Lower dumbbells in controlled manner until they reach chest level, elbows at 45-degree angle to body. Press dumbbells back up to start position. Keep feet flat on floor, maintain natural arch in back. Focus on squeezing chest muscles at top of movement.',
            'Dumbbell Rows': 'Hinge at hips with dumbbells in hands, keeping back straight and chest up. Let dumbbells hang at arm\'s length. Pull dumbbells to ribs by driving elbows back and squeezing shoulder blades together. Lower dumbbells with control. Keep core engaged and avoid rounding back throughout movement.',
            'Overhead Press': 'Stand with feet shoulder-width apart, holding dumbbells at shoulder level with palms facing forward. Press dumbbells straight overhead until arms are fully extended. Lower dumbbells back to shoulder level with control. Keep core tight and avoid arching back excessively. Can also be performed seated for more stability.',
            'Dumbbell Pullover': 'Lie on bench with only upper back and shoulders supported, feet flat on floor. Hold single dumbbell with both hands, arms extended over chest. Lower dumbbell in arc motion behind head until feeling stretch in chest. Pull dumbbell back over chest to start position. Keep slight bend in elbows throughout movement.',

            // Chest
            'Incline Dumbbell Press': 'Lie on incline bench (30-45 degrees) with dumbbells in hands. Start with dumbbells at chest level, elbows at 45-degree angle. Press dumbbells up and slightly together until arms are extended. Lower with control back to chest level. This angle targets upper portion of chest muscles more than flat bench press.',
            'Decline Dumbbell Press': 'Lie on decline bench with dumbbells in hands. Start with dumbbells at chest level. Press dumbbells straight up until arms are extended over lower chest. Lower with control back to start position. This angle emphasizes lower portion of chest muscles. Secure feet properly on decline bench.',
            'Dumbbell Flyes': 'Lie on bench with dumbbells in hands, arms extended over chest with slight elbow bend. Lower dumbbells in wide arc until feeling stretch across chest. Keep slight bend in elbows constant throughout movement. Bring dumbbells back together over chest, focusing on squeezing chest muscles. Use lighter weight than pressing movements.',
            'Incline Dumbbell Flyes': 'Perform flyes on incline bench (30-45 degrees) using same technique as flat flyes. This angle targets upper chest fibers more effectively. Keep constant slight bend in elbows and focus on feeling stretch across upper chest at bottom of movement.',
            'Single-Arm Dumbbell Press': 'Lie on bench holding dumbbell in one hand. Press dumbbell from chest level to full arm extension. Lower with control. This unilateral movement challenges core stability and addresses strength imbalances. Keep non-working hand on chest or extended for balance.',
            'Chest Press': 'Alternative name for dumbbell bench press. Lie on bench and press dumbbells from chest level to full extension. Focus on squeezing chest muscles at top and controlling weight during lowering phase. Can be performed on flat, incline, or decline bench.',

            // Back
            'Bent-over Dumbbell Rows': 'Hinge at hips with dumbbells in hands, knees slightly bent. Keep back straight and chest up. Let dumbbells hang at arm\'s length. Pull dumbbells to lower ribs by driving elbows back. Squeeze shoulder blades together at top. Lower with control. Keep core engaged throughout.',
            'Single Arm Dumbbell Rows': 'Place left hand and left knee on bench for support. Hold dumbbell in right hand with arm hanging straight down. Pull dumbbell to ribs by driving elbow back. Squeeze shoulder blade toward spine at top. Lower with control. This allows for heavier weight and better focus on each side.',
            'Chest-Supported Row': 'Lie face down on incline bench with dumbbells in hands hanging straight down. Pull dumbbells to ribs by driving elbows back and squeezing shoulder blades together. Lower with control. This variation eliminates lower back stress by providing chest support.',
            'Reverse Flyes': 'Hinge at hips with dumbbells in hands, slight knee bend. With slight elbow bend, raise dumbbells out to sides until parallel to floor. Focus on squeezing shoulder blades together. Lower with control. This targets rear deltoids and rhomboids for better posture.',
            'Dumbbell Deadlifts': 'Hold dumbbells in front of thighs with overhand grip. Keep feet hip-width apart, slight knee bend. Hinge at hips by pushing them back while lowering dumbbells toward floor. Keep back straight and chest up. Drive hips forward to return to standing. Feel stretch in hamstrings at bottom.',
            'Renegade Rows': 'Start in plank position with hands gripping dumbbells on floor. Keep body in straight line. Row right dumbbell to ribs while balancing on left hand and feet. Lower dumbbell back to floor. Row left dumbbell. Continue alternating. This combines core stability with pulling strength.',
            'Wide-Grip Rows': 'Perform bent-over rows with wider than shoulder-width grip on dumbbells. This hand position targets different portions of back muscles, particularly middle traps and rhomboids. Focus on squeezing shoulder blades together at top of movement.',

            // Shoulders
            'Dumbbell Shoulder Press': 'Stand or sit with dumbbells at shoulder level, palms facing forward. Press dumbbells straight overhead until arms are fully extended. Lower with control back to shoulder level. Keep core tight and avoid excessive back arch. Can alternate arms or press both simultaneously.',
            'Lateral Raises': 'Stand with dumbbells at sides, slight bend in elbows. Raise dumbbells out to sides until parallel to floor. Focus on lifting with shoulders, not momentum. Lower with control, resisting gravity. Keep wrists neutral and avoid swinging weights. Use lighter weight and focus on form.',
            'Front Raises': 'Stand with dumbbells in front of thighs. With slight elbow bend, raise one or both dumbbells forward until parallel to floor. Lower with control. Keep core engaged and avoid using momentum. This targets front deltoids specifically.',
            'Arnold Press': 'Start with dumbbells at shoulder level, palms facing body. As you press overhead, rotate palms to face forward. At top, palms face forward with arms extended. Reverse movement by rotating palms back toward body while lowering. This combines press with rotation for complete shoulder development.',
            'Rear Delt Flyes': 'Hinge at hips with dumbbells in hands. With slight elbow bend, raise dumbbells back and out to sides, squeezing shoulder blades together. Focus on rear deltoid muscles. Lower with control. This helps balance front-heavy shoulder development.',
            'Upright Rows': 'Hold dumbbells in front of thighs with overhand grip, hands closer than shoulder-width. Pull dumbbells vertically along body to chest level, leading with elbows. Keep dumbbells close to body throughout movement. Lower with control. Stop if any shoulder discomfort occurs.',
            'Dumbbell Shrugs': 'Hold dumbbells at sides with arms straight. Lift shoulders straight up toward ears as high as possible. Hold briefly then lower slowly. Keep arms straight and avoid rolling shoulders forward or backward. Focus on squeezing upper trap muscles.',
            'Cuban Press': 'Hold dumbbells at shoulder level with elbows bent 90 degrees, palms down. Rotate forearms up so palms face forward (external rotation). Press dumbbells overhead. Reverse movement by lowering, rotating forearms back down. This complex movement improves shoulder mobility and stability.',
            'Pike Press': 'Start in pike position (downward dog) with hands on dumbbells. Lower head toward floor by bending elbows. Press back up to start position. This bodyweight variation can be enhanced with dumbbells for added resistance. Focus on shoulder strength and stability.',
            '6-Way Shoulder Raise': 'Perform lateral raises in six different directions: front, side, rear, and various angles in between. Use light weight and focus on controlled movement through all ranges of motion. This comprehensive exercise targets all portions of deltoid muscles.',

            // Arms/Biceps/Triceps
            'Dumbbell Bicep Curls': 'Stand with dumbbells at sides, palms facing forward. Keep elbows stationary at sides while curling dumbbells up toward shoulders. Squeeze biceps at top. Lower with control, resisting gravity. Avoid swinging or using momentum. Keep wrists straight throughout movement.',
            'Hammer Curls': 'Hold dumbbells at sides with neutral grip (palms facing each other). Curl dumbbells up toward shoulders while maintaining neutral grip. This targets biceps and forearms differently than regular curls. Keep elbows stationary and avoid swinging weights.',
            'Tricep Extensions': 'Hold single dumbbell with both hands overhead, arms extended. Lower dumbbell behind head by bending elbows while keeping upper arms stationary. Lower until feeling stretch in triceps. Extend arms back to start position. Keep elbows close to head throughout movement.',
            'Overhead Tricep Press': 'Similar to tricep extensions. Hold dumbbell overhead with both hands. Lower behind head by bending elbows. Keep upper arms vertical and still. Press back to start position by extending elbows. Focus on tricep muscles doing the work.',
            'Concentration Curls': 'Sit on bench with right elbow braced against inside of right thigh. Hold dumbbell in right hand with arm extended. Curl dumbbell toward shoulder while keeping elbow stationary against thigh. Lower with control. This isolates bicep muscle effectively.',
            'Tricep Kickbacks': 'Hinge at hips with dumbbell in right hand. Bring right elbow up so upper arm is parallel to floor. Extend forearm back by straightening elbow. Squeeze tricep at full extension. Return to bent position. Keep upper arm still throughout movement.',
            'Zottman Curls': 'Start with dumbbells at sides, palms facing forward. Curl up with underhand grip. At top, rotate wrists so palms face down. Lower dumbbells with overhand grip. At bottom, rotate back to underhand grip. This targets biceps concentrically and forearms eccentrically.',
            '21s Bicep Curls': 'Perform 7 partial reps from bottom to halfway up, then 7 partial reps from halfway to top, then 7 full range reps. This creates intense muscle fatigue by working different portions of strength curve. Use lighter weight than normal curls.',
            'Cross-Body Hammer Curls': 'Hold dumbbells at sides with neutral grip. Curl right dumbbell across body toward left shoulder. Lower with control. This angle targets biceps differently and engages core for stability. Alternate arms or complete all reps on one side.',
            'Single-Arm Tricep Extension': 'Hold dumbbell in right hand overhead. Lower dumbbell behind head by bending elbow while keeping upper arm vertical. Extend back to start position. This unilateral movement helps address strength imbalances between arms.',
            'Tate Press': 'Lie on bench with dumbbells in hands, arms extended over chest. Keep elbows flared wide throughout movement. Lower dumbbells to chest by bending elbows, keeping upper arms stationary. Press back up. This unique angle targets triceps differently than other pressing movements.',

            // Legs/Glutes/Hamstrings/Calves
            'Dumbbell Squats': 'Hold dumbbells at sides or at shoulder level. Stand with feet shoulder-width apart. Squat down by sitting back until thighs are parallel to floor. Keep chest up and weight on heels. Drive through heels to return to standing. Keep knees aligned over toes.',
            'Dumbbell Lunges': 'Hold dumbbells at sides. Step forward with right foot into lunge position. Lower until both knees are at 90 degrees. Push through right heel to return to standing. Can be performed as forward lunges, reverse lunges, or walking lunges.',
            'Romanian Deadlifts': 'Hold dumbbells in front of thighs with overhand grip. Keep slight bend in knees throughout movement. Hinge at hips by pushing them back while lowering dumbbells toward floor. Keep back straight and feel stretch in hamstrings. Drive hips forward to return to standing.',
            'Goblet Squats': 'Hold single dumbbell vertically at chest level with both hands supporting top weight plate. Stand with feet slightly wider than shoulder-width. Squat down while keeping dumbbell at chest. This position helps maintain upright torso and is great for beginners learning squat form.',
            'Dumbbell Hip Thrusts': 'Sit with upper back against bench, dumbbell resting on hips. Place feet flat on floor with knees bent. Drive hips up by squeezing glutes until thighs are parallel to floor. Hold briefly at top then lower with control. Keep core tight throughout movement.',
            'Dumbbell Step-ups': 'Hold dumbbells at sides. Step onto bench or platform with right foot, placing entire foot on surface. Drive through right heel to step up completely. Step down with control. Focus on using stepping leg, not pushing off ground leg.',
            'Lateral Lunges': 'Hold dumbbells at sides or chest level. Take large step to right side. Sit back into right hip while keeping left leg straight. Lower until right thigh is parallel to floor. Push through right heel to return to center. Complete all reps before switching sides.',
            'Single Leg Deadlifts': 'Hold dumbbells in front of right leg while balancing on right foot. Hinge at hip by pushing right hip back while lifting left leg behind you. Lower dumbbells toward floor while keeping back straight. Drive right hip forward to return to standing.',
            'Wall Squats with Dumbbells': 'Hold dumbbells at shoulder level while leaning back against wall. Slide down wall while squatting until thighs are parallel to floor. Hold position or perform reps. Wall provides support while adding resistance with dumbbells.',
            'Dumbbell Stiff Leg Deadlifts': 'Hold dumbbells in front of thighs with overhand grip. Keep legs straighter than Romanian deadlifts. Hinge at hips to lower dumbbells toward floor while keeping back straight. Focus on hamstring flexibility and strength. Return to standing by driving hips forward.',
            'Good Mornings with Dumbbells': 'Hold dumbbell at chest level with both hands. Keep slight bend in knees. Hinge at hips by pushing them back while keeping back straight. Lower until torso is parallel to floor or as flexibility allows. Drive hips forward to return to standing.',
            'Dumbbell Calf Raises': 'Hold dumbbells at sides. Rise up onto toes as high as possible. Hold briefly at top then lower with control. Can be performed on flat ground or edge of step for greater range of motion. Focus on squeezing calf muscles at top.',
            'Single Leg Calf Raises': 'Hold dumbbell in right hand while balancing on right foot. Rise up onto right toes as high as possible. Hold briefly then lower with control. Use left hand on wall for balance if needed. This increases difficulty and addresses imbalances.',
            'Seated Dumbbell Calf Raises': 'Sit on bench with dumbbells resting on thighs above knees. Rise up onto toes by lifting heels as high as possible. Hold briefly then lower heels below start position. This targets soleus muscle of calves more than standing variations.',

            // Core/Abs
            'Russian Twists with Dumbbell': 'Sit with knees bent, holding dumbbell with both hands. Lean back slightly while keeping back straight. Lift feet off ground for added difficulty. Rotate torso to right, bringing dumbbell beside right hip. Rotate to left side. Keep core engaged throughout.',
            'Dumbbell Side Bends': 'Stand with dumbbell in right hand at side, left hand on hip. Keep back straight and core engaged. Bend to right side as far as comfortable, feeling stretch on left side. Return to upright position using core muscles. Complete all reps before switching sides.',
            'Weighted Sit-ups': 'Lie on back with knees bent, holding dumbbell at chest with both hands. Lift shoulders and upper back off ground by contracting abs. Keep dumbbell at chest throughout movement. Lower back down with control. Added weight increases difficulty.',
            'Dumbbell Wood Chops': 'Hold dumbbell with both hands at right shoulder level. Rotate diagonally across body, bringing dumbbell toward left hip while squatting slightly. Return to start position. This functional movement targets core rotation and multiple muscle groups simultaneously.',
            'Farmer Walks': 'Hold heavy dumbbells at sides with arms straight. Walk forward with normal stride while maintaining good posture. Keep shoulders back and core engaged. This exercises entire body while focusing on grip strength, core stability, and posture.',
            'Suitcase Carries': 'Hold heavy dumbbell in right hand only. Walk forward while resisting urge to lean to right side. Keep torso upright and core engaged to counteract uneven load. This challenges core stability and anti-lateral flexion strength.',
            'Weighted Plank': 'Get into plank position on forearms. Have partner place dumbbell on back between shoulder blades. Hold plank position while supporting additional weight. Keep body in straight line and breathe normally. Remove weight if form deteriorates.',

            // === BARBELL EXERCISES ===
            
            'Deadlifts': 'Stand with feet hip-width apart, barbell over mid-foot. Hinge at hips and knees to grip bar with hands just outside legs. Keep back straight, chest up. Drive through heels while extending hips and knees simultaneously. Keep bar close to body throughout movement. Stand tall with shoulders back at top. Lower bar by pushing hips back first.',
            'Clean and Press': 'Start with barbell on floor. Deadlift bar to standing position. Quickly pull bar to shoulder level while dropping into partial squat to catch it. Stand up with bar at shoulders. Press bar overhead until arms are fully extended. Lower bar back to shoulders then to floor. This is complex Olympic lift requiring coaching.',
            'Thrusters': 'Hold barbell at shoulder level in front rack position. Squat down until thighs are parallel to floor. Drive through heels to stand while simultaneously pressing bar overhead. Lower bar back to shoulders and immediately begin next rep. Combines front squat with overhead press.',
            'Barbell Complexes': 'Perform series of different barbell exercises back-to-back without putting bar down. Example: deadlift, bent-over row, hang clean, front squat, push press. Complete specified reps of each exercise before moving to next. Very challenging for conditioning and strength.',
            'Clean and Jerk': 'Most technical Olympic lift. Clean bar from floor to shoulders in one explosive movement. Pause briefly. Jerk bar overhead by dipping slightly then driving up while splitting legs fore and aft or squatting under bar. Stand with bar overhead. Requires extensive coaching to learn properly.',
            'Snatch': 'Lift bar from floor to overhead in one continuous explosive movement. Much wider grip than other lifts. Drop into overhead squat position to catch bar. Stand up with bar overhead. Most technical lift in weightlifting. Requires coaching and significant mobility.',
            'Front Squat to Press': 'Hold barbell in front rack position at shoulders. Perform front squat by sitting back until thighs are parallel. Drive up to standing then immediately press bar overhead. Lower bar back to shoulders. Combines lower body and upper body training.',

            // Upper Body
            'Barbell Bench Press': 'Lie on bench with eyes under barbell. Grip bar with hands wider than shoulders. Lift bar off rack and position over chest. Lower bar to chest with control, touching lightly. Press bar back up until arms are fully extended. Keep shoulder blades retracted and feet flat on floor.',
            'Bent-over Barbell Rows': 'Hold barbell with overhand grip, hands wider than shoulders. Hinge at hips with knees slightly bent, keeping back straight. Let bar hang at arm\'s length. Pull bar to lower chest/upper abdomen by driving elbows back. Squeeze shoulder blades together at top. Lower with control.',

            // Chest
            'Incline Barbell Press': 'Lie on incline bench (30-45 degrees) with barbell racked above chest. Grip bar wider than shoulders. Lower bar to upper chest with control. Press back up until arms are extended. This angle targets upper chest fibers more than flat bench press.',
            'Decline Barbell Press': 'Lie on decline bench with feet secured. Grip bar wider than shoulders. Lower bar to lower chest area. Press back up until arms are extended. This angle emphasizes lower portion of chest muscles. Secure feet properly before lifting.',
            'Close-Grip Bench Press': 'Lie on bench with hands positioned shoulder-width apart or slightly closer on barbell. Lower bar to chest while keeping elbows closer to body than regular bench press. Press back up. This variation emphasizes triceps development over chest.',
            'Floor Press': 'Lie on floor with barbell positioned over chest. Lower bar until upper arms touch floor, limiting range of motion. Press back up until arms are extended. This variation removes leg drive and emphasizes pressing strength from dead stop position.',
            'Guillotine Press': 'Perform bench press but lower bar to neck/throat area instead of chest. This is advanced variation that places more stretch on chest muscles but increases shoulder stress. Only for experienced lifters with good shoulder mobility.',

            // Back
            'T-Bar Rows': 'Straddle T-bar apparatus or place one end of barbell in corner. Hinge at hips and grip handle or bar. Pull weight to chest by driving elbows back and squeezing shoulder blades together. Lower with control. Keep back straight throughout movement.',
            'Pendlay Rows': 'Start with barbell on floor. Hinge at hips to grip bar with wide grip. Pull bar explosively from floor to chest, then lower back to floor with control. Reset position between each rep. This eliminates momentum and ensures each rep starts from dead stop.',
            'Rack Pulls': 'Set barbell in power rack at knee height or just below. Perform deadlift movement from this elevated position. This allows use of heavier weight and targets upper portion of deadlift movement. Good for building lockout strength.',
            'Barbell Shrugs': 'Hold barbell in front of thighs with overhand grip. Lift shoulders straight up toward ears as high as possible. Hold briefly then lower slowly. Keep arms straight and avoid rolling shoulders. Focus on squeezing upper trap muscles.',

            // Shoulders
            'Behind-the-Neck Press': 'Sit or stand with barbell across upper back as in squat position. Press bar straight up from behind neck until arms are extended overhead. Lower back to neck level. Requires good shoulder mobility. Stop if any discomfort occurs.',
            'Push Press': 'Hold barbell at shoulder level in front rack position. Dip slightly by bending knees, then drive up explosively while pressing bar overhead. Use leg drive to assist the press. This allows use of heavier weight than strict overhead press.',
            'Bradford Press': 'Hold barbell at shoulder level in front. Press bar up and back to behind neck, then press from behind neck back to front. This challenging exercise works shoulders through large range of motion. Requires good mobility.',
            'High Pulls': 'Start like deadlift but pull bar explosively to chest level, keeping it close to body. Shrug shoulders and bend elbows to pull bar high. Don\'t catch bar - let it fall back down. Focuses on explosive pulling power.',

            // Arms/Biceps/Triceps
            'Barbell Curls': 'Stand with barbell in hands, palms facing forward, hands shoulder-width apart. Keep elbows stationary at sides while curling bar toward chest. Squeeze biceps at top. Lower with control. Avoid swinging or using momentum.',
            'Barbell Skull Crushers': 'Lie on bench holding barbell with close grip, arms extended over chest. Lower bar toward forehead by bending elbows while keeping upper arms stationary. Stop just before bar touches forehead. Extend elbows to return to start.',
            'Reverse Barbell Curls': 'Hold barbell with overhand grip (palms down), hands shoulder-width apart. Curl bar toward chest while keeping elbows stationary. This variation targets forearms and biceps differently than regular curls.',
            'EZ-Bar Curls': 'Use EZ-curl bar which has angled grips for more comfortable wrist position. Perform curls same as straight barbell but with less wrist stress. Good option for those with wrist discomfort from straight bar curls.',
            'Drag Curls': 'Hold barbell with underhand grip. Instead of curling bar away from body, drag it up along torso while pulling elbows back. This keeps bar close to body and changes angle of bicep work.',
            'Wide-Grip Barbell Curls': 'Perform barbell curls with hands positioned wider than shoulders. This grip variation targets biceps from different angle and may emphasize different portions of muscle.',
            '21s Barbell Curls': 'Perform 7 partial reps from bottom to halfway, 7 partial reps from halfway to top, then 7 full reps. Use lighter weight than normal curls. Creates intense muscle fatigue.',
            'Overhead Barbell Extension': 'Hold barbell overhead with narrow grip. Lower bar behind head by bending elbows while keeping upper arms vertical. Press back to start position. Similar to skull crushers but performed overhead.',
            'JM Press': 'Combination of close-grip bench press and skull crusher. Lower bar partway down toward chest, then shift to lowering toward forehead. Unique movement pattern for tricep development.',
            'California Press': 'Similar to JM Press. Start like close-grip bench press but change angle during descent to target triceps differently. Advanced technique requiring practice to master.',

            // Legs/Glutes/Hamstrings/Calves
            'Back Squats': 'Position barbell on upper back (high bar) or lower on rear delts (low bar). Stand with feet shoulder-width apart. Squat down by sitting back and bending knees until thighs are parallel to floor. Drive through heels to stand up. Keep chest up and knees aligned over toes.',
            'Front Squats': 'Hold barbell across front of shoulders in rack position, elbows high. Keep torso more upright than back squat. Squat down until thighs are parallel to floor. Drive through heels to stand up. This position emphasizes quads and core more than back squat.',
            'Sumo Deadlifts': 'Stand with feet wide (1.5-2 times shoulder width), toes pointed out. Grip bar with hands inside legs. Keep chest up and back straight. Drive through heels while extending hips and knees. This stance targets glutes and inner thighs more than conventional deadlift.',
            'Barbell Lunges': 'Position barbell on upper back as in squat. Step forward into lunge position with right leg. Lower until both knees are at 90 degrees. Push through right heel to return to standing. Can be performed as walking lunges or stationary.',
            'Hip Thrusts': 'Sit with upper back against bench, barbell across hips. Place feet flat on floor with knees bent. Drive hips up by squeezing glutes until thighs are parallel to floor. Hold briefly at top then lower with control. Use pad on bar for comfort.',
            'Zercher Squats': 'Hold barbell in crook of elbows at chest level. Squat down until thighs are parallel to floor. This unique position challenges core stability and changes squat mechanics. Use towel or bar pad for comfort.',
            'Overhead Squats': 'Hold barbell overhead with wide grip, arms fully extended. Squat down while keeping bar overhead. Requires excellent mobility and stability throughout entire body. Start with just body weight or empty bar.',
            'Split Squats': 'Position barbell on back, step into static lunge position. Lower back knee toward ground while keeping most weight on front leg. Push through front heel to return up. Complete all reps on one leg before switching.',
            'Stiff Leg Deadlifts': 'Hold barbell with overhand grip. Keep legs straighter than regular deadlift. Hinge at hips to lower bar toward floor while maintaining straight back. Focus on hamstring stretch and strength.',            
            'Deficit Deadlifts': 'Stand on platform or plates so barbell starts lower than normal. Perform deadlift from this deficit position, increasing range of motion. Helps improve strength off the floor and mobility.',           
            'Barbell Calf Raises': 'Position barbell on upper back as in squat position. Rise up onto toes as high as possible. Hold briefly then lower with control. Can be performed on flat ground or edge of platform for greater range.',           
            'Donkey Calf Raises': 'Bend forward at hips with barbell on back, hands supported on bench or bar. Perform calf raises from this bent-over position. This angle targets calf muscles differently than standing raises.',

            // Core/Abs
            'Barbell Rollouts': 'Kneel with barbell on floor in front of you, hands gripping bar. Roll bar forward while keeping core tight and back straight. Roll out as far as possible while maintaining control. Pull bar back to start position using core muscles.',           
            'Landmine Twists': 'Place one end of barbell in landmine attachment or corner. Hold other end with both hands. Rotate barbell side to side across body while keeping core engaged. This anti-rotation exercise builds core stability.',           
            'Overhead Barbell Carries': 'Hold barbell overhead with arms fully extended. Walk forward while maintaining overhead position. Keep core tight to maintain stability. This challenges shoulder stability and core strength simultaneously.',           
            'Front-Loaded Carries': 'Hold barbell in front rack position at shoulders. Walk forward while maintaining upright posture. Keep core engaged to prevent forward lean. This challenges core stability in different plane than overhead carries.',          
            'Zercher Carries': 'Hold barbell in crook of elbows at chest level. Walk forward while maintaining upright posture. This unique position challenges core and upper back strength while walking.',

            // === KETTLEBELL EXERCISES ===
            
            'Kettlebell Swings': 'Stand with feet wider than shoulders, kettlebell on floor between feet. Hinge at hips to grip kettlebell with both hands. Drive hips forward explosively while swinging kettlebell to chest height. Let gravity pull kettlebell back down while hinging at hips. Focus on hip drive, not arm lifting.',           
            'Turkish Get-ups': 'Lie on back holding kettlebell in right hand, arm extended toward ceiling. Bend right knee, place foot flat on floor. Roll onto left elbow, then left hand. Lift hips and slide left leg back into kneeling lunge. Stand up while keeping kettlebell overhead throughout. Reverse movement to return down.',
            'Kettlebell Snatches': 'Start like kettlebell swing but pull kettlebell overhead in one explosive movement. Punch hand through at top and lock out overhead. Lower back down by letting kettlebell fall and hinging at hips. This is advanced movement requiring practice.',
            'Kettlebell Clean and Press': 'Start with kettlebell between feet. Clean kettlebell to shoulder by pulling it up and rotating hand underneath. Press kettlebell overhead until arm is fully extended. Lower back to shoulder then to floor. Practice clean movement before adding press.',           
            'Kettlebell Complexes': 'Perform series of kettlebell exercises back-to-back without putting weight down. Example: swing, clean, squat, press. Builds strength endurance and cardiovascular fitness.',           
            'Kettlebell Flow': 'Link multiple kettlebell exercises together in continuous flowing movement. Example: swing to clean to squat to press to windmill. Create smooth transitions between exercises. Start slowly and build speed as movement patterns improve.',

            // Upper Body/Chest/Back/Shoulders
            'Kettlebell Press': 'Clean kettlebell to shoulder position with kettlebell resting on back of forearm. Press kettlebell overhead until arm is fully extended. Lower back to shoulder with control. Can be performed single or double arm.',           
            'Kettlebell Rows': 'Hinge at hips with kettlebell in one hand. Row kettlebell to ribs by driving elbow back. Keep opposite hand on knee or bench for support. Focus on squeezing shoulder blade toward spine at top.',          
            'Kettlebell High Pulls': 'Start like kettlebell swing but pull kettlebell to chest height with elbows high. This is explosive pulling movement that builds power. Let kettlebell fall back down under control.',           
            'Kettlebell Floor Press': 'Lie on floor with kettlebell in hand, upper arm resting on floor. Press kettlebell straight up until arm is extended. Lower back until upper arm touches floor. This eliminates leg drive and emphasizes pressing strength.',           
            'Single-Arm Kettlebell Press': 'Clean kettlebell to shoulder with one hand. Press overhead while keeping opposite hand at side. This unilateral movement challenges core stability and addresses strength imbalances.',           
            'Kettlebell Chest Flyes': 'Lie on floor with kettlebells in both hands, arms extended over chest. Lower kettlebells in wide arc until feeling stretch across chest. Bring kettlebells back together over chest. Use lighter weight than pressing movements.',           
            'Kettlebell Push-ups': 'Place hands on kettlebell handles instead of floor. Perform push-ups while gripping handles. This adds instability and grip challenge to traditional push-ups.',           
            'Single-Arm Kettlebell Rows': 'Support one hand on bench while rowing kettlebell with other arm. This allows focus on one side at a time and use of heavier weight.',          
            'Kettlebell Renegade Rows': 'Start in plank position with hands on kettlebell handles. Row one kettlebell while maintaining plank with other arm. Alternate sides. This combines core stability with pulling strength.',           
            'Kettlebell Halos': 'Hold kettlebell by horns (sides of handle) overhead. Circle kettlebell around head while keeping core tight. This improves shoulder mobility and stability. Start with light weight.',            
            'Kettlebell Upright Rows': 'Hold kettlebell with both hands by handle. Pull kettlebell vertically to chest level, leading with elbows. Keep kettlebell close to body throughout movement.',            
            'Bottoms-up Press': 'Hold kettlebell upside down by handle with ball pointing up. Press overhead while keeping kettlebell balanced. This requires significant grip strength and stability. Start with light weight.',

            // Arms/Biceps/Triceps
            'Kettlebell Curls': 'Hold kettlebell by handle with palm facing forward. Curl kettlebell toward shoulder while keeping elbow stationary. Lower with control. The offset weight challenges grip and forearms differently than dumbbells.',            
            'Kettlebell Tricep Press': 'Hold kettlebell overhead with both hands gripping handle. Lower kettlebell behind head by bending elbows. Keep upper arms vertical and still. Press back to start position.',            
            'Kettlebell Hammer Curls': 'Hold kettlebell with neutral grip (palm facing side). Curl toward shoulder while maintaining grip position. This targets biceps and forearms effectively.',           
            'Kettlebell Drag Curls': 'Hold kettlebell with underhand grip. Drag kettlebell up along body while pulling elbow back. This keeps weight close to body and changes bicep angle.',           
            'Kettlebell Skull Crushers': 'Lie on floor with kettlebell in hands. Lower kettlebell toward forehead by bending elbows while keeping upper arms still. Press back to start position.',

            // Legs/Glutes/Hamstrings/Calves
            'Goblet Squats': 'Hold kettlebell at chest level by horns or handle. Stand with feet wider than shoulders. Squat down until elbows touch knees or thighs are parallel. Drive through heels to stand. This position helps maintain upright torso.',           
            'Kettlebell Deadlifts': 'Stand with kettlebell between feet. Hinge at hips and grip kettlebell with both hands. Keep back straight while driving hips forward to stand up. This teaches proper deadlift mechanics with lighter weight.',            
            'Kettlebell Lunges': 'Hold kettlebell at chest, overhead, or at sides. Perform lunges in any direction while maintaining kettlebell position. The offset load challenges stability and core strength.',           
            'Single Leg Deadlifts': 'Hold kettlebell in opposite hand from standing leg. Hinge at hip while lifting non-standing leg behind you. Keep back straight and feel stretch in standing leg hamstring. Return to standing.',           
            'Cossack Squats': 'Hold kettlebell at chest level. Step wide to one side and squat down on that leg while keeping other leg straight. Return to center. This lateral movement improves hip mobility and strength.',         
            'Kettlebell Hip Thrusts': 'Sit with upper back against bench, kettlebell on hips. Drive hips up by squeezing glutes until thighs are parallel to floor. The kettlebell adds resistance to glute bridge movement.',         
            'Kettlebell Front Squats': 'Clean kettlebell to front rack position (resting on forearm). Perform squats while maintaining kettlebell at shoulder. This challenges core stability and mimics barbell front squat.',        
            'Kettlebell Step-ups': 'Hold kettlebell at chest or sides while stepping up onto bench or platform. Focus on using stepping leg rather than pushing off ground leg.',         
            'Kettlebell Good Mornings': 'Hold kettlebell at chest level. Hinge at hips while keeping back straight until torso is parallel to floor. Drive hips forward to return to standing.',        
            'Kettlebell Calf Raises': 'Hold kettlebell at chest or sides while performing calf raises. Rise up on toes as high as possible then lower with control.',        
            'Single Leg Kettlebell Calf Raises': 'Hold kettlebell in one hand while performing single leg calf raises. This increases difficulty and challenges balance.',

            // Core/Abs
            'Russian Twists with Kettlebell': 'Sit with knees bent holding kettlebell with both hands. Lean back slightly and lift feet off ground. Rotate kettlebell side to side, touching ground beside hips.',         
            'Kettlebell Windmills': 'Hold kettlebell overhead in right hand. Step left foot out to side. Hinge at hip and reach down toward left foot with left hand while keeping kettlebell overhead. Return to standing. Very challenging exercise.',        
            'Kettlebell Carries': 'Carry kettlebell in various positions while walking: overhead, at shoulder (rack position), at side (suitcase), or both sides. Each position challenges body differently.',         
            'Kettlebell Figure 8s': 'Stand with feet wide, kettlebell in right hand. Pass kettlebell between legs to left hand, around left leg, between legs to right hand, around right leg. Continue in figure 8 pattern.',        
            'Kettlebell Wood Chops': 'Hold kettlebell with both hands at right shoulder. Chop diagonally across body toward left hip while squatting slightly. Return to start. This functional movement targets core rotation.',

            // === RESISTANCE BAND EXERCISES ===
            
            'Band Thrusters': 'Stand on resistance band with feet shoulder-width apart, handles at shoulders. Squat down then drive up while pressing handles overhead. Band provides variable resistance throughout movement.',        
            'Band Squat-to-Press': 'Same as band thrusters. Combine squat with overhead press in one fluid movement. Focus on driving through heels during squat portion.',       
            'Band Mountain Climbers': 'Loop band around feet. Get in plank position and perform mountain climbers with band providing resistance to leg movement. Increases difficulty of traditional exercise.',         
            'Band Burpees': 'Perform burpees while wearing resistance band around ankles or feet. Band adds resistance to jumping and leg movements throughout the exercise.',

            // Chest/Back
            'Band Chest Press': 'Anchor band behind you at chest height. Hold handles and press forward until arms are extended. Slowly return to start position. Step farther from anchor to increase resistance.',        
            'Band Rows': 'Anchor band in front at chest height or sit with band around feet. Pull handles to ribs by driving elbows back and squeezing shoulder blades together. Control the return movement.',        
            'Band Flyes': 'Anchor band behind you at chest height. Hold handles with arms slightly bent. Bring handles together in front of chest in hugging motion. Control return to start position.',        
            'Band Push-ups': 'Loop band around back and hold handles while in push-up position. Band adds resistance to the pushing motion. Adjust resistance by changing hand position on band.',        
            'Incline Band Press': 'Anchor band low behind you. Press handles up and forward at 45-degree angle. This targets upper chest similar to incline dumbbell press.',        
            'Single-Arm Band Press': 'Anchor band behind you and press one handle at a time. This unilateral movement challenges core stability and addresses strength imbalances.',        
            'Band Crossover': 'Anchor band high behind you. Pull handles down and across body, crossing in front of chest. This mimics cable crossover exercise.',         
            'Band Pull-aparts': 'Hold band with both hands in front of chest, arms extended. Pull band apart by squeezing shoulder blades together. This is excellent for posture improvement.',         
            'Band Lat Pulldowns': 'Anchor band high above you. Pull handles down to chest while squeezing shoulder blades together. This mimics lat pulldown machine exercise.',        
            'Band Face Pulls': 'Anchor band at face height. Pull handles to face with elbows high, squeezing shoulder blades together. Excellent for rear deltoid and rhomboid strengthening.',         
            'Wide-Grip Band Rows': 'Perform band rows with hands positioned wider than shoulders. This targets different portions of back muscles, particularly middle traps.',

            // Shoulders/Arms
            'Band Shoulder Press': 'Stand on band with feet shoulder-width apart. Press handles overhead from shoulder level until arms are extended. Control lowering back to shoulders.',        
            'Band Lateral Raises': 'Stand on band with one foot, hold handle in same-side hand. Raise arm out to side until parallel to floor. Control lowering back to start.',        
            'Band Front Raises': 'Stand on band and raise handles forward to shoulder height with slight bend in elbows. Control the lowering phase to maximize muscle engagement.',         
            'Band Rear Delt Flyes': 'Hold band in front with arms extended. Pull band apart while squeezing shoulder blades together. This targets rear deltoids for balanced shoulder development.',        
            'Band External Rotations': 'Hold band with elbows at sides bent to 90 degrees. Rotate forearms outward against band resistance. Important for shoulder health and injury prevention.',        
            'Band Bicep Curls': 'Stand on band and curl handles toward shoulders while keeping elbows stationary. Variable resistance makes this different from free weight curls.',        
            'Band Tricep Extensions': 'Anchor band high above you. Pull handles down by extending elbows while keeping upper arms stationary. Control return to start position.',        
            'Band Hammer Curls': 'Stand on band and curl with neutral grip (palms facing each other). This targets biceps and forearms similarly to dumbbell hammer curls.',         
            'Band Concentration Curls': 'Sit and anchor band under foot. Curl handle toward shoulder while bracing elbow against inner thigh for isolation.',         
            'Band 21s': 'Perform 7 partial curls from bottom to halfway, 7 from halfway to top, then 7 full range curls. Use moderate resistance band.',           
            'Single-Arm Band Curls': 'Curl one arm at a time for better focus and to address strength imbalances between arms.',           
            'Band Tricep Pushdowns': 'Anchor band high and push handles down by extending elbows. This mimics cable machine tricep pushdowns.',         
            'Band Overhead Extensions': 'Hold band overhead and extend one arm down while keeping other arm stationary. Targets triceps effectively.',        
            'Band Tricep Kickbacks': 'Hinge forward and extend band back by straightening elbow while keeping upper arm parallel to floor.',

            // Legs/Glutes/Core
            'Band Squats': 'Place band around thighs just above knees or stand on band while holding handles. Perform squats with added resistance from band.',        
            'Band Deadlifts': 'Stand on band and hold handles. Perform deadlift movement by hinging at hips while keeping back straight. Band provides variable resistance.',        
            'Band Lunges': 'Step on band with front foot and hold handles. Perform lunges with band providing resistance throughout movement.',        
            'Band Leg Press': 'Lie on back with band around feet. Press feet away from body against band resistance, mimicking leg press machine.',        
            'Band Step-ups': 'Step onto platform while standing on band and holding handles. Band adds resistance to step-up movement.',        
            'Band Clamshells': 'Lie on side with band around thighs. Keep feet together while lifting top knee against band resistance. Targets gluteus medius.',        
            'Band Glute Bridges': 'Place band around thighs and perform glute bridges. Band adds resistance and ensures glute activation.',        
            'Band Hip Thrusts': 'Perform hip thrusts with band around thighs for added glute activation and resistance.',      
            'Band Monster Walks': 'Place band around ankles or thighs. Walk sideways while maintaining tension in band. Keep knees slightly bent throughout.',        
            'Band Fire Hydrants': 'Start on hands and knees with band around thighs. Lift leg out to side against band resistance while keeping knee bent.',         
            'Band Kickbacks': 'Start on hands and knees with band around feet. Kick one leg back against band resistance while keeping knee bent.',        
            'Band Leg Extensions': 'Sit with band around ankles. Extend one leg forward against band resistance. This targets quadriceps muscles.',        
            'Band Wall Squats': 'Place band around thighs and perform wall squats. Band ensures proper knee alignment and adds resistance.',       
            'Band Leg Curls': 'Lie face down with band around ankles. Curl heels toward glutes against band resistance.',       
            'Band Good Mornings': 'Place band around shoulders and under feet. Hinge at hips against band resistance while keeping back straight.',         
            'Single Leg Band Deadlifts': 'Stand on band with one foot and perform single leg deadlift while holding handle in opposite hand.',         
            'Band Calf Raises': 'Stand on band and hold handles while performing calf raises. Band adds resistance to calf strengthening.',         
            'Band Ankle Flexion': 'Sit with band around foot. Flex ankle against band resistance for strengthening lower leg muscles.',         
            'Band Toe Points': 'Point toes against band resistance to strengthen calf muscles and improve ankle mobility.',         
            'Band Wood Chops': 'Anchor band to side and pull diagonally across body in chopping motion. Targets core rotation and stability.',         
            'Band Pallof Press': 'Hold band at chest level with band anchored to side. Press straight out while resisting band\'s pull to one side.',         
            'Band Russian Twists': 'Sit with band anchored behind you. Rotate side to side against band resistance while holding handles.',         
            'Band Dead Bug': 'Lie on back with band around feet. Extend opposite arm and leg while maintaining core stability.',         
            'Band Bicycle Crunches': 'Perform bicycle crunches with band around feet for added resistance to leg movement.',

            // === CABLE MACHINE EXERCISES ===
            
            'Cable Wood Chops': 'Set cable at shoulder height. Pull handle diagonally across body from high to low in chopping motion. Engage core and rotate through torso.',         
            'Cable Squat to Press': 'Hold cable handles at shoulders. Perform squat then press handles overhead as you stand. Cable provides constant tension throughout movement.',         
            'Cable Thrusters': 'Same as cable squat to press. Combine squat with overhead press in one fluid movement using cable resistance.',         
            'Cable Chest Press': 'Set cables at chest height. Press handles forward until arms are extended. This provides constant tension unlike free weights.',         
            'Cable Flyes': 'Set cables at chest height or various angles. Bring handles together in hugging motion. Constant tension improves muscle activation.',         
            'Incline Cable Press': 'Set cables low and press up at 45-degree angle. This targets upper chest fibers effectively.',         
            'Cable Crossover': 'Set cables high and pull handles down and across body, crossing in front of chest. Classic bodybuilding exercise for chest.',         
            'Single-Arm Cable Press': 'Press one handle at a time for unilateral strengthening and core challenge.',         
            'Cable Chest Squeeze': 'Set cables at chest height. Squeeze handles together and hold contraction. Isometric exercise for chest.',         
            'Cable Rows': 'Sit or stand and pull cable handles to ribs. Focus on squeezing shoulder blades together. Various grip options available.',         
            'Lat Pulldowns': 'Sit and pull cable bar down to chest. This mimics pull-up movement for those unable to perform bodyweight version.',         
            'Cable Face Pulls': 'Set cable at face height. Pull handle to face with elbows high. Excellent for rear deltoids and posture.',         
            'Cable Reverse Flyes': 'Set cables at chest height. Pull handles apart while squeezing shoulder blades together.',        
            'Single-Arm Cable Rows': 'Row one arm at a time for better focus and to address imbalances.',          
            'Wide-Grip Pulldowns': 'Perform lat pulldowns with wider grip to target lats differently.',         
            'Cable Pullovers': 'Stand and pull cable from overhead down to hips in arc motion. Targets lats and serratus anterior.',         
            'Cable Lateral Raises': 'Set cable low and raise handle out to side. Constant tension improves deltoid activation.',         
            'Cable Front Raises': 'Raise cable handle forward to shoulder height. Targets anterior deltoids specifically.',        
            'Cable Rear Delt Flyes': 'Set cable at chest height and pull handle back while squeezing shoulder blade.',          
            'Cable Shoulder Press': 'Press cable handles overhead from shoulder level. Can be performed single or double arm.',         
            'Cable Upright Rows': 'Pull cable handle vertically to chest level, leading with elbows.',        
            'Cable External Rotations': 'Set cable at elbow height. Rotate forearm outward against resistance for shoulder health.',         
            'Cable Bicep Curls': 'Curl cable handle toward shoulder. Constant tension throughout range of motion.',        
            'Cable Hammer Curls': 'Curl with neutral grip attachment. Targets biceps and forearms effectively.',        
            'Cable Concentration Curls': 'Sit and curl cable handle while bracing elbow for bicep isolation.',         
            'Cable Preacher Curls': 'Use preacher bench with cable for supported bicep curls.',         
            'Cable 21s': 'Perform 21-rep protocol using cable machine for constant tension.',         
            'Cable Tricep Pushdowns': 'Push cable handle down by extending elbows. Keep upper arms stationary.',        
            'Cable Overhead Tricep Extension': 'Pull cable down from overhead by extending elbows.',         
            'Cable Tricep Kickbacks': 'Hinge forward and extend cable back by straightening elbow.',          
            'Cable Diamond Press': 'Press cable handles together in diamond shape motion.',          
            'Cable Squats': 'Hold cable handles while performing squats for added resistance.',         
            'Cable Leg Press': 'Lie on back and press cable with feet, mimicking leg press machine.',         
            'Cable Lunges': 'Perform lunges while holding cable handles for resistance.',         
            'Cable Step-ups': 'Step onto platform while holding cable for added challenge.',         
            'Cable Kickbacks': 'Attach cable to ankle and kick back against resistance for glutes.',         
            'Cable Hip Abduction': 'Attach cable to ankle and move leg out to side against resistance.',         
            'Cable Deadlifts': 'Perform deadlift movement using cable machine for constant tension.',         
            'Cable Glute Bridges': 'Perform glute bridges with cable across hips for resistance.',         
            'Cable Leg Extensions': 'Sit and extend leg forward against cable resistance.',         
            'Cable Leg Curls': 'Curl heel toward glutes against cable resistance.',         
            'Cable Romanian Deadlifts': 'Perform RDL movement using cable for constant tension.',         
            'Cable Good Mornings': 'Hinge at hips against cable resistance.',         
            'Cable Calf Raises': 'Perform calf raises while holding cable for resistance.',         
            'Single Leg Cable Calf Raises': 'Single leg calf raises with cable resistance.',         
            'Cable Crunches': 'Kneel and crunch down against cable resistance.',         
            'Cable Russian Twists': 'Rotate side to side against cable resistance.',         
            'Cable Pallof Press': 'Press cable straight out while resisting lateral pull.',         
            'Cable Knee Raises': 'Raise knees against cable resistance for core strengthening.',

            // === PULL-UP BAR EXERCISES ===
            
            'Neutral Grip Pull-ups': 'Use parallel handles to grip bar with palms facing each other. Pull up until chin clears bar. This grip is often easier on wrists and elbows.',         
            'L-Sit Pull-ups': 'Perform pull-ups while holding legs straight out in front, forming L shape with body. This adds significant core challenge to pulling movement.',         
            'Archer Pull-ups': 'Pull up to one side of bar while straightening opposite arm. Alternate sides. This unilateral movement builds single-arm pulling strength.',         
            'Supinated Pull-ups': 'Same as chin-ups - underhand grip with palms facing you. This grip emphasizes biceps more than overhand grip.',         
            'Hanging Windshield Wipers': 'Hang from bar and rotate legs side to side like windshield wipers. Keep legs straight for maximum challenge.',         
            'Toes to Bar': 'Hang from bar and bring toes up to touch bar. Control the lowering phase. Very challenging core exercise.',        
            'Hanging Oblique Crunches': 'Hang from bar and bring knees to one elbow, then other elbow. Targets oblique muscles specifically.',

            // === MEDICINE BALL EXERCISES ===
            
            'Medicine Ball Slams': 'Hold medicine ball overhead with both hands. Slam ball down to ground as hard as possible while engaging core. Pick up and repeat.',         
            'Medicine Ball Burpees': 'Perform burpee while gripping medicine ball throughout movement. Place ball on ground, jump back to plank, jump forward, lift ball overhead.',         
            'Medicine Ball Turkish Get-ups': 'Perform Turkish get-up while holding medicine ball instead of kettlebell. Follow same movement pattern.',         
            'Medicine Ball Chest Pass': 'Stand facing wall or partner. Pass ball from chest with explosive movement, catching on return.',         
            'Medicine Ball Overhead Press': 'Press medicine ball overhead from shoulder level. Can be performed standing or seated.',         
            'Medicine Ball Push-ups': 'Place hands on medicine ball and perform push-ups. The instability increases difficulty.',         
            'Explosive Medicine Ball Push-ups': 'Perform push-ups on ball explosively, lifting hands off ball between reps.',         
            'Medicine Ball Chest Throw': 'Explosively throw ball forward from chest for power development. Requires partner or wall.',         
            'Medicine Ball Overhead Throws': 'Throw ball overhead against wall or ground as hard as possible. Focus on core engagement.',         
            'Medicine Ball Shoulder Press': 'Press ball overhead focusing on shoulder strength and stability.',         
            'Medicine Ball Circles': 'Circle ball around head, waist, or in various patterns for coordination and strength.',         
            'Medicine Ball Bicep Curls': 'Curl ball toward chest while keeping elbows stationary.',         
            'Medicine Ball Tricep Extension': 'Hold ball overhead and lower behind head by bending elbows.',         
            'Medicine Ball Squats': 'Hold ball at chest, overhead, or in front while performing squats.',         
            'Medicine Ball Lunges': 'Perform lunges while holding ball in various positions.',         
            'Medicine Ball Wall Squats': 'Place ball between back and wall during squats for support and added challenge.',         
            'Medicine Ball Hip Thrusts': 'Place ball on hips during hip thrust for added resistance.',         
            'Medicine Ball Deadlifts': 'Hold ball while performing deadlift movement.',         
            'Medicine Ball Russian Twists': 'Rotate ball side to side while sitting with feet elevated.',          
            'Medicine Ball Sit-ups': 'Hold ball during sit-ups for added resistance.',          
            'Medicine Ball V-ups': 'Hold ball during V-ups, touching ball to feet at top.',          
            'Medicine Ball Wood Chops': 'Chop ball diagonally across body in wood chopping motion.',       
            'Medicine Ball Crunches': 'Hold ball during crunches for added resistance.',         
            'Medicine Ball Dead Bug': 'Hold ball during dead bug exercise for increased challenge.',

            // === BATTLE ROPES EXERCISES ===
            
            'Alternating Waves': 'Hold one rope end in each hand. Create waves by alternately raising and lowering arms as fast as possible. Keep core tight and maintain rhythm.',         
            'Double Arm Waves': 'Hold both rope ends and create waves by raising and lowering both arms together. More challenging than alternating waves.',         
            'Battle Rope Spirals': 'Create spiral patterns with ropes by rotating arms in circular motions. Can be performed with both arms or alternating.',        
            'Battle Rope Burpees': 'Perform burpees while holding rope ends. Add waves at top of movement for extra challenge.',        
            'Side-to-Side Waves': 'Create waves by moving ropes horizontally from side to side instead of up and down.',        
            'In-Out Waves': 'Move ropes in and out horizontally, bringing ends together then apart repeatedly.',        
            'Overhead Slams': 'Lift ropes overhead then slam down forcefully. Focus on core engagement during slam.',        
            'Lateral Waves': 'Create waves moving ropes laterally across body for different muscle activation.',         
            'Shoulder Spirals': 'Create spiral patterns using primarily shoulder movement.',          
            'Seated Battle Ropes': 'Perform rope exercises from seated position to increase core challenge.',          
            'Russian Twist Waves': 'Combine Russian twists with rope waves for core and conditioning.',         
            'Plank Battle Ropes': 'Hold plank position while creating waves with ropes.',        
            'Battle Rope Tabata': 'Perform any rope exercise in Tabata format: 20 seconds work, 10 seconds rest for 8 rounds.',

            // === TRX EXERCISES ===
            
            'TRX Rows': 'Hold TRX handles and lean back. Pull body toward anchor point by driving elbows back. Adjust difficulty by changing body angle.',        
            'TRX Push-ups': 'Place hands in TRX handles and perform push-ups. Instability increases challenge.',         
            'TRX Chest Press': 'Face away from anchor and press handles forward. Lean forward to increase difficulty.',         
            'TRX Y-Pulls': 'Pull handles apart and up to form Y shape with arms. Targets rear deltoids and rhomboids.',         
            'TRX T-Pulls': 'Pull handles apart to form T shape with arms at shoulder height.',        
            'TRX Face Pulls': 'Pull handles to face level with elbows high.',        
            'TRX Rear Delt Flye': 'Pull handles apart while squeezing shoulder blades together.',        
            'TRX Bicep Curls': 'Face anchor and curl handles toward shoulders while leaning back.',         
            'TRX Tricep Press': 'Face away from anchor and press handles down by extending elbows.',         
            'TRX Squats': 'Hold handles while performing squats. TRX provides assistance or challenge.',         
            'TRX Lunges': 'Hold handles during lunges for stability or added challenge.',         
            'TRX Single Leg Squats': 'Perform single leg squats while holding TRX for balance.',         
            'TRX Jump Squats': 'Perform jump squats while holding TRX handles.',           
            'TRX Hamstring Curls': 'Lie on back with heels in foot cradles. Curl heels toward glutes.',          
            'TRX Hip Press': 'Place feet in foot cradles and perform hip thrusts.',         
            'TRX Single Leg Glute Bridge': 'Perform single leg glute bridges with one foot in foot cradle.',         
            'TRX Side Lunge': 'Perform lateral lunges while holding TRX handles.',        
            'TRX Single Leg Deadlift': 'Perform single leg deadlifts while holding TRX for balance.',         
            'TRX Pikes': 'Start in plank with feet in foot cradles. Pike hips up toward ceiling.',         
            'TRX Mountain Climbers': 'Perform mountain climbers with feet in foot cradles.',         
            'TRX Knee Tucks': 'Start in plank with feet in foot cradles. Bring knees toward chest.',         
            'TRX Oblique Crunches': 'Bring knees to one side then other for oblique targeting.',         
            'TRX Plank': 'Hold plank position with feet suspended in foot cradles.',         
            'TRX Side Plank': 'Perform side plank with feet in foot cradles for added challenge.',

            // Default instruction for any unlisted exercises
            'Default': 'This exercise requires specific technique instruction. Focus on controlled movement through the full range of motion, maintaining proper posture throughout. Breathe steadily and concentrate on the target muscles. Start with lighter resistance or reduced intensity to learn proper form. If you\'re unfamiliar with this exercise, consider consulting a qualified fitness professional for personalized instruction and safety guidance.'
        };
            

        // Weight training phases
        const weightPhases = {
            "hypertrophy": {"percentages": [0.65, 0.7, 0.75], "sets_reps": [[4,12], [5,8], [6,8]]},
            "strength": {"percentages": [0.75, 0.8, 0.85], "sets_reps": [[4,6], [5,5], [5,4]]},
            "power": {"percentages": [0.85, 0.9, 0.95], "sets_reps": [[3,4], [4,3], [5,2]]},
            "deload": {"percentages": [0.5, 0.6], "sets_reps": [[2,8], [3,5]]}
        };

        const workoutTypeToPhase = {
            "Strength Training": "strength",
            "Powerlifting": "strength", 
            "Bodybuilding": "hypertrophy",
            "HIIT": "power",
            "CrossFit": "power",
            "Functional Training": "strength",
            "Circuit Training": "hypertrophy"
        };

        // METS values for calorie calculation
        const workoutMETS = {
            "Strength Training": 5.0,
            "HIIT": 10.0,
            "Cardio": 8.5,
            "Yoga": 3.0,
            "Pilates": 4.5,
            "CrossFit": 12.0,
            "Powerlifting": 6.0,
            "Bodybuilding": 5.5,
            "Calisthenics": 6.5,
            "Functional Training": 7.0,
            "Circuit Training": 9.0,
            "Endurance": 8.0,
            "Flexibility": 2.5,
            "Core": 4.0
        };

        // Calculate calories burned
        function calculateCalories(workoutType, durationMinutes, difficulty = 'Intermediate') {
            if (!userBody.weight || userBody.weight <= 0) {
                const baseCalories = workoutType === 'HIIT' || workoutType === 'Cardio' ? 10 : 
                                  workoutType === 'Strength Training' ? 8 : 5;
                return Math.floor(durationMinutes * baseCalories * 
                       (difficulty === 'Advanced' ? 1.2 : 
                        difficulty === 'Beginner' ? 0.8 : 1));
            }
            
            const weightInKg = userBody.weight * 0.453592;
            const mets = workoutMETS[workoutType] || 5.0;
            
            const difficultyMultiplier = difficulty === 'Advanced' ? 1.2 : 
                                       difficulty === 'Beginner' ? 0.8 : 1.0;
            const adjustedMets = mets * difficultyMultiplier;
            
            const calories = (durationMinutes * adjustedMets * 3.5 * weightInKg) / 200;
            
            return Math.floor(calories);
        }

        // Predefined workouts
        const predefinedWorkouts = [
            {
                id: 1,
                name: "Morning Energy Blast",
                type: "HIIT",
                duration: 15,
                difficulty: "Beginner",
                equipment: ["Bodyweight"],
                calories: 150,
                muscleGroups: ["Full Body"],
                exercises: [
                    { name: "Jumping Jacks", duration: 45, rest: 15 },
                    { name: "Push-ups", duration: 30, rest: 15, reps: "8-12", sets: 2 },
                    { name: "Squats", duration: 45, rest: 15, reps: "12-15", sets: 2 },
                    { name: "Mountain Climbers", duration: 30, rest: 15 },
                    { name: "Plank", duration: 30, rest: 60 }
                ]
            },
            {
                id: 2,
                name: "Strength Builder Pro",
                type: "Strength Training",
                duration: 45,
                difficulty: "Intermediate",
                equipment: ["Dumbbells", "Bench"],
                calories: 300,
                muscleGroups: ["Upper Body"],
                exercises: [
                    { name: "Dumbbell Bench Press", rest: 90, reps: "8-10", sets: 3, weight: "50-60 lbs" },
                    { name: "Bent-over Rows", rest: 90, reps: "8-10", sets: 3, weight: "40-50 lbs" },
                    { name: "Overhead Press", rest: 90, reps: "6-8", sets: 3, weight: "30-40 lbs" },
                    { name: "Bicep Curls", rest: 60, reps: "10-12", sets: 3, weight: "20-25 lbs" }
                ]
            },
            {
                id: 3,
                name: "Core Destroyer",
                type: "Core",
                duration: 20,
                difficulty: "Intermediate",
                equipment: ["Bodyweight"],
                calories: 100,
                muscleGroups: ["Core/Abs"],
                exercises: [
                    { name: "Plank", duration: 45, rest: 15, sets: 3 },
                    { name: "Russian Twists", duration: 30, rest: 15, reps: "20", sets: 3 },
                    { name: "Bicycle Crunches", duration: 30, rest: 15, reps: "15", sets: 3 },
                    { name: "Dead Bug", duration: 45, rest: 15, reps: "10", sets: 2 }
                ]
            }
        ];

        // Wake lock functions
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake lock activated');
                }
            } catch (err) {
                console.log('Wake lock failed:', err);
            }
        }

        function releaseWakeLock() {
            if (wakeLock) {
                wakeLock.release();
                wakeLock = null;
                console.log('Wake lock released');
            }
        }

        // Workout calories and minutes tracking
        function updateWorkoutCaloriesAndMinutes() {
            const today = new Date().toDateString();
            
            dailyCalories = 0;
            dailyMinutes = 0;
            
            if (workoutHistory.length > 0) {
                const todaysWorkouts = workoutHistory.filter(w => {
                    const workoutDate = new Date(w.completedAt).toDateString();
                    return workoutDate === today;
                });
                
                dailyCalories = todaysWorkouts.reduce((sum, w) => sum + (w.calories || 0), 0);
                dailyMinutes = todaysWorkouts.reduce((sum, w) => sum + Math.floor(w.totalTime / 60), 0);
            }
            
            localStorage.setItem('fitflow-workout-calories', dailyCalories.toString());
            localStorage.setItem('fitflow-workout-minutes', dailyMinutes.toString());
            localStorage.setItem('fitflow-workout-date', today);
        }

        function getWorkoutCalories() {
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('fitflow-workout-date');
            
            if (savedDate === today) {
                return parseInt(localStorage.getItem('fitflow-workout-calories') || '0');
            }
            
            updateWorkoutCaloriesAndMinutes();
            return dailyCalories;
        }

        function getWorkoutMinutes() {
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('fitflow-workout-date');
            
            if (savedDate === today) {
                return parseInt(localStorage.getItem('fitflow-workout-minutes') || '0');
            }
            
            updateWorkoutCaloriesAndMinutes();
            return dailyMinutes;
        }

        // Initialize app
        async function init() {
            workouts = predefinedWorkouts;
            loadData();
            updateWorkoutCaloriesAndMinutes();
            refreshWorkoutData();
            showTab('home');
            startTimerLoop();
        }

        // Load/save data
        function loadData() {
            try {
                const savedHistory = localStorage.getItem('fitflow-history');
                const savedStats = localStorage.getItem('fitflow-stats');
                const savedCustom = localStorage.getItem('fitflow-custom');
                const savedWeights = localStorage.getItem('fitflow-weights');
                const savedExerciseHistory = localStorage.getItem('fitflow-exercise-history');
                const savedProgressiveOverload = localStorage.getItem('fitflow-progressive-overload');
                const savedUserBody = localStorage.getItem('fitflow-user-body');
                
                if (savedHistory) workoutHistory = JSON.parse(savedHistory);
                if (savedStats) userStats = JSON.parse(savedStats);
                if (savedCustom) customWorkouts = JSON.parse(savedCustom);
                if (savedWeights) userWeights = JSON.parse(savedWeights);
                if (savedExerciseHistory) exerciseHistory = JSON.parse(savedExerciseHistory);
                if (savedProgressiveOverload) progressiveOverload = JSON.parse(savedProgressiveOverload);
                if (savedUserBody) userBody = JSON.parse(savedUserBody);
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }

        function saveData() {
            try {
                const data = {
                    history: workoutHistory,
                    stats: userStats,
                    custom: customWorkouts,
                    weights: userWeights,
                    exerciseHistory: exerciseHistory,
                    progressiveOverload: progressiveOverload,
                    userBody: userBody
                };
                
                // Check if we're approaching localStorage limit
                const dataString = JSON.stringify(data);
                if (dataString.length > 4000000) { // ~4MB limit warning
                    console.warn('Data approaching localStorage limit');
                    // Trim old workout history if needed
                    if (workoutHistory.length > 100) {
                        workoutHistory = workoutHistory.slice(0, 50);
                    }
                }
                
                localStorage.setItem('fitflow-history', JSON.stringify(workoutHistory));
                localStorage.setItem('fitflow-stats', JSON.stringify(userStats));
                localStorage.setItem('fitflow-custom', JSON.stringify(customWorkouts));
                localStorage.setItem('fitflow-weights', JSON.stringify(userWeights));
                localStorage.setItem('fitflow-exercise-history', JSON.stringify(exerciseHistory));
                localStorage.setItem('fitflow-progressive-overload', JSON.stringify(progressiveOverload));
                localStorage.setItem('fitflow-user-body', JSON.stringify(userBody));
            } catch (e) {
                console.error('Error saving data:', e);
                if (e.name === 'QuotaExceededError') {
                    showNotification('Storage full. Some data may not be saved.', 'error');
                }
            }
        }

        // Refresh workout data
        function refreshWorkoutData() {
            customWorkouts.forEach(workout => {
                if (workout.custom || workout.aiGenerated) {
                    workout.calories = calculateCalories(workout.type, workout.duration, workout.difficulty);
                }
            });
            
            workouts.forEach(workout => {
                workout.calories = calculateCalories(workout.type, workout.duration, workout.difficulty);
            });
            
            updateAIWorkoutWeights();
            saveData();
        }

        // Find trending workout
        function getTrendingWorkout(allWorkouts) {
            const threeDaysAgo = new Date(Date.now() - 3 * 24 * 60 * 60 * 1000);
            
            const availableWorkouts = allWorkouts.filter(workout => {
                const lastDone = workoutHistory.find(h => h.name === workout.name);
                if (!lastDone) return true;
                const lastDoneDate = new Date(lastDone.completedAt);
                return lastDoneDate < threeDaysAgo;
            });
            
            const workoutsToChooseFrom = availableWorkouts.length > 0 ? availableWorkouts : allWorkouts;
            
            if (workoutsToChooseFrom.length === 0) return null;
            
            return workoutsToChooseFrom[Math.floor(Math.random() * workoutsToChooseFrom.length)];
        }

        // Timer functions
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        let timerInterval = null;

        function startTimerLoop() {
            // Clear any existing timer to prevent multiple intervals
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            timerInterval = setInterval(() => {
                // Only run timer logic when workout is actually active
                if (workoutInProgress && currentWorkout && currentWorkout.exercises) {
                    // Main timer always runs during workout (including rest)
                    if (workoutInProgress) {
                        timer++;
                    }
                    
                    if (isTimerRunning && !isResting) {
                        exerciseTimer++;
                        updateTimerDisplay();
                        
                        if (!manualSkip && exerciseTimeLimit > 0 && exerciseTimer >= exerciseTimeLimit) {
                            completeExercise();
                        }
                    }
                    if (isResting && restTimer > 0) {
                        restTimer--;
                        updateRestTimerDisplay(); // Make sure this updates the display
                        
                        if (restTimer <= 0) {
                            playDingSound();
                            isResting = false;
                            isTimerRunning = true;
                            exerciseTimer = 0;
                            
                            // Announce next exercise WITHOUT "Next exercise:" prefix
                            const nextExercise = currentWorkout.exercises[currentExercise];
                            if (nextExercise) {
                                const exerciseName = (isInSuperset && supersetPhase === 'partner') ? 
                                    nextExercise.superset.name : nextExercise.name;
                                // Use custom message flag to avoid "Next exercise:" prefix
                                announceExercise(exerciseName, false, true);
                            }
                            
                            if (currentTab === 'workout') {
                                showWorkoutTab();
                                setTimeout(() => {
                                    const content = document.getElementById('content');
                                    if (content) {
                                        content.scrollTo({ top: 0, behavior: 'smooth' });
                                    }
                                }, 100);
                            }
                        }
                    }
                    
                    // Always update timer display
                    updateTimerDisplay();
                }
            }, 1000);
        }

        // Add this new function for text-to-speech announcements
        function announceExercise(exerciseName, isRest = false, isCustomMessage = false) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                speechSynthesis.cancel();
                
                let message = '';
                
                // More explicit logic
                if (isCustomMessage === true) {
                    // Use exactly what was passed in
                    message = exerciseName;
                } else if (isRest === true) {
                    message = `Rest time. ${restTimer} seconds.`;
                } else {
                    // Default case - add "Next exercise:" prefix
                    const cleanName = exerciseName
                        .replace(/[-_]/g, ' ')
                        .replace(/([A-Z])/g, ' $1')
                        .replace(/\s+/g, ' ')
                        .trim();
                    message = `Next exercise: ${cleanName}`;
                }
                
                const utterance = new SpeechSynthesisUtterance(message);
                utterance.rate = 1.3;
                utterance.volume = 0.8;
                utterance.pitch = 1.1;
                
                const voices = speechSynthesis.getVoices();
                const preferredVoices = [
                    voices.find(voice => voice.name.includes('Samantha')),
                    voices.find(voice => voice.name.includes('Karen')),
                    voices.find(voice => voice.name.includes('Susan')),
                    voices.find(voice => voice.name.includes('Zira')),
                    voices.find(voice => voice.name.includes('Victoria')),
                ].filter(Boolean);
                
                if (preferredVoices.length > 0) {
                    utterance.voice = preferredVoices[0];
                }
                
                speechSynthesis.speak(utterance);
            }
        }

        function testVoices() {
            if ('speechSynthesis' in window) {
                const voices = speechSynthesis.getVoices();
                console.log('Available voices:');
                voices.forEach((voice, index) => {
                    console.log(`${index}: ${voice.name} (${voice.lang})`);
                });
                
                // Test the selected voice
                const testUtterance = new SpeechSynthesisUtterance('Hey there, ready for your workout?');
                testUtterance.rate = 1.3;
                testUtterance.pitch = 1.1;
                
                const femaleVoice = voices.find(voice => voice.name.includes('Samantha') || voice.name.includes('Karen'));
                if (femaleVoice) {
                    testUtterance.voice = femaleVoice;
                }
                
                speechSynthesis.speak(testUtterance);
            }
        }

        function updateTimerDisplay() {
            const display = document.querySelector('.timer');
            if (display) display.textContent = formatTime(timer);
        }

        function updateRestTimerDisplay() {
            const display = document.querySelector('.rest-timer');
            if (display) display.textContent = formatTime(restTimer);
        }

        // Navigation
        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-item').forEach((item, index) => {
                item.classList.remove('active');
                if ((tab === 'home' && index === 0) || 
                    (tab === 'workout' && index === 1) || 
                    (tab === 'profile' && index === 2)) {
                    item.classList.add('active');
                }
            });
            
            switch(tab) {
                case 'home': showHomeTab(); break;
                case 'workout': showWorkoutTab(); break;
                case 'profile': showProfileTab(); break;
            }
            
            setTimeout(() => {
                const content = document.getElementById('content');
                if (content) {
                    content.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }, 50);
        }

        function scrollToWorkoutsSection() {
            showTab('home');
            setTimeout(() => {
                const workoutsSection = document.querySelector('.trending-section') || 
                                       document.querySelector('h3[style*="All Workouts"]') ||
                                       document.querySelector('.workouts-container');
                if (workoutsSection) {
                    workoutsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        // Home tab
        function showHomeTab() {
            const allWorkouts = [...workouts, ...customWorkouts];
            const content = document.getElementById('content');
            const trendingWorkout = getTrendingWorkout(allWorkouts);
            
            const displayCalories = getWorkoutCalories();
            const displayMinutes = getWorkoutMinutes();
            
            content.innerHTML = `
                <div class="header">
                        <h1>Dashboard</h1>
                </div>
                
                <div class="dashboard-stats">
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${displayCalories}</div>
                            <div class="stat-label">Calories Burned</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${displayMinutes}</div>
                            <div class="stat-label">Minutes Exercised</div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="margin-top: 32px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px;">
                            <button class="btn btn-ai" onclick="showAIWorkoutModal()">
                                AI Workout
                            </button>
                            <button class="btn btn-custom" onclick="showCreateWorkoutModal()">
                                Custom
                            </button>
                        </div>

                        ${trendingWorkout ? `
                            <div style="margin-bottom: 24px;">
                                <h3 style="margin-bottom: 16px; color: #ffffff; font-size: 18px; font-weight: 700;">Trending for You</h3>
                                <div class="card" style="border: 2px solid #667eea;">
                                    <div class="workout-title">${trendingWorkout.name}</div>
                                    <div class="workout-info">
                                        <div>${trendingWorkout.type}</div>
                                        <div>${trendingWorkout.duration} min</div>
                                        <div>${trendingWorkout.muscleGroups ? trendingWorkout.muscleGroups[0] : 'Full Body'}</div>
                                        <div>${trendingWorkout.difficulty}</div>
                                    </div>
                                    <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 12px;">
                                        Equipment: ${Array.isArray(trendingWorkout.equipment) ? trendingWorkout.equipment[0] : trendingWorkout.equipment} • ~${trendingWorkout.calories} cal
                                    </div>
                                    <button class="btn btn-start" onclick="startWorkout(${trendingWorkout.id})">
                                        Start Trending Workout
                                    </button>
                                </div>
                            </div>
                        ` : ''}

                        <h3 style="margin-bottom: 16px; color: #ffffff; font-size: 18px; font-weight: 700;">All Workouts</h3>
                        
                        <div class="workouts-container">
                            ${allWorkouts.map(workout => `
                                <div class="card">
                                    <div class="workout-title">
                                        ${workout.name}
                                        ${workout.custom ? `<button onclick="deleteWorkout(${workout.id})" style="background: none; border: none; color: #ef4444; cursor: pointer; float: right; font-size: 18px; position: absolute; right: 20px; top: 20px;">×</button>` : ''}
                                    </div>
                                   <div class="workout-info">
                                        <div>${workout.type}</div>
                                        <div>${workout.duration} min</div>
                                        <div>${workout.muscleGroups ? workout.muscleGroups[0] : 'Full Body'}</div>
                                        <div>${workout.difficulty}</div>
                                    </div>
                                    <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 12px;">
                                        Equipment: ${Array.isArray(workout.equipment) ? workout.equipment[0] : workout.equipment} • ~${workout.calories} cal
                                    </div>
                                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                        <button class="btn btn-view" onclick="showWorkoutDetails(${workout.id})" style="flex: 1; min-width: 70px;">View</button>
                                        ${workout.custom || workout.aiGenerated ? `<button class="btn btn-edit" onclick="editWorkout(${workout.id})" style="flex: 1; min-width: 70px;">Edit</button>` : ''}
                                        ${workout.custom || workout.aiGenerated ? `<button class="btn btn-share" onclick="showShareModal(${workout.id})" style="flex: 1; min-width: 70px;">Share</button>` : ''}
                                        <button class="btn btn-start" onclick="startWorkout(${workout.id})" style="flex: 1; min-width: 70px;">Start</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function getExerciseInstruction(exerciseName) {
            // Clean the exercise name for lookup
            const cleanName = exerciseName.trim();
            
            // First try exact match
            if (exerciseInstructions[cleanName]) {
                return exerciseInstructions[cleanName];
            }
            
            // Try partial matching for variations
            const partialMatch = Object.keys(exerciseInstructions).find(key => 
                key.toLowerCase().includes(cleanName.toLowerCase()) ||
                cleanName.toLowerCase().includes(key.toLowerCase())
            );
            
            if (partialMatch) {
                return exerciseInstructions[partialMatch];
            }
            
            // Return default instruction
            return exerciseInstructions['Default'];
        }

        // Workout tab - Enhanced with better UX
        function showWorkoutTab() {
            const content = document.getElementById('content');
            
            if (!workoutInProgress || !currentWorkout) {
                content.innerHTML = `
                    <div class="header">
                        <h1>FitFlow</h1>
                        <p>Your Personal Workout Companion</p>
                    </div>
                    <div class="workout-active">
                        <div class="workout-hero">
                            <h2 style="margin-bottom: 16px; position: relative; z-index: 1;">Ready to Workout?</h2>
                            <p style="opacity: 0.8; margin-bottom: 24px; position: relative; z-index: 1;">Select a workout from the home screen to begin your fitness journey!</p>
                        </div>
                        <button class="btn-browse-workouts" onclick="scrollToWorkoutsSection()">Browse Workouts</button>
                    </div>
                `;
                return;
            }

            const exercise = currentWorkout.exercises[currentExercise];
            if (!exercise) {
                console.error('No exercise found at index:', currentExercise);
                return;
            }
            
            const progress = ((currentExercise + 1) / currentWorkout.exercises.length) * 100;
            const totalSets = exercise.sets || 1;
            const setsRemaining = totalSets - currentSet + 1;

            // Determine current exercise info (main or superset partner)
            const isSuperset = exercise.superset && exercise.superset.name;
            const currentExerciseName = (isInSuperset && supersetPhase === 'partner') ? 
                exercise.superset.name : exercise.name;
            const currentInstruction = getExerciseInstruction(currentExerciseName);

            // Auto-scale exercise name font size
            let exerciseNameEl = `<div class="exercise-name-right" id="exerciseNameEl">${currentExerciseName}</div>`;

            if (isResting) {
                // Simple rest screen without gradient card
                const restDiv = document.createElement('div');
                restDiv.className = 'rest-active';
                restDiv.id = 'restScreen';
                
                const isRestingBetweenSets = currentSet <= totalSets;
                const actualSetsRemaining = isRestingBetweenSets ? (totalSets - currentSet + 1) : 0;
                const nextExercise = currentWorkout.exercises[currentExercise + 1];
                
                restDiv.innerHTML = `
                    <div style="padding: 80px 20px 20px; text-align: center; min-height: 100vh; display: flex; flex-direction: column; justify-content: center;">
                        <h1 style="font-size: clamp(24px, 6vw, 32px); margin-bottom: 20px; color: white;">${currentWorkout.name}</h1>
                        
                        <div style="margin-bottom: 30px;">
                            <div class="progress-bar" style="margin-bottom: 10px;">
                                <div class="progress-fill" style="width: ${progress}%;"></div>
                            </div>
                            <p style="color: rgba(255, 255, 255, 0.8); font-weight: 600; margin: 0;">
                                Exercise ${currentExercise + (isRestingBetweenSets ? 1 : 2)} of ${currentWorkout.exercises.length}
                            </p>
                        </div>
                        
                        <h2 style="font-size: clamp(20px, 5vw, 28px); margin-bottom: 10px; color: white;">Rest Time</h2>
                        <div class="rest-timer" style="font-size: clamp(48px, 15vw, 72px); font-weight: 800; margin: 20px 0; color: white;">
                            ${formatTime(restTimer)}
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 12px; border-radius: 12px; margin-bottom: 16px;">
                            <div style="font-size: 14px; color: rgba(255, 255, 255, 0.8); margin-bottom: 4px;">Total Workout Time</div>
                            <div style="font-size: 18px; font-weight: bold; color: white;">${formatTime(timer)}</div>
                        </div>
                        
                        ${isRestingBetweenSets && actualSetsRemaining > 0 ? `
                            <div style="background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%); padding: 20px; border-radius: 16px; margin-bottom: 24px; border: 1px solid rgba(255, 255, 255, 0.1);">
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px; color: white;">
                                    ${actualSetsRemaining} set${actualSetsRemaining > 1 ? 's' : ''} remaining
                                </div>
                                <div style="font-size: 16px; opacity: 0.9; color: rgba(255, 255, 255, 0.7);">
                                    ${isSuperset ? `${exercise.name} + ${exercise.superset.name}` : exercise.name}
                                </div>
                            </div>
                        ` : !isRestingBetweenSets && nextExercise ? `
                            <div style="background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%); padding: 20px; border-radius: 16px; margin-bottom: 24px; border: 1px solid rgba(255, 255, 255, 0.1);">
                                <div style="font-size: 16px; font-weight: bold; margin-bottom: 8px; color: white;">
                                    Moving to next exercise
                                </div>
                                <div style="font-size: 14px; opacity: 0.8; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7);">Up Next:</div>
                                <div style="font-size: 18px; font-weight: 700; color: white;">
                                    ${nextExercise.name}${nextExercise.superset ? ` + ${nextExercise.superset.name}` : ''}
                                </div>
                            </div>
                        ` : `
                            <div style="background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%); padding: 20px; border-radius: 16px; margin-bottom: 24px; border: 1px solid rgba(255, 255, 255, 0.1);">
                                <div style="font-size: 18px; font-weight: bold; color: white;">
                                    Workout Complete!
                                </div>
                            </div>
                        `}
                        
                        <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                            <button class="rest-skip-btn" onclick="skipRest()" style="flex: 1;">
                                Skip Rest
                            </button>
                            <button class="rest-skip-btn" onclick="addRestTime()" style="flex: 1; background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">
                                +30s
                            </button>
                        </div>
                        
                        <button class="btn-end-workout" onclick="confirmEndWorkout()" style="width: auto; margin: 0 auto;">
                            End Workout
                        </button>
                    </div>
                `;
                
                // Remove existing rest screen if any
                const existingRest = document.getElementById('restScreen');
                if (existingRest) {
                    existingRest.remove();
                }
                
                document.body.appendChild(restDiv);
                
                // Update main content to empty since rest screen is overlaid
                content.innerHTML = '';
            } else {
                // Remove rest screen if it exists
                const existingRest = document.getElementById('restScreen');
                if (existingRest) {
                    existingRest.remove();
                }
                
                // Count detail cards and build HTML
                let detailCardCount = 0;
                let detailCardsHTML = '';

                if (exercise.duration) {
                    detailCardCount++;
                    detailCardsHTML += `
                        <div class="detail-card">
                            <strong style="font-size: 24px; color: #ffffff;">${exercise.duration}s</strong><br>
                            <span style="font-size: 12px; color: rgba(255,255,255,0.7); font-weight: 600;">Duration</span>
                        </div>
                    `;
                }

                if (exercise.reps) {
                    detailCardCount++;
                    detailCardsHTML += `
                        <div class="detail-card">
                            <strong style="font-size: 24px; color: #ffffff;">${(isInSuperset && supersetPhase === 'partner') ? exercise.superset.reps : exercise.reps}</strong><br>
                            <span style="font-size: 12px; color: rgba(255,255,255,0.7); font-weight: 600;">Reps</span>
                        </div>
                    `;
                }

                if (totalSets > 1) {
                    detailCardCount++;
                    detailCardsHTML += `
                        <div class="detail-card">
                            <strong style="font-size: 24px; color: #ffffff;">${setsRemaining}</strong><br>
                            <span style="font-size: 12px; color: rgba(255,255,255,0.7); font-weight: 600;">Sets Left</span>
                        </div>
                    `;
                }

                if (exercise.rest > 0) {
                    detailCardCount++;
                    detailCardsHTML += `
                        <div class="detail-card">
                            <strong style="font-size: 24px; color: #ffffff;">${exercise.rest}s</strong><br>
                            <span style="font-size: 12px; color: rgba(255,255,255,0.7); font-weight: 600;">Rest</span>
                        </div>
                    `;
                }

                if (exercise.weight || (isSuperset && exercise.superset.weight)) {
                    detailCardCount++;
                    const displayWeight = (isInSuperset && supersetPhase === 'partner') ? exercise.superset.weight : exercise.weight;
                    detailCardsHTML += `
                        <div class="detail-card">
                            <strong style="font-size: 20px; color: #ffffff;">${displayWeight}</strong><br>
                            <span style="font-size: 12px; color: rgba(255,255,255,0.7); font-weight: 600;">Weight</span>
                        </div>
                    `;
                }

                const gridClass = detailCardCount === 4 ? 'exercise-details four-cards' : 'exercise-details';
                
                content.innerHTML = `
                    <div class="workout-active">
                        <div class="workout-header">
                            <button class="back-button" onclick="confirmEndWorkout()">
                                <span class="icon">←</span>
                                Back
                            </button>
                            ${exerciseNameEl}
                        </div>
                        
                        <div style="padding: 80px 20px 20px; text-align: center;">
                            <div class="timer" style="color: #ffffff; text-align: center; margin-bottom: 20px; font-size: 48px; font-weight: 700;">${formatTime(timer)}</div>
                            
                            <div class="progress-bar" style="margin-bottom: 20px;">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            
                            <div class="exercise-instructions">
                                <h4>
                                    <span style="background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                                        ${isSuperset ? `Superset ${supersetPhase === 'main' ? 'A' : 'B'}: ` : ''}How to Perform
                                    </span>
                                </h4>
                                <p>${currentInstruction}</p>
                                ${isSuperset ? `
                                    <div style="background: rgba(102, 126, 234, 0.1); padding: 12px; border-radius: 8px; margin-top: 12px; border-left: 4px solid #667eea;">
                                        <strong>Superset:</strong> ${exercise.name} → ${exercise.superset.name}
                                        <br><small>Complete both exercises back-to-back, then rest</small>
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${totalSets > 1 ? `
                                <div style="text-align: center; margin-bottom: 20px;">
                                    <div class="set-indicator">
                                        ${Array.from({length: totalSets}, (_, i) => `
                                            <div class="set-dot ${i < currentSet - 1 ? 'completed' : i === currentSet - 1 ? 'current' : ''}"
                                                style="width: 16px; height: 16px;"></div>
                                        `).join('')}
                                    </div>
                                    <p style="color: #ffffff; margin-top: 8px; font-weight: 600; font-size: 18px;">
                                        Set ${currentSet} of ${totalSets}
                                    </p>
                                </div>
                            ` : ''}
                            
                            <div class="${gridClass}" style="margin-bottom: 24px;">
                                ${detailCardsHTML}
                            </div>
                            
                            <div style="display: flex; gap: 16px; align-items: center; justify-content: center; margin-bottom: 20px; width: 100%; padding: 0 20px; box-sizing: border-box;">
                                <button class="btn-control" onclick="previousExercise()" ${currentExercise === 0 ? 'disabled style="opacity: 0.5; width: 70px;"' : 'style="width: 70px;"'}>
                                    Prev
                                </button>
                                <button class="btn-play"
                                        style="width: 70px; height: 70px; font-size: 30px; position: relative; flex-shrink: 0;"
                                        onclick="toggleTimer()">
                                    ${isTimerRunning ? '||' : '▶'}
                                </button>
                                <button class="btn-control" onclick="nextExercise()" ${currentExercise >= currentWorkout.exercises.length - 1 ? 'disabled style="opacity: 0.5; width: 70px;"' : 'style="width: 70px;"'}>
                                    Next
                                </button>
                            </div>
                            
                            <button class="btn-complete-exercise" onclick="completeExercise()">
                                Complete ${isSuperset ? 
                                    (supersetPhase === 'main' ? 'Exercise A' : 'Exercise B (Superset)') : 
                                    (totalSets > 1 ? 'Set' : 'Exercise')}
                            </button>
                            
                            <div style="display: flex; gap: 12px; margin-top: 12px;">
                                <button onclick="confirmEndWorkout()" class="btn-end-workout" style="flex: 1;">
                                    End Workout
                                </button>
                                <button onclick="showWorkoutSettings()" class="btn-control" style="flex: 0 0 auto; padding: 12px;">
                                    ⚙️
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Auto-scale font size if text is too long
                setTimeout(() => {
                    const nameEl = document.getElementById('exerciseNameEl');
                    if (nameEl) {
                        const container = nameEl.parentElement;
                        const maxWidth = container.offsetWidth - 160;
                        
                        if (nameEl.scrollWidth > maxWidth) {
                            const scale = maxWidth / nameEl.scrollWidth;
                            const currentSize = parseFloat(window.getComputedStyle(nameEl).fontSize);
                            const newSize = Math.max(14, Math.floor(currentSize * scale));
                            nameEl.style.fontSize = `${newSize}px`;
                        }
                    }
                }, 10);
            }
        }

        // Profile tab
        function showProfileTab() {
            const content = document.getElementById('content');
            
            content.innerHTML = `
                <div class="header">
                    <h1>FitFlow</h1>
                    <p>Your Personal Workout Companion</p>
                </div>
                <div style="padding: 20px;">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${userStats.totalWorkouts}</div>
                            <div class="stat-label">Total Workouts</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${Math.floor(userStats.totalTime / 60)}</div>
                            <div class="stat-label">Total Minutes</div>
                        </div>
                    </div>

                    ${userStats.streak > 0 ? `
                        <div style="background: linear-gradient(135deg, #f59e0b, #dc2626); 
                                    color: white; 
                                    padding: 24px; 
                                    border-radius: 20px; 
                                    margin-bottom: 20px;
                                    text-align: center;
                                    position: relative;
                                    overflow: hidden;">
                            <div style="position: absolute; top: 0; right: 0; width: 80px; height: 80px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                            <div style="font-size: 36px; font-weight: bold; position: relative; z-index: 1;">${userStats.streak} Day${userStats.streak > 1 ? 's' : ''}</div>
                            <div style="font-size: 14px; opacity: 0.9; position: relative; z-index: 1;">Current Streak</div>
                        </div>
                    ` : ''}

                    <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); 
                                color: white; 
                                border-radius: 20px; 
                                padding: 24px; 
                                margin-bottom: 20px;
                                position: relative;
                                overflow: hidden;">
                        <div style="position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                        <h3 style="margin-bottom: 12px; display: flex; align-items: center; position: relative; z-index: 1;">Body Measurements</h3>
                        <p style="font-size: 14px; opacity: 0.9; margin-bottom: 16px; position: relative; z-index: 1;">
                            Enter your measurements for accurate calorie calculations
                        </p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 12px; backdrop-filter: blur(10px);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">Weight</div>
                                <div style="font-size: 20px; font-weight: bold;">
                                    ${userBody.weight > 0 ? `${userBody.weight} lbs` : 'Not set'}
                                </div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 12px; backdrop-filter: blur(10px);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">Height</div>
                                <div style="font-size: 20px; font-weight: bold;">
                                    ${userBody.height > 0 ? `${Math.floor(userBody.height/12)}'${userBody.height%12}"` : 'Not set'}
                                </div>
                            </div>
                        </div>
                        <button class="btn" style="background: white; color: #06b6d4; position: relative; z-index: 1;" onclick="showBodyModal()">
                            Update Measurements
                        </button>
                    </div>

                    <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); 
                                color: white; 
                                border-radius: 20px; 
                                padding: 24px; 
                                margin-bottom: 20px;
                                position: relative;
                                overflow: hidden;">
                        <div style="position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                        <h3 style="margin-bottom: 12px; display: flex; align-items: center; position: relative; z-index: 1;">Share & Import Workouts</h3>
                        <p style="font-size: 14px; opacity: 0.9; margin-bottom: 16px; position: relative; z-index: 1;">
                            Share your custom workouts or import workouts from other FitFlow users
                        </p>
                        <button class="btn" style="background: white; color: #06b6d4; margin-bottom: 8px; position: relative; z-index: 1;" onclick="showImportModal()">
                            Import Workout
                        </button>
                        <p style="font-size: 12px; opacity: 0.8; position: relative; z-index: 1;">
                            You can share individual workouts from the home screen using the Share button
                        </p>
                    </div>

                    <div style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); 
                                color: white; 
                                border-radius: 20px; 
                                padding: 24px; 
                                margin-bottom: 20px;
                                position: relative;
                                overflow: hidden;">
                        <div style="position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                        <h3 style="margin-bottom: 12px; display: flex; align-items: center; position: relative; z-index: 1;">Your Max Weights</h3>
                        <p style="font-size: 14px; opacity: 0.9; margin-bottom: 16px; position: relative; z-index: 1;">Track your personal records for AI recommendations</p>
                        <button class="btn" style="background: white; color: #f59e0b; position: relative; z-index: 1;" onclick="showWeightModal()">
                            Update Weights
                        </button>
                        ${Object.keys(userWeights).length > 0 ? `
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px;">
                                ${Object.entries(userWeights).slice(0, 4).map(([exercise, weight]) => `
                                    <div style="background: rgba(255, 255, 255, 0.2); padding: 12px; border-radius: 12px; backdrop-filter: blur(10px);">
                                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">${exercise}</div>
                                        <div style="font-size: 20px; font-weight: bold;">${weight} ${exercise.includes('Dumbbell') ? 'lbs/arm' : 'lbs'}</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>

                    <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
                                color: white; 
                                border-radius: 20px; 
                                padding: 24px; 
                                margin-bottom: 20px;
                                position: relative;
                                overflow: hidden;">
                        <div style="position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                        <h4 style="position: relative; z-index: 1;">Progressive Overload</h4>
                        <p style="font-size: 14px; opacity: 0.9; margin-bottom: 12px; position: relative; z-index: 1;">
                            ${progressiveOverload.enabled ? `Active: +${progressiveOverload.percentage}% every ${progressiveOverload.weeks} weeks` : 'Disabled - Enable to auto-increase weights'}
                        </p>
                        <button class="btn" style="background: white; color: #10b981; position: relative; z-index: 1;" onclick="showProgressiveOverloadModal()">
                            Configure
                        </button>
                    </div>

                    <h3 style="margin-bottom: 16px; color: #ffffff;">Recent Workouts</h3>
                    
                    ${workoutHistory.length === 0 ? `
                        <div style="text-align: center; padding: 40px; background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1);">
                            <h3 style="color: #ffffff; margin-bottom: 12px;">Ready to Start?</h3>
                            <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">Complete your first workout to begin tracking your fitness journey!</p>
                            <button class="btn" onclick="scrollToWorkoutsSection()">Start First Workout</button>
                        </div>
                    ` : workoutHistory.slice(0, 5).map(workout => `
                        <div class="card">
                            <div style="display: flex; justify-content: space-between;">
                                <div>
                                    <div class="workout-title">${workout.name}</div>
                                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">
                                        ${workout.type} • ${new Date(workout.completedAt).toLocaleDateString()}
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: #22c55e; font-weight: bold;">${formatTime(workout.totalTime)}</div>
                                    <div style="color: rgba(255, 255, 255, 0.5); font-size: 12px;">Duration</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}

                    <button class="btn btn-danger" style="margin-top: 20px;" onclick="resetProgress()">
                        Reset All Progress
                    </button>
                </div>
            `;
        }

        // Utility functions
        function previousExercise() {
            manualSkip = true;
            if (currentExercise > 0) {
                currentExercise--;
                currentSet = 1;
                exerciseTimer = 0;
                showWorkoutTab();
            }
        }

        function nextExercise() {
            manualSkip = true;
            completeExercise();
        }

        // Get recommended weight
        function getRecommendedWeight(exerciseName, currentWeight, workoutType = 'Strength Training', difficulty = 'Intermediate') {
            if (currentWeight) return currentWeight;
            
            const weightExercises = ['Dumbbell Bench Press', 'Bench Press', 'Bent-over Rows', 'Overhead Press', 
                                    'Bicep Curls', 'Squats', 'Deadlifts', 'Leg Press'];
            
            let matchedExercise = null;
            let maxWeight = 0;
            
            if (userWeights[exerciseName] && userWeights[exerciseName] > 0) {
                matchedExercise = exerciseName;
                maxWeight = userWeights[exerciseName];
            } else {
                for (let weightEx of weightExercises) {
                    if (userWeights[weightEx] && userWeights[weightEx] > 0) {
                        if (weightEx.includes('Dumbbell') && exerciseName.includes('Dumbbell')) {
                            if (exerciseName.toLowerCase().includes(weightEx.toLowerCase().replace('dumbbell ', ''))) {
                                matchedExercise = weightEx;
                                maxWeight = userWeights[weightEx];
                                break;
                            }
                        }
                        else if (!weightEx.includes('Dumbbell') && !exerciseName.includes('Dumbbell')) {
                            if (exerciseName.toLowerCase().includes(weightEx.toLowerCase())) {
                                matchedExercise = weightEx;
                                maxWeight = userWeights[weightEx];
                                break;
                            }
                        }
                    }
                }
            }
            
            if (!matchedExercise || !maxWeight) {
                return null;
            }
            
            let originalWeight = maxWeight;
            if (progressiveOverload.enabled && exerciseHistory[exerciseName] && exerciseHistory[exerciseName].count > 0) {
                const lastDone = new Date(exerciseHistory[exerciseName].lastDone);
                const weeksSince = Math.floor((new Date() - lastDone) / (1000 * 60 * 60 * 24 * 7));
                const increases = Math.floor(weeksSince / progressiveOverload.weeks);
                if (increases > 0) {
                    const multiplier = 1 + (progressiveOverload.percentage / 100 * increases);
                    maxWeight = Math.round(maxWeight * multiplier);
                }
            }
            
            const phase = workoutTypeToPhase[workoutType] || "strength";
            const phaseData = weightPhases[phase];
            
            let percentageIndex = 0;
            if (difficulty === 'Advanced') percentageIndex = phaseData.percentages.length - 1;
            else if (difficulty === 'Intermediate') percentageIndex = Math.floor(phaseData.percentages.length / 2);
            
            const percentage = phaseData.percentages[percentageIndex];
            let workingWeight = maxWeight * percentage;
            
            workingWeight = Math.round(workingWeight / 2.5) * 2.5;
            
            const dumbbellExercises = [
                'Dumbbell Bench Press', 'Dumbbell Rows', 'Dumbbell Press', 'Dumbbell Curls',
                'Dumbbell Flyes', 'Dumbbell Shoulder Press', 'Arnold Press', 'Bent-over Rows'
            ];
            const isDumbbell = exerciseName.includes('Dumbbell') || dumbbellExercises.some(ex => exerciseName.includes(ex));
            if (isDumbbell) {
                return `${workingWeight} lbs per arm`;
            }
            
            return `${workingWeight} lbs`;
        }

        // Workout functions
        function startWorkout(id) {
            const allWorkouts = [...workouts, ...customWorkouts];
            currentWorkout = allWorkouts.find(w => w.id === id || w.id == id);
            if (!currentWorkout) return;
            
            currentExercise = 0;
            currentSet = 1;
            workoutInProgress = true;
            timer = 0;
            exerciseTimer = 0;
            isTimerRunning = true;
            isResting = false;
            restTimer = 0;
            manualSkip = false;
            
            const firstExercise = currentWorkout.exercises[0];
            exerciseTimeLimit = firstExercise && firstExercise.duration ? firstExercise.duration : 0;
            
            requestWakeLock();
            
            // Hide nav bar during workout
            document.querySelector('.nav').classList.add('hidden');
            document.querySelector('.content').classList.add('nav-hidden');
            
            // Announce workout start and first exercise
            setTimeout(() => {
                announceExercise(`Starting workout: ${currentWorkout.name}. First exercise: ${firstExercise.name}`, false, true);
            }, 1000);
            
            showTab('workout');
            
            setTimeout(() => {
                const content = document.getElementById('content');
                if (content) {
                    content.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }, 100);
        }


        function toggleTimer() {
            if (isResting) return;
            isTimerRunning = !isTimerRunning;
            showWorkoutTab();
        }

        function completeExercise() {
            if (!currentWorkout || !currentWorkout.exercises || !workoutInProgress) {
                console.error('No current workout or exercises found');
                return;
            }
            
            const exercise = currentWorkout.exercises[currentExercise];
            if (!exercise) {
                console.error('No exercise found at current index:', currentExercise);
                return;
            }
            
            const totalSets = exercise.sets || 1;
            const isSuperset = exercise.superset && exercise.superset.name;
            
            // Handle superset logic
            if (isSuperset && !isInSuperset) {
                isInSuperset = true;
                supersetPhase = 'partner';
                exerciseTimer = 0;
                
                // Announce superset partner
                announceExercise(`Superset partner: ${exercise.superset.name}`);
                
                isResting = true;
                restTimer = 15;
                isTimerRunning = false;
                playDingSound();
                
                showWorkoutTab();
                return;
            }
            
            if (isInSuperset && supersetPhase === 'partner') {
                isInSuperset = false;
                supersetPhase = 'main';
                exerciseTimer = 0;
                
                if (currentSet < totalSets) {
                    currentSet++;
                    if (exercise.rest && exercise.rest > 0) {
                        // Set rest timer BEFORE announcing
                        restTimer = exercise.rest;
                        // Announce rest with next exercise info
                        const nextExerciseName = isInSuperset ? exercise.name : 
                                            (currentExercise < currentWorkout.exercises.length - 1 ? 
                                                currentWorkout.exercises[currentExercise].name : 'Workout complete');
                        announceExercise(`Rest. Next exercise: ${nextExerciseName}`, false, true);
                        isResting = true;
                        isTimerRunning = false;
                        playDingSound();
                    }
                } else {
                    if (currentExercise < currentWorkout.exercises.length - 1) {
                        currentExercise++;
                        currentSet = 1;
                        exerciseTimer = 0;
                        
                        const nextExercise = currentWorkout.exercises[currentExercise];
                        exerciseTimeLimit = nextExercise && nextExercise.duration ? nextExercise.duration : 0;
                        
                        if (exercise.rest && exercise.rest > 0) {
                            // Set rest timer BEFORE announcing
                            restTimer = exercise.rest;
                            // Same exercise, same/next set
                            const nextExerciseName = isSuperset ? `${exercise.name} set ${currentSet}` : `${exercise.name} set ${currentSet}`;
                            announceExercise(`Rest. Next exercise: ${nextExerciseName}`, false, true);
                            isResting = true;
                            isTimerRunning = false;
                            playDingSound();
                        }
                    } else {
                        completeWorkout();
                        return;
                    }
                }
                
                showWorkoutTab();
                return;
            }
            
            // Regular exercise logic
            if (currentSet < totalSets) {
                currentSet++;
                exerciseTimer = 0;
                if (exercise.rest && exercise.rest > 0) {
                    // Set rest timer BEFORE announcing
                    restTimer = exercise.rest;
                    // Get next exercise name
                    const nextExercise = currentWorkout.exercises[currentExercise];
                    const nextExerciseName = nextExercise ? nextExercise.name : 'Workout complete';
                    announceExercise(`Rest. Next exercise: ${nextExerciseName}`, false, true);
                    isResting = true;
                    isTimerRunning = false;
                    playDingSound();
                }
            } else {
                if (currentExercise < currentWorkout.exercises.length - 1) {
                    currentExercise++;
                    currentSet = 1;
                    exerciseTimer = 0;
                    
                    const nextExercise = currentWorkout.exercises[currentExercise];
                    exerciseTimeLimit = nextExercise && nextExercise.duration ? nextExercise.duration : 0;
                    
                    if (exercise.rest && exercise.rest > 0) {
                        // Set rest timer BEFORE announcing
                        restTimer = exercise.rest;
                        // Determine what's next
                        let nextExerciseName;
                        if (currentSet < totalSets) {
                            // Same exercise, next set
                            nextExerciseName = `${exercise.name} set ${currentSet}`;
                        } else if (currentExercise < currentWorkout.exercises.length - 1) {
                            // Next exercise
                            const nextExercise = currentWorkout.exercises[currentExercise];
                            nextExerciseName = nextExercise.name;
                        } else {
                            nextExerciseName = 'Workout complete';
                        }
                        announceExercise(`Rest. Next exercise: ${nextExerciseName}`, false, true);
                        isResting = true;
                        isTimerRunning = false;
                        playDingSound();
                    }
                } else {
                    // Announce workout completion
                    announceExercise('Workout complete! Great job!');
                    completeWorkout();
                    return;
                }
            }
            
            showWorkoutTab();
            
            setTimeout(() => {
                const content = document.getElementById('content');
                if (content) {
                    content.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }, 100);
        }

        function skipRest() {
            isResting = false;
            restTimer = 0;
            exerciseTimer = 0;
            isTimerRunning = true;
            showWorkoutTab();
            
            setTimeout(() => {
                const content = document.getElementById('content');
                if (content) {
                    content.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }, 100);
        }

        function completeWorkout() {
            const completedWorkout = {
                ...currentWorkout,
                completedAt: new Date().toISOString(),
                totalTime: timer,
                id: Date.now(),
                calories: calculateCalories(currentWorkout.type, currentWorkout.duration, currentWorkout.difficulty)
            };
            
            workoutHistory.unshift(completedWorkout);
            if (workoutHistory.length > 50) workoutHistory.pop();
            
            userStats.totalWorkouts++;
            userStats.totalTime += timer;
            
            updateWorkoutCaloriesAndMinutes();
            
            const today = new Date().toDateString();
            const lastWorkout = localStorage.getItem('fitflow-last-workout-date');
            const yesterday = new Date(Date.now() - 86400000).toDateString();
            
            if (lastWorkout === today) {
                // Already worked out today, don't increment streak
            } else if (lastWorkout === yesterday) {
                userStats.streak++;
            } else {
                userStats.streak = 1;
            }
            
            localStorage.setItem('fitflow-last-workout-date', today);
            
            currentWorkout.exercises.forEach(ex => {
                if (!exerciseHistory[ex.name]) {
                    exerciseHistory[ex.name] = { count: 0, lastDone: null, lastWeight: null };
                }
                exerciseHistory[ex.name].count++;
                exerciseHistory[ex.name].lastDone = new Date().toISOString();
                if (ex.weight) exerciseHistory[ex.name].lastWeight = ex.weight;
            });
            
            saveData();
            playDingSound();
            
            // Celebrate completion
            celebrateWorkoutCompletion();
            
            resetWorkout();
            
            const messages = [
                'Amazing work! You crushed that workout!',
                'Beast mode activated! Great job!',
                'You\'re on fire! Keep up the momentum!',
                'Workout complete! You\'re a champion!',
                'Incredible effort! You\'re getting stronger!',
                'Victory! Another workout in the books!'
            ];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            
            showTab('profile');
            setTimeout(() => {
                showNotification(randomMessage + ` Time: ${formatTime(timer)} • Calories: ${completedWorkout.calories} • Streak: ${userStats.streak} day${userStats.streak > 1 ? 's' : ''}`, 'success');
            }, 500);
        }

        function confirmEndWorkout() {
            if (confirm('Are you sure you want to end this workout? Your progress will not be saved.')) {
                endWorkout();
            }
        }

        function endWorkout() {
            resetWorkout();
            showTab('home');
        }

        function addRestTime() {
            restTimer += 30;
            updateRestTimerDisplay();
        }

        function showWorkoutSettings() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'workoutSettingsModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Workout Settings</h3>
                        <button class="close-btn" onclick="closeModal('workoutSettingsModal')">&times;</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Auto-advance exercises</label>
                        <select id="auto-advance" class="form-select">
                            <option value="true" ${!manualSkip ? 'selected' : ''}>Enabled</option>
                            <option value="false" ${manualSkip ? 'selected' : ''}>Disabled</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Sound notifications</label>
                        <select id="sound-notifications" class="form-select">
                            <option value="true" selected>Enabled</option>
                            <option value="false">Disabled</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Voice announcements</label>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary" onclick="playDingSound()" style="flex: 1;">Test Sound</button>
                            <button class="btn btn-secondary" onclick="testVoices()" style="flex: 1;">Test Voice</button>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="saveWorkoutSettings()">Save Settings</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function saveWorkoutSettings() {
            const autoAdvance = document.getElementById('auto-advance').value === 'true';
            manualSkip = !autoAdvance;
            
            closeModal('workoutSettingsModal');
            showNotification('Settings saved!');
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: calc(20px + env(safe-area-inset-top, 0px));
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? 'linear-gradient(135deg, #22c55e, #16a34a)' : 'linear-gradient(135deg, #ef4444, #dc2626)'};
                color: white;
                padding: 12px 24px;
                border-radius: 12px;
                font-weight: 600;
                z-index: 1000;
                animation: slideDown 0.3s ease;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            `;
            notification.textContent = message;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                    to { opacity: 1; transform: translateX(-50%) translateY(0); }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideDown 0.3s ease reverse';
                setTimeout(() => {
                    notification.remove();
                    style.remove();
                }, 300);
            }, 2000);
        }

        function resetWorkout() {
            currentWorkout = null;
            workoutInProgress = false;
            currentExercise = 0;
            currentSet = 1;
            timer = 0;
            exerciseTimer = 0;
            exerciseTimeLimit = 0;
            isTimerRunning = false;
            isResting = false;
            restTimer = 0;
            manualSkip = false;
            
            // Reset superset state
            isInSuperset = false;
            supersetPhase = 'main';
            
            // Clear the timer interval
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Restart the timer loop for future workouts
            startTimerLoop();
            
            // Cancel any ongoing speech
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
            }
            
            releaseWakeLock();
            
            document.querySelector('.nav').classList.remove('hidden');
            document.querySelector('.content').classList.remove('nav-hidden');
            
            const existingRest = document.getElementById('restScreen');
            if (existingRest) {
                existingRest.remove();
            }
        }

        function deleteWorkout(id) {
            if (confirm('Delete this workout?')) {
                customWorkouts = customWorkouts.filter(w => w.id !== id);
                saveData();
                showHomeTab();
            }
        }

        function editWorkout(id) {
            const allWorkouts = [...workouts, ...customWorkouts];
            const workout = allWorkouts.find(w => w.id === id);
            if (!workout) return;

            if (!workout.custom && !workout.aiGenerated) {
                showNotification('You can only edit custom and AI-generated workouts.');
                return;
            }

            showEditWorkoutModal(workout);
        }

        // Superset toggle function
        function toggleSuperset(checkbox) {
            const supersetPartner = checkbox.closest('.exercise-item').querySelector('.superset-partner');
            if (checkbox.checked) {
                supersetPartner.style.display = 'block';
            } else {
                supersetPartner.style.display = 'none';
                supersetPartner.querySelector('.superset-partner-input').value = '';
            }
        }

        // Enhanced AI Workout Generation with intelligent exercise selection
        function generateAIWorkout(preferences) {
            const exerciseCount = preferences.exerciseCount || Math.max(4, Math.min(8, Math.floor(preferences.duration / 5)));
            
            // Validate inputs
            if (!preferences.equipment || preferences.equipment.length === 0) {
                preferences.equipment = ['Bodyweight'];
            }
            
            if (!preferences.muscleGroups || preferences.muscleGroups.length === 0) {
                preferences.muscleGroups = ['Full Body'];
            }
            
            console.log('AI Workout Generation:', preferences);
            
            // Exercise classification for intelligent selection
            const exerciseClassification = {
                compound: {
                    'Bodyweight': ['Burpees', 'Mountain Climbers', 'Push-ups', 'Squats', 'Pull-ups'],
                    'Dumbbells': ['Thrusters', 'Dumbbell Bench Press', 'Bent-over Rows', 'Dumbbell Squats'],
                    'Barbell': ['Deadlifts', 'Squats', 'Bench Press', 'Bent-over Rows'],
                    'Kettlebells': ['Kettlebell Swings', 'Turkish Get-ups', 'Goblet Squats']
                },
                isolation: {
                    'Bodyweight': ['Bicycle Crunches', 'Leg Raises', 'Tricep Dips', 'Calf Raises'],
                    'Dumbbells': ['Bicep Curls', 'Lateral Raises', 'Tricep Extensions', 'Dumbbell Flyes'],
                    'Barbell': ['Barbell Curls', 'Skull Crushers', 'Upright Rows'],
                    'Kettlebells': ['Kettlebell Curls', 'Kettlebell Windmills']
                }
            };
            
            // Get available exercises based on equipment and muscle groups
            let availableExercises = [];
            let compoundExercises = [];
            let isolationExercises = [];
            
            // Expand compound muscle groups
            function expandMuscleGroups(muscleGroups) {
                const expanded = [];
                muscleGroups.forEach(muscle => {
                    switch(muscle) {
                        case 'Push (Chest/Shoulders/Triceps)':
                            expanded.push('Chest', 'Shoulders', 'Arms', 'Triceps');
                            break;
                        case 'Pull (Back/Biceps)':
                            expanded.push('Back', 'Arms', 'Biceps');
                            break;
                        case 'Upper Body':
                            expanded.push('Upper Body', 'Chest', 'Back', 'Shoulders', 'Arms');
                            break;
                        case 'Lower Body':
                            expanded.push('Lower Body', 'Legs', 'Glutes', 'Quadriceps', 'Hamstrings');
                            break;
                        default:
                            expanded.push(muscle);
                    }
                });
                return [...new Set(expanded)];
            }
            
            const expandedMuscleGroups = expandMuscleGroups(preferences.muscleGroups);
            
            // Collect exercises from selected equipment
            preferences.equipment.forEach(equipment => {
                if (equipmentExerciseDatabase[equipment]) {
                    expandedMuscleGroups.forEach(muscle => {
                        if (equipmentExerciseDatabase[equipment][muscle]) {
                            const muscleExercises = equipmentExerciseDatabase[equipment][muscle];
                            availableExercises.push(...muscleExercises);
                            
                            // Classify exercises
                            muscleExercises.forEach(exercise => {
                                if (exerciseClassification.compound[equipment]?.includes(exercise)) {
                                    compoundExercises.push(exercise);
                                } else {
                                    isolationExercises.push(exercise);
                                }
                            });
                        }
                    });
                }
            });
            
            // Remove duplicates
            availableExercises = [...new Set(availableExercises)];
            compoundExercises = [...new Set(compoundExercises)];
            isolationExercises = [...new Set(isolationExercises)];
            
            console.log('Available exercises:', availableExercises.length);
            console.log('Compound exercises:', compoundExercises.length);
            console.log('Isolation exercises:', isolationExercises.length);
            
            // Ensure minimum exercises available
            if (availableExercises.length < exerciseCount) {
                // Add bodyweight fallback
                Object.values(equipmentExerciseDatabase['Bodyweight']).forEach(muscleExercises => {
                    availableExercises.push(...muscleExercises);
                });
                availableExercises = [...new Set(availableExercises)];
                
                if (availableExercises.length < exerciseCount) {
                    throw new Error('Insufficient exercises available for selected criteria');
                }
            }
            
            // Intelligent exercise selection based on workout type and preferences
            const selectedExercises = [];
            
            // Determine exercise distribution based on workout type
            let compoundRatio = 0.6; // Default 60% compound, 40% isolation
            
            switch(preferences.type) {
                case 'Strength Training':
                case 'Powerlifting':
                case 'Functional Training':
                    compoundRatio = 0.8; // 80% compound
                    break;
                case 'Bodybuilding':
                    compoundRatio = 0.5; // 50% compound
                    break;
                case 'HIIT':
                case 'CrossFit':
                    compoundRatio = 0.9; // 90% compound
                    break;
                case 'Circuit Training':
                    compoundRatio = 0.7; // 70% compound
                    break;
            }
            
            const compoundCount = Math.floor(exerciseCount * compoundRatio);
            const isolationCount = exerciseCount - compoundCount;
            
            console.log(`Target: ${compoundCount} compound, ${isolationCount} isolation exercises`);
            
            // Select compound exercises first (they should come early in workout)
            const shuffledCompound = [...compoundExercises].sort(() => Math.random() - 0.5);
            for (let i = 0; i < Math.min(compoundCount, shuffledCompound.length); i++) {
                selectedExercises.push(shuffledCompound[i]);
            }
            
            // Fill remaining slots with isolation exercises
            const remainingSlots = exerciseCount - selectedExercises.length;
            const availableIsolation = isolationExercises.filter(ex => !selectedExercises.includes(ex));
            const shuffledIsolation = availableIsolation.sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < Math.min(remainingSlots, shuffledIsolation.length); i++) {
                selectedExercises.push(shuffledIsolation[i]);
            }
            
            // If still need more exercises, fill from any remaining available exercises
            if (selectedExercises.length < exerciseCount) {
                const remaining = availableExercises.filter(ex => !selectedExercises.includes(ex));
                const shuffledRemaining = remaining.sort(() => Math.random() - 0.5);
                
                while (selectedExercises.length < exerciseCount && shuffledRemaining.length > 0) {
                    selectedExercises.push(shuffledRemaining.pop());
                }
            }
            
            console.log('Final selected exercises:', selectedExercises);
            
            // Create workout structure
            const exercises = selectedExercises.map((exerciseName, index) => {
                return createIntelligentExercise(exerciseName, preferences, index, selectedExercises.length);
            });
            
            // Calculate workout details
            const calories = calculateCalories(preferences.type, preferences.duration, preferences.difficulty);
            const muscleGroupName = preferences.muscleGroups[0] || 'Full Body';
            
            const workout = {
                id: Date.now(),
                name: generateWorkoutName(preferences),
                type: preferences.type,
                duration: preferences.duration,
                difficulty: preferences.difficulty,
                equipment: preferences.equipment,
                calories,
                exercises,
                custom: true,
                aiGenerated: true,
                muscleGroups: preferences.muscleGroups
            };
            
            console.log('Generated workout:', workout);
            return workout;
        }

        // Generate intelligent workout names
        function generateWorkoutName(preferences) {
            const typeAdjectives = {
                'Strength Training': ['Power', 'Strong', 'Iron', 'Solid'],
                'HIIT': ['Intense', 'Blazing', 'Explosive', 'Fire'],
                'Cardio': ['Endurance', 'Cardio', 'Heart', 'Stamina'],
                'Bodybuilding': ['Muscle', 'Hypertrophy', 'Mass', 'Pump'],
                'CrossFit': ['WOD', 'Elite', 'Functional', 'Athletic'],
                'Functional Training': ['Functional', 'Movement', 'Dynamic', 'Real'],
                'Circuit Training': ['Circuit', 'Flow', 'Continuous', 'Chain']
            };
            
            const muscleNames = {
                'Full Body': 'Total Body',
                'Upper Body': 'Upper',
                'Lower Body': 'Lower',
                'Push (Chest/Shoulders/Triceps)': 'Push',
                'Pull (Back/Biceps)': 'Pull',
                'Core/Abs': 'Core'
            };
            
            const adjective = typeAdjectives[preferences.type]?.[Math.floor(Math.random() * typeAdjectives[preferences.type].length)] || 'AI';
            const muscleGroup = muscleNames[preferences.muscleGroups[0]] || preferences.muscleGroups[0] || 'Total';
            const equipment = preferences.equipment[0] === 'Bodyweight' ? 'Bodyweight' : preferences.equipment[0];
            
            return `${adjective} ${muscleGroup} ${equipment}`;
        }

        // Create intelligent exercise parameters
        function createIntelligentExercise(exerciseName, preferences, exerciseIndex, totalExercises) {
            const exercise = { name: exerciseName };
            
            // Get recommended weight
            const recommendedWeight = getRecommendedWeight(exerciseName, null, preferences.type, preferences.difficulty);
            if (recommendedWeight) {
                exercise.weight = recommendedWeight;
            }
            
            // Determine if this is a compound exercise
            const isCompound = isCompoundExercise(exerciseName, preferences.equipment);
            
            // Exercise ordering: compound exercises get longer rest, come first
            const restMultiplier = isCompound ? 1.2 : 0.8;
            const isEarlyExercise = exerciseIndex < totalExercises * 0.3;
            
            switch (preferences.type) {
                case 'HIIT':
                case 'CrossFit':
                    // High intensity with work/rest intervals
                    const workTimes = preferences.difficulty === 'Beginner' ? [20, 30, 30] : 
                                    preferences.difficulty === 'Advanced' ? [45, 60, 90] : [30, 45, 60];
                    exercise.duration = workTimes[Math.floor(Math.random() * workTimes.length)];
                    exercise.rest = Math.max(30, Math.floor(exercise.duration * 0.5 * restMultiplier));
                    
                    if (isCompound) {
                        exercise.reps = preferences.difficulty === 'Beginner' ? '8-12' : 
                                    preferences.difficulty === 'Advanced' ? '15-20' : '10-15';
                    }
                    break;
                    
                case 'Strength Training':
                case 'Powerlifting':
                    // Strength-focused with progressive sets/reps
                    const strengthProgression = {
                        'Beginner': { sets: [2, 3], reps: ['8-12', '6-10'], rest: [60, 90] },
                        'Intermediate': { sets: [3, 4], reps: ['6-8', '5-6'], rest: [90, 120] },
                        'Advanced': { sets: [4, 5], reps: ['3-5', '4-6'], rest: [120, 180] }
                    };
                    
                    const prog = strengthProgression[preferences.difficulty];
                    exercise.sets = isCompound ? Math.max(...prog.sets) : Math.min(...prog.sets);
                    exercise.reps = isCompound ? prog.reps[1] : prog.reps[0];
                    exercise.rest = Math.max(30, (isCompound ? Math.max(...prog.rest) : Math.min(...prog.rest)) * restMultiplier);
                    break;
                    
                case 'Bodybuilding':
                    // Volume-focused for hypertrophy
                    exercise.sets = isCompound ? [3, 4][Math.floor(Math.random() * 2)] : [3, 4, 5][Math.floor(Math.random() * 3)];
                    exercise.reps = preferences.difficulty === 'Beginner' ? '8-12' :
                                preferences.difficulty === 'Advanced' ? '12-15' : '10-12';
                    exercise.rest = Math.max(30, Math.floor((isCompound ? 90 : 60) * restMultiplier));
                    break;
                    
                case 'Circuit Training':
                    // Fast-paced with minimal rest
                    exercise.duration = [30, 45][Math.floor(Math.random() * 2)];
                    exercise.rest = Math.max(15, Math.floor(30 * restMultiplier));
                    exercise.reps = '12-15';
                    exercise.sets = 1; // Circuits typically single sets
                    break;
                    
                case 'Functional Training':
                    // Movement-based with moderate intensity
                    exercise.sets = [2, 3][Math.floor(Math.random() * 2)];
                    exercise.reps = preferences.difficulty === 'Beginner' ? '8-10' :
                                preferences.difficulty === 'Advanced' ? '12-15' : '10-12';
                    exercise.rest = Math.max(30, Math.floor((isCompound ? 90 : 60) * restMultiplier));
                    break;
                    
                default:
                    // Default parameters
                    exercise.sets = 3;
                    exercise.reps = '10-12';
                    exercise.rest = Math.max(30, Math.floor(60 * restMultiplier));
            }
            
            // Ensure minimum rest time of 30 seconds for safety
            if (exercise.rest < 30) exercise.rest = 30;

            // Cap maximum rest time to prevent extremely long workouts
            if (exercise.rest > 300) exercise.rest = 300;
            
            // Add variety for final exercises (reduce intensity)
            if (exerciseIndex >= totalExercises * 0.8) {
                if (exercise.sets > 2) exercise.sets -= 1;
                if (exercise.rest > 60) exercise.rest = Math.max(30, exercise.rest - 30);
            }

            return exercise;
        }

        // Helper function to determine if exercise is compound
        function isCompoundExercise(exerciseName, equipment) {
            const compoundKeywords = [
                'deadlift', 'squat', 'press', 'row', 'pull-up', 'chin-up', 'thruster',
                'clean', 'snatch', 'burpee', 'mountain climber', 'turkish get-up',
                'swing', 'slam', 'complex', 'man maker'
            ];
            
            const fullBodyExercises = [
                'Burpees', 'Mountain Climbers', 'Thrusters', 'Turkish Get-ups',
                'Man Makers', 'Clean and Press', 'Kettlebell Swings'
            ];
            
            const name = exerciseName.toLowerCase();
            
            // Check if it's explicitly in full body category
            if (fullBodyExercises.some(exercise => exercise.toLowerCase() === name)) {
                return true;
            }
            
            // Check compound keywords
            return compoundKeywords.some(keyword => name.includes(keyword));
        }
        
        function createExerciseFromName(exerciseName, preferences) {
            let exercise = { name: exerciseName };
            
            const recommendedWeight = getRecommendedWeight(exerciseName, null, preferences.type, preferences.difficulty);
            
            switch (preferences.type) {
                case 'HIIT':
                case 'Cardio':
                    exercise.duration = [30, 45, 60][Math.floor(Math.random() * 3)];
                    exercise.rest = Math.max(30, [15, 30][Math.floor(Math.random() * 2)]); // Minimum 30 seconds
                    break;
                case 'Strength Training':
                case 'Powerlifting':
                case 'Bodybuilding':
                case 'Functional Training':
                    const phase = workoutTypeToPhase[preferences.type] || "strength";
                    const phaseData = weightPhases[phase];
                    
                    let setsRepsIndex = 0;
                    if (preferences.difficulty === 'Advanced') setsRepsIndex = phaseData.sets_reps.length - 1;
                    else if (preferences.difficulty === 'Intermediate') setsRepsIndex = Math.floor(phaseData.sets_reps.length / 2);
                    
                    const [sets, reps] = phaseData.sets_reps[setsRepsIndex];
                    exercise.sets = sets;
                    exercise.reps = reps.toString();
                    exercise.rest = Math.max(30, preferences.type === 'Powerlifting' ? 180 : 
                                preferences.type === 'Strength Training' ? 120 : 90); // Minimum 30 seconds
                    
                    if (recommendedWeight) exercise.weight = recommendedWeight;
                    break;
                case 'CrossFit':
                    exercise.duration = [45, 60][Math.floor(Math.random() * 2)];
                    exercise.rest = Math.max(30, [30, 45][Math.floor(Math.random() * 2)]); // Minimum 30 seconds
                    exercise.reps = preferences.difficulty === 'Beginner' ? '8-12' : 
                                preferences.difficulty === 'Advanced' ? '15-20' : '10-15';
                    exercise.sets = 3;
                    if (recommendedWeight) exercise.weight = recommendedWeight;
                    break;
                default:
                    exercise.duration = 45;
                    exercise.rest = Math.max(30, 30); // Minimum 30 seconds
                    exercise.reps = '10-15';
                    exercise.sets = 2;
                    if (recommendedWeight) exercise.weight = recommendedWeight;
            }
            
            return exercise;
        }

        // Sharing functions
        function exportWorkout(workout) {
            try {
                const exportData = {
                    name: workout.name,
                    type: workout.type,
                    duration: workout.duration,
                    difficulty: workout.difficulty,
                    equipment: workout.equipment,
                    calories: workout.calories,
                    exercises: workout.exercises,
                    muscleGroups: workout.muscleGroups,
                    shared: true,
                    sharedAt: new Date().toISOString()
                };
                
                const encoded = btoa(JSON.stringify(exportData));
                return `FITFLOW_${encoded}`;
            } catch (error) {
                console.error('Export error:', error);
                return null;
            }
        }

        function importWorkout(shareCode) {
            try {
                if (!shareCode.startsWith('FITFLOW_')) {
                    throw new Error('Invalid share code format');
                }
                
                const encoded = shareCode.substring(8);
                const decoded = atob(encoded);
                const importData = JSON.parse(decoded);
                
                if (!importData.name || !importData.exercises || !Array.isArray(importData.exercises)) {
                    throw new Error('Invalid workout data');
                }
                
                const newWorkout = {
                    id: Date.now(),
                    name: `${importData.name} (Shared)`,
                    type: importData.type || 'Strength Training',
                    duration: importData.duration || 30,
                    difficulty: importData.difficulty || 'Intermediate',
                    equipment: importData.equipment || ['Bodyweight'],
                    calories: calculateCalories(importData.type || 'Strength Training', importData.duration || 30, importData.difficulty || 'Intermediate'),
                    exercises: importData.exercises,
                    muscleGroups: importData.muscleGroups || ['Full Body'],
                    custom: true,
                    imported: true
                };
                
                customWorkouts.unshift(newWorkout);
                saveData();
                return newWorkout;
            } catch (error) {
                console.error('Import error:', error);
                throw new Error('Invalid or corrupted share code');
            }
        }

        function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('Share code copied to clipboard!');
                }).catch(() => {
                    fallbackCopyToClipboard(text);
                });
            } else {
                fallbackCopyToClipboard(text);
            }
        }

        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showNotification('Share code copied to clipboard!');
            } catch (err) {
                showNotification('Could not copy to clipboard. Please copy the code manually.');
            }
            document.body.removeChild(textArea);
        }

        // Sound effects
        let audioContext = null;

        function playDingSound() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // Resume context if suspended (required for some browsers)
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        // Modal functions
        function showAIWorkoutModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'aiModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>AI Workout Generator</h3>
                        <button class="close-btn" onclick="closeModal('aiModal')">&times;</button>
                    </div>
                    <form id="aiWorkoutForm">
                        <div class="form-group">
                            <label class="form-label">Workout Type</label>
                            <select id="ai-type" class="form-select" required>
                                ${workoutTypes.map(type => `<option value="${type}">${type}</option>`).join('')}
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div class="form-group">
                                <label class="form-label">Duration (min)</label>
                                <input type="number" id="ai-duration" class="form-input" min="5" max="120" value="30" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Exercises</label>
                                <input type="number" id="ai-exercise-count" class="form-input" min="3" max="12" value="6">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Difficulty</label>
                            <select id="ai-difficulty" class="form-select">
                                <option value="Beginner">Beginner</option>
                                <option value="Intermediate" selected>Intermediate</option>
                                <option value="Advanced">Advanced</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Target Muscle Groups</label>
                            <div class="equipment-list">
                                ${muscleGroups.map(muscle => `
                                    <div class="equipment-item">
                                        <input type="checkbox" name="muscleGroups" value="${muscle}" id="ai-muscle-${muscle.replace(/[^a-zA-Z0-9]/g, '')}">
                                        <label for="ai-muscle-${muscle.replace(/[^a-zA-Z0-9]/g, '')}">${muscle}</label>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Available Equipment</label>
                            <div class="equipment-list">
                                ${equipmentOptions.map(equipment => `
                                    <div class="equipment-item">
                                        <input type="checkbox" name="equipment" value="${equipment}" id="ai-${equipment.replace(/[^a-zA-Z0-9]/g, '')}">
                                        <label for="ai-${equipment.replace(/[^a-zA-Z0-9]/g, '')}">${equipment}</label>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <button type="submit" class="btn btn-ai">
                            Generate AI Workout
                        </button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('aiWorkoutForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleAIWorkout();
            });
        }

        function showCreateWorkoutModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'createModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Create Custom Workout</h3>
                        <button class="close-btn" onclick="closeModal('createModal')">&times;</button>
                    </div>
                    <form id="createWorkoutForm">
                        <div class="form-group">
                            <label class="form-label">Workout Name</label>
                            <input type="text" id="workout-name" class="form-input" placeholder="My Custom Workout" required>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div class="form-group">
                                <label class="form-label">Type</label>
                                <select id="workout-type" class="form-select">
                                    ${workoutTypes.map(type => `<option value="${type}">${type}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Difficulty</label>
                                <select id="workout-difficulty" class="form-select">
                                    <option value="Beginner">Beginner</option>
                                    <option value="Intermediate">Intermediate</option>
                                    <option value="Advanced">Advanced</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duration (min)</label>
                            <input type="number" id="workout-duration" class="form-input" min="1" value="30" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Exercises</label>
                            <div id="createExerciseList">
                                <div class="exercise-item">
                                    <div class="drag-handle"></div>
                                    <div style="margin-left: 24px;">
                                        <div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">
                                            <input type="text" placeholder="Exercise name" class="form-input" style="flex: 1;">
                                            <label style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: rgba(255,255,255,0.7); white-space: nowrap;">
                                                <input type="checkbox" class="superset-checkbox" onchange="toggleSuperset(this)">
                                                Superset
                                            </label>
                                        </div>
                                        <div class="superset-partner" style="display: none; margin-bottom: 8px;">
                                            <input type="text" placeholder="Superset partner exercise" class="form-input superset-partner-input">
                                        </div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: auto auto; gap: 8px;">
                                            <div>
                                                <div class="exercise-control-label">Duration(s)</div>
                                                <input type="number" class="form-input" placeholder="sec" style="padding: 6px; font-size: 14px;" value="${exercise.duration || ''}" min="0" max="600">
                                            </div>
                                            <div>
                                                <div class="exercise-control-label">Reps</div>
                                                <input type="text" class="form-input" placeholder="#" style="padding: 6px; font-size: 14px;" value="${exercise.reps || ''}" maxlength="10">
                                            </div>
                                            <div>
                                                <div class="exercise-control-label">Sets</div>
                                                <input type="number" class="form-input" placeholder="#" style="padding: 6px; font-size: 14px;" value="${exercise.sets || ''}" min="1" max="10">
                                            </div>
                                            <div>
                                                <div class="exercise-control-label">Rest(s)</div>
                                                <input type="number" class="form-input" placeholder="sec" style="padding: 6px; font-size: 14px;" value="${exercise.rest || ''}" min="0" max="600">
                                            </div>
                                            <div style="grid-column: span 2;">
                                                <div class="exercise-control-label">Weight</div>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <input type="text" class="form-input" placeholder="lbs" style="padding: 6px; font-size: 14px; flex: 1;" value="${exercise.weight || ''}" maxlength="15">
                                                    <label style="display: flex; align-items: center; gap: 3px; font-size: 10px; color: rgba(255,255,255,0.7); white-space: nowrap;">
                                                        <input type="checkbox" class="superset-checkbox" onchange="toggleSuperset(this)" style="width: 14px; height: 14px; margin: 0;" ${exercise.superset ? 'checked' : ''}>
                                                        SS
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-success" style="margin-top: 12px;" onclick="addCreateExercise()">
                                + Add Exercise
                            </button>
                            <p style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-top: 8px;">
                                💡 Tip: Check "Superset" for arm exercises to perform them back-to-back with minimal rest
                            </p>
                        </div>
                        
                        <button type="submit" class="btn btn-custom">
                            Create Workout
                        </button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            setTimeout(() => {
                setupDragAndDrop(document.getElementById('createExerciseList'));
            }, 100);
            
            document.getElementById('createWorkoutForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleCreateWorkout();
            });
        }

        function showEditWorkoutModal(workout) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'editModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Edit Workout</h3>
                        <button class="close-btn" onclick="closeModal('editModal')">&times;</button>
                    </div>
                    <form id="editWorkoutForm">
                        <div class="form-group">
                            <label class="form-label">Workout Name</label>
                            <input type="text" id="edit-workout-name" class="form-input" value="${workout.name}" required maxlength="50">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div class="form-group">
                                <label class="form-label">Type</label>
                                <select id="edit-workout-type" class="form-select">
                                    ${workoutTypes.map(type => `<option value="${type}" ${type === workout.type ? 'selected' : ''}>${type}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Difficulty</label>
                                <select id="edit-workout-difficulty" class="form-select">
                                    <option value="Beginner" ${workout.difficulty === 'Beginner' ? 'selected' : ''}>Beginner</option>
                                    <option value="Intermediate" ${workout.difficulty === 'Intermediate' ? 'selected' : ''}>Intermediate</option>
                                    <option value="Advanced" ${workout.difficulty === 'Advanced' ? 'selected' : ''}>Advanced</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duration (min)</label>
                            <input type="number" id="edit-workout-duration" class="form-input" min="1" max="180" value="${workout.duration}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Exercises</label>
                            <div id="editExerciseList">
                                ${workout.exercises.map(exercise => `
                                    <div class="exercise-item" draggable="true">
                                        <div class="drag-handle"></div>
                                        <div style="margin-left: 24px;">
                                            <div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">
                                                <input type="text" placeholder="Exercise name" class="form-input" style="flex: 1;" value="${exercise.name}" maxlength="50">
                                                <button type="button" onclick="this.parentElement.parentElement.parentElement.remove(); setTimeout(() => setupDragAndDrop(document.getElementById('editExerciseList')), 50);" 
                                                        class="btn btn-danger" style="width: auto; padding: 8px 12px;">
                                                    Remove
                                                </button>
                                            </div>
                                            <div class="superset-partner" style="display: ${exercise.superset ? 'block' : 'none'}; margin-bottom: 8px;">
                                                <input type="text" placeholder="Superset partner exercise" class="form-input superset-partner-input" maxlength="50" value="${exercise.superset ? exercise.superset.name : ''}">
                                            </div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr auto; gap: 4px;">
                                                <div>
                                                    <div class="exercise-control-label">Duration(s)</div>
                                                    <input type="number" class="form-input" placeholder="sec" style="padding: 6px; font-size: 14px;" value="${exercise.duration || ''}" min="0" max="600">
                                                </div>
                                                <div>
                                                    <div class="exercise-control-label">Reps</div>
                                                    <input type="text" class="form-input" placeholder="#" style="padding: 6px; font-size: 14px;" value="${exercise.reps || ''}" maxlength="10">
                                                </div>
                                                <div>
                                                    <div class="exercise-control-label">Sets</div>
                                                    <input type="number" class="form-input" placeholder="#" style="padding: 6px; font-size: 14px;" value="${exercise.sets || ''}" min="1" max="10">
                                                </div>
                                                <div>
                                                    <div class="exercise-control-label">Rest(s)</div>
                                                    <input type="number" class="form-input" placeholder="sec" style="padding: 6px; font-size: 14px;" value="${exercise.rest || ''}" min="0" max="600">
                                                </div>
                                                <div>
                                                    <div class="exercise-control-label">Weight</div>
                                                    <input type="text" class="form-input" placeholder="lbs" style="padding: 6px; font-size: 14px;" value="${exercise.weight || ''}" maxlength="15">
                                                </div>
                                                <div style="display: flex; align-items: end; padding-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; gap: 2px; font-size: 10px; color: rgba(255,255,255,0.7); white-space: nowrap;">
                                                        <input type="checkbox" class="superset-checkbox" onchange="toggleSuperset(this)" style="width: 12px; height: 12px; margin: 0;" ${exercise.superset ? 'checked' : ''}>
                                                        SS
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <button type="button" class="btn btn-success" style="margin-top: 12px;" onclick="addEditExercise()">
                                + Add Exercise
                            </button>
                            <p style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-top: 8px;">
                                💡 Tip: Drag exercises to reorder. Check "SS" (Superset) to add a partner exercise.
                            </p>
                        </div>
                        
                        <button type="submit" class="btn btn-edit">
                            Save Changes
                        </button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            setTimeout(() => {
                setupDragAndDrop(document.getElementById('editExerciseList'));
            }, 100);
            
            document.getElementById('editWorkoutForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleEditWorkout(workout.id);
            });
        }

        function addEditExercise() {
            const exerciseList = document.getElementById('editExerciseList');
            const newExercise = document.createElement('div');
            newExercise.className = 'exercise-item';
            newExercise.draggable = true;
            newExercise.innerHTML = `
                <div class="drag-handle"></div>
                <div style="margin-left: 24px;">
                    <div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">
                        <input type="text" placeholder="Exercise name" class="form-input" style="flex: 1;" maxlength="50">
                        <button type="button" onclick="this.parentElement.parentElement.parentElement.remove(); setTimeout(() => setupDragAndDrop(document.getElementById('editExerciseList')), 50);" 
                                class="btn btn-danger" style="width: auto; padding: 8px 12px;">
                            Remove
                        </button>
                    </div>
                    <div class="superset-partner" style="display: none; margin-bottom: 8px;">
                        <input type="text" placeholder="Superset partner exercise" class="form-input superset-partner-input" maxlength="50">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr auto; gap: 4px;">
                        <div>
                            <div class="exercise-control-label">Duration(s)</div>
                            <input type="number" class="form-input" placeholder="sec" style="padding: 6px; font-size: 14px;" min="0" max="600">
                        </div>
                        <div>
                            <div class="exercise-control-label">Reps</div>
                            <input type="text" class="form-input" placeholder="#" style="padding: 6px; font-size: 14px;" maxlength="10">
                        </div>
                        <div>
                            <div class="exercise-control-label">Sets</div>
                            <input type="number" class="form-input" placeholder="#" style="padding: 6px; font-size: 14px;" min="1" max="10">
                        </div>
                        <div>
                            <div class="exercise-control-label">Rest(s)</div>
                            <input type="number" class="form-input" placeholder="sec" style="padding: 6px; font-size: 14px;" min="0" max="600">
                        </div>
                        <div>
                            <div class="exercise-control-label">Weight</div>
                            <input type="text" class="form-input" placeholder="lbs" style="padding: 6px; font-size: 14px;" maxlength="15">
                        </div>
                        <div style="display: flex; align-items: end; padding-bottom: 6px;">
                            <label style="display: flex; align-items: center; gap: 2px; font-size: 10px; color: rgba(255,255,255,0.7); white-space: nowrap;">
                                <input type="checkbox" class="superset-checkbox" onchange="toggleSuperset(this)" style="width: 12px; height: 12px; margin: 0;">
                                SS
                            </label>
                        </div>
                    </div>
                </div>
            `;
            exerciseList.appendChild(newExercise);
            setupDragAndDrop(exerciseList);
        }

        function addCreateExercise() {
            const exerciseList = document.getElementById('createExerciseList');
            const newExercise = document.createElement('div');
            newExercise.className = 'exercise-item';
            newExercise.innerHTML = `
                <div style="margin-left: 0px;">
                    <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                        <input type="text" placeholder="Exercise name" class="form-input" style="flex: 1;">
                        <button type="button" onclick="this.parentElement.parentElement.parentElement.remove();" 
                                class="btn btn-danger" style="width: auto; padding: 8px 12px;">
                            Remove
                        </button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(65px, 1fr)); gap: 4px;">
                        <div>
                            <div class="exercise-control-label">Duration(s)</div>
                            <input type="number" class="form-input" placeholder="sec(s)" style="padding: 6px; font-size: 14px;">
                        </div>
                        <div>
                            <div class="exercise-control-label">Reps</div>
                            <input type="text" class="form-input" placeholder="#" style="padding: 6px; font-size: 14px;">
                        </div>
                        <div>
                            <div class="exercise-control-label">Sets</div>
                            <input type="number" class="form-input" placeholder="#" style="padding: 6px; font-size: 14px;">
                        </div>
                        <div>
                            <div class="exercise-control-label">Rest(s)</div>
                            <input type="number" class="form-input" placeholder="sec(s)" style="padding: 6px; font-size: 14px;">
                        </div>
                        <div>
                            <div class="exercise-control-label">Weight</div>
                            <input type="text" class="form-input" placeholder="lbs" style="padding: 6px; font-size: 14px;">
                        </div>
                    </div>
                </div>
            `;
            exerciseList.appendChild(newExercise);
        }

        function showWorkoutDetails(id) {
            const allWorkouts = [...workouts, ...customWorkouts];
            const workout = allWorkouts.find(w => w.id === id);
            if (!workout) return;

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'detailsModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${workout.name}</h3>
                        <button class="close-btn" onclick="closeModal('detailsModal')">&times;</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                        <div class="detail-card">
                            <strong>${workout.type}</strong><br>
                            <span style="font-size: 12px;">Type</span>
                        </div>
                        <div class="detail-card">
                            <strong>${workout.duration} min</strong><br>
                            <span style="font-size: 12px;">Duration</span>
                        </div>
                        <div class="detail-card">
                            <strong>${workout.difficulty}</strong><br>
                            <span style="font-size: 12px;">Level</span>
                        </div>
                        <div class="detail-card">
                            <strong>~${workout.calories}</strong><br>
                            <span style="font-size: 12px;">Calories</span>
                        </div>
                    </div>
                    
                    <h4 style="margin-bottom: 12px;">Exercises (${workout.exercises.length})</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${workout.exercises.map((exercise, index) => `
                            <div class="exercise-item">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <strong>${index + 1}. ${exercise.name}</strong>
                                </div>
                                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                    ${exercise.duration ? `<span style="background: rgba(102, 126, 234, 0.2); color: #667eea; padding: 4px 8px; border-radius: 6px; font-size: 12px;">${exercise.duration}s</span>` : ''}
                                    ${exercise.reps ? `<span style="background: rgba(34, 197, 94, 0.2); color: #22c55e; padding: 4px 8px; border-radius: 6px; font-size: 12px;">${exercise.reps} reps</span>` : ''}
                                    ${exercise.sets ? `<span style="background: rgba(168, 85, 247, 0.2); color: #a855f7; padding: 4px 8px; border-radius: 6px; font-size: 12px;">${exercise.sets} sets</span>` : ''}
                                    ${exercise.rest ? `<span style="background: rgba(245, 158, 11, 0.2); color: #f59e0b; padding: 4px 8px; border-radius: 6px; font-size: 12px;">${exercise.rest}s rest</span>` : ''}
                                    ${exercise.weight ? `<span style="background: rgba(236, 72, 153, 0.2); color: #ec4899; padding: 4px 8px; border-radius: 6px; font-size: 12px;">${exercise.weight} lbs</span>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button class="btn btn-success" style="margin-top: 20px;" onclick="startWorkout(${workout.id}); closeModal('detailsModal');">
                        Start Workout
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function showShareModal(workoutId) {
            const allWorkouts = [...workouts, ...customWorkouts];
            const workout = allWorkouts.find(w => w.id === workoutId);
            if (!workout) return;

            if (!workout.custom && !workout.aiGenerated) {
                showNotification('Only custom and AI-generated workouts can be shared.');
                return;
            }

            const shareCode = exportWorkout(workout);
            if (!shareCode) {
                showNotification('Failed to generate share code.');
                return;
            }

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'shareModal';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Share Workout</h3>
                        <button class="close-btn" onclick="closeModal('shareModal')">&times;</button>
                    </div>
                    
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 16px;">
                        Share this workout with friends by copying the code below:
                    </p>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                color: #ffffff; 
                                padding: 16px; 
                                border-radius: 12px; 
                                margin-bottom: 16px;">
                        <h4 style="margin-bottom: 8px;">${workout.name}</h4>
                        <p style="opacity: 0.8; font-size: 14px;">
                            ${workout.type} • ${workout.duration} min • ${workout.exercises.length} exercises
                        </p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Share Code</label>
                        <div style="background: rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 12px; font-family: 'Courier New', monospace; font-size: 14px; word-break: break-all; margin: 12px 0; backdrop-filter: blur(10px); cursor: pointer;" onclick="selectText(this)">
                            ${shareCode}
                        </div>
                        <p style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-top: 8px;">
                            Click on the code to select it, then copy and share with others
                        </p>
                    </div>
                    
                    <button class="btn btn-share" onclick="copyToClipboard('${shareCode}')">
                        Copy to Clipboard
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function showImportModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'importModal';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Import Workout</h3>
                        <button class="close-btn" onclick="closeModal('importModal')">&times;</button>
                    </div>
                    
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 16px;">
                        Paste a share code from another FitFlow user to import their workout:
                    </p>
                    
                    <form id="importForm">
                        <div class="form-group">
                            <label class="form-label">Share Code</label>
                            <textarea id="share-code-input" 
                                    class="form-textarea" 
                                    placeholder="Paste share code here (starts with FITFLOW_)"
                                    required></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-success">
                            Import Workout
                        </button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('importForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleImportWorkout();
            });
        }

        function showBodyModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'bodyModal';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Body Measurements</h3>
                        <button class="close-btn" onclick="closeModal('bodyModal')">&times;</button>
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px; font-size: 14px;">
                        Your measurements are used to calculate accurate calorie burn estimates using the METS formula.
                    </p>
                    <form id="bodyForm">
                        <div class="form-group">
                            <label class="form-label">Weight (lbs)</label>
                            <input type="number" 
                                   id="body-weight" 
                                   class="form-input" 
                                   placeholder="Enter your weight in pounds"
                                   value="${userBody.weight || ''}"
                                   min="50" max="500" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Height (feet & inches)</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <input type="number" 
                                       id="body-height-feet" 
                                       class="form-input" 
                                       placeholder="Feet"
                                       value="${userBody.height > 0 ? Math.floor(userBody.height/12) : ''}"
                                       min="3" max="8">
                                <input type="number" 
                                       id="body-height-inches" 
                                       class="form-input" 
                                       placeholder="Inches"
                                       value="${userBody.height > 0 ? userBody.height%12 : ''}"
                                       min="0" max="11">
                            </div>
                        </div>
                        <button type="submit" class="btn">Save Measurements</button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('bodyForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleBodyUpdate();
            });
        }

        function showWeightModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'weightModal';
            
            const commonExercises = [
                {name: 'Bench Press', unit: 'lbs'}, 
                {name: 'Squats', unit: 'lbs'}, 
                {name: 'Deadlifts', unit: 'lbs'}, 
                {name: 'Overhead Press', unit: 'lbs'},
                {name: 'Bent-over Rows', unit: 'lbs'}, 
                {name: 'Bicep Curls', unit: 'lbs'}, 
                {name: 'Dumbbell Bench Press', unit: 'lbs per arm'}, 
                {name: 'Leg Press', unit: 'lbs'}
            ];
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Update Max Weights</h3>
                        <button class="close-btn" onclick="closeModal('weightModal')">&times;</button>
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px; font-size: 14px;">
                        Enter your one-rep max (1RM) for each exercise. AI workouts will use sport-specific percentages.
                    </p>
                    <form id="weightForm">
                        ${commonExercises.map(exercise => `
                            <div class="form-group">
                                <label class="form-label">${exercise.name} (${exercise.unit})</label>
                                <input type="number" 
                                       id="weight-${exercise.name.replace(/\s+/g, '-')}" 
                                       class="form-input" 
                                       placeholder="Enter max weight ${exercise.unit === 'lbs per arm' ? 'per arm' : ''}"
                                       value="${userWeights[exercise.name] || ''}"
                                       min="0">
                            </div>
                        `).join('')}
                        <button type="submit" class="btn">Save Weights</button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('weightForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleWeightUpdate();
            });
        }

        function showProgressiveOverloadModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'progressiveModal';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Progressive Overload Settings</h3>
                        <button class="close-btn" onclick="closeModal('progressiveModal')">&times;</button>
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px; font-size: 14px;">
                        Automatically increase your weights over time to build strength progressively.
                    </p>
                    <form id="progressiveForm">
                        <div class="form-group">
                            <label class="form-label">Enable Progressive Overload</label>
                            <select id="progressive-enabled" class="form-select">
                                <option value="true" ${progressiveOverload.enabled ? 'selected' : ''}>Enabled</option>
                                <option value="false" ${!progressiveOverload.enabled ? 'selected' : ''}>Disabled</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Increase Percentage</label>
                            <select id="progressive-percentage" class="form-select">
                                <option value="2.5" ${progressiveOverload.percentage === 2.5 ? 'selected' : ''}>2.5% (Conservative)</option>
                                <option value="5" ${progressiveOverload.percentage === 5 ? 'selected' : ''}>5% (Standard)</option>
                                <option value="10" ${progressiveOverload.percentage === 10 ? 'selected' : ''}>10% (Aggressive)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Frequency (weeks)</label>
                            <select id="progressive-weeks" class="form-select">
                                <option value="1" ${progressiveOverload.weeks === 1 ? 'selected' : ''}>Every week</option>
                                <option value="2" ${progressiveOverload.weeks === 2 ? 'selected' : ''}>Every 2 weeks</option>
                                <option value="4" ${progressiveOverload.weeks === 4 ? 'selected' : ''}>Every 4 weeks</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success">Save Settings</button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('progressiveForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleProgressiveOverloadUpdate();
            });
        }

        // Modal handlers
        function handleAIWorkout() {
            try {
                const formData = new FormData(document.getElementById('aiWorkoutForm'));
                const selectedEquipment = Array.from(formData.getAll('equipment'));
                const selectedMuscleGroups = Array.from(formData.getAll('muscleGroups'));
                
                const preferences = {
                    type: document.getElementById('ai-type').value,
                    equipment: selectedEquipment.length > 0 ? selectedEquipment : ['Bodyweight'],
                    muscleGroups: selectedMuscleGroups,
                    duration: parseInt(document.getElementById('ai-duration').value),
                    exerciseCount: parseInt(document.getElementById('ai-exercise-count').value),
                    difficulty: document.getElementById('ai-difficulty').value
                };

                // Enhanced validation
                if (!preferences.type) {
                    showNotification('Please select a workout type.', 'error');
                    return;
                }
                
                if (!preferences.duration || preferences.duration < 5 || preferences.duration > 120) {
                    showNotification('Duration must be between 5 and 120 minutes.', 'error');
                    return;
                }
                
                if (!preferences.exerciseCount || preferences.exerciseCount < 3 || preferences.exerciseCount > 12) {
                    showNotification('Exercise count must be between 3 and 12.', 'error');
                    return;
                }

                if (selectedMuscleGroups.length === 0) {
                    showNotification('Please select at least one muscle group.', 'error');
                    return;
                }

                // Generate workout with comprehensive error handling
                let generatedWorkout;
                try {
                    generatedWorkout = generateAIWorkout(preferences);
                } catch (error) {
                    console.error('AI Generation Error:', error);
                    if (error.message.includes('Insufficient exercises')) {
                        showNotification('Not enough exercises available for your selection. Try choosing more equipment or different muscle groups.', 'error');
                    } else {
                        showNotification('Failed to generate workout. Please try different settings.', 'error');
                    }
                    return;
                }
                
                if (!generatedWorkout || !generatedWorkout.exercises || generatedWorkout.exercises.length === 0) {
                    showNotification('Failed to generate workout. Please try different settings.', 'error');
                    return;
                }
                
                customWorkouts.unshift(generatedWorkout);
                saveData();
                closeModal('aiModal');
                showHomeTab();
                showNotification(`AI Workout "${generatedWorkout.name}" generated successfully!`);
                
            } catch (error) {
                console.error('AI Workout handler failed:', error);
                showNotification('An unexpected error occurred. Please try again.', 'error');
            }
        }

        let isInSuperset = false;
        let supersetPhase = 'main'; // 'main' or 'partner'   

        function handleCreateWorkout() {
            try {
                const workoutName = document.getElementById('workout-name').value.trim();
                const workoutType = document.getElementById('workout-type').value;
                const workoutDifficulty = document.getElementById('workout-difficulty').value;
                const workoutDuration = parseInt(document.getElementById('workout-duration').value);
                
                // Enhanced validation
                if (!workoutName) {
                    showNotification('Please enter a workout name.', 'error');
                    return;
                }
                
                if (workoutName.length < 3) {
                    showNotification('Workout name must be at least 3 characters long.', 'error');
                    return;
                }
                
                if (workoutName.length > 50) {
                    showNotification('Workout name must be 50 characters or less.', 'error');
                    return;
                }
                
                // Check for potentially harmful content
                if (/<script|javascript:|data:|vbscript:|onload|onerror/i.test(workoutName)) {
                    showNotification('Invalid characters in workout name.', 'error');
                    return;
                }
                
                if (!workoutDuration || workoutDuration < 1 || workoutDuration > 180) {
                    showNotification('Duration must be between 1 and 180 minutes.', 'error');
                    return;
                }
                
                // Check if name already exists
                const allWorkouts = [...workouts, ...customWorkouts];
                if (allWorkouts.some(w => w.name.toLowerCase() === workoutName.toLowerCase())) {
                    showNotification('A workout with this name already exists.', 'error');
                    return;
                }
                
                const exerciseElements = document.querySelectorAll('#createExerciseList .exercise-item');
                const exercises = [];
                
                let hasValidExercise = false;
                let exerciseCount = 0;
                let validationErrors = [];
                
                exerciseElements.forEach((element, index) => {
                    const inputs = element.querySelectorAll('input');
                    const exerciseName = inputs[0].value.trim();
                    const supersetChecked = element.querySelector('.superset-checkbox') ? element.querySelector('.superset-checkbox').checked : false;
                    const supersetPartner = element.querySelector('.superset-partner-input') ? element.querySelector('.superset-partner-input').value.trim() : '';
                    
                    if (exerciseName) {
                        // Validate exercise name
                        if (exerciseName.length > 50) {
                            validationErrors.push(`Exercise ${index + 1}: Name too long (max 50 characters)`);
                            return;
                        }
                        
                        // Check for harmful content
                        if (/<script|javascript:|data:|vbscript:|onload|onerror/i.test(exerciseName)) {
                            validationErrors.push(`Exercise ${index + 1}: Invalid characters in name`);
                            return;
                        }
                        
                        hasValidExercise = true;
                        exerciseCount++;
                        
                        const exercise = {
                            name: exerciseName
                        };
                        
                        // Validate and set numeric inputs with proper bounds
                        if (inputs[1] && inputs[1].value) {
                            const duration = parseInt(inputs[1].value);
                            if (duration > 0 && duration <= 600) {
                                exercise.duration = duration;
                            } else if (duration > 600) {
                                validationErrors.push(`Exercise ${index + 1}: Duration too long (max 600 seconds)`);
                                return;
                            }
                        }
                        
                        if (inputs[2] && inputs[2].value.trim()) {
                            const reps = inputs[2].value.trim();
                            if (reps.length <= 10) {
                                exercise.reps = reps;
                            } else {
                                validationErrors.push(`Exercise ${index + 1}: Reps field too long`);
                                return;
                            }
                        }
                        
                        if (inputs[3] && inputs[3].value) {
                            const sets = parseInt(inputs[3].value);
                            if (sets > 0 && sets <= 10) {
                                exercise.sets = sets;
                            } else if (sets > 10) {
                                validationErrors.push(`Exercise ${index + 1}: Too many sets (max 10)`);
                                return;
                            }
                        }
                        
                        if (inputs[4] && inputs[4].value) {
                            const rest = parseInt(inputs[4].value);
                            if (rest >= 0 && rest <= 600) {
                                exercise.rest = rest;
                            } else if (rest > 600) {
                                validationErrors.push(`Exercise ${index + 1}: Rest time too long (max 600 seconds)`);
                                return;
                            }
                        }
                        
                        if (inputs[5] && inputs[5].value.trim()) {
                            const weight = inputs[5].value.trim();
                            if (weight.length <= 15) {
                                exercise.weight = weight;
                            } else {
                                validationErrors.push(`Exercise ${index + 1}: Weight field too long`);
                                return;
                            }
                        }
                        
                        // Set defaults if nothing specified
                        if (!exercise.duration && !exercise.reps) {
                            exercise.reps = '10-12';
                        }
                        if (!exercise.sets) exercise.sets = 1;
                        if (exercise.rest === undefined) exercise.rest = 30;
                        
                        // Handle superset as property of main exercise
                        if (supersetChecked && supersetPartner) {
                            if (supersetPartner.length > 50) {
                                validationErrors.push(`Exercise ${index + 1}: Superset partner name too long`);
                                return;
                            }
                            
                            if (/<script|javascript:|data:|vbscript:|onload|onerror/i.test(supersetPartner)) {
                                validationErrors.push(`Exercise ${index + 1}: Invalid characters in superset partner name`);
                                return;
                            }
                            
                            exercise.superset = {
                                name: supersetPartner,
                                reps: exercise.reps,
                                weight: exercise.weight || ''
                            };
                        }
                        
                        exercises.push(exercise);
                    }
                });
                
                // Check for validation errors
                if (validationErrors.length > 0) {
                    showNotification(validationErrors[0], 'error');
                    return;
                }
                
                if (!hasValidExercise) {
                    showNotification('Please add at least one exercise with a name.', 'error');
                    return;
                }
                
                if (exerciseCount > 15) {
                    showNotification('Maximum 15 exercises allowed per workout.', 'error');
                    return;
                }
                
                // Check for duplicate exercise names
                const exerciseNames = exercises.map(ex => ex.name.toLowerCase());
                const duplicates = exerciseNames.filter((name, index) => exerciseNames.indexOf(name) !== index);
                if (duplicates.length > 0) {
                    showNotification('Duplicate exercise names found. Please use unique names.', 'error');
                    return;
                }
                
                const workoutData = {
                    id: Date.now(),
                    name: workoutName,
                    type: workoutType,
                    difficulty: workoutDifficulty,
                    duration: workoutDuration,
                    calories: calculateCalories(workoutType, workoutDuration, workoutDifficulty),
                    equipment: ['Bodyweight'],
                    exercises: exercises,
                    custom: true,
                    muscleGroups: ['Full Body'],
                    createdAt: new Date().toISOString()
                };
                
                customWorkouts.unshift(workoutData);
                saveData();
                closeModal('createModal');
                showHomeTab();
                showNotification(`Custom workout "${workoutData.name}" created successfully!`);
                
            } catch (error) {
                console.error('Create workout failed:', error);
                showNotification('Failed to create workout. Please check your inputs and try again.', 'error');
            }
        }

        function handleEditWorkout(workoutId) {
            try {
                const workoutName = document.getElementById('edit-workout-name').value.trim();
                const workoutType = document.getElementById('edit-workout-type').value;
                const workoutDifficulty = document.getElementById('edit-workout-difficulty').value;
                const workoutDuration = parseInt(document.getElementById('edit-workout-duration').value);
                
                if (!workoutName || !workoutDuration || workoutDuration < 1) {
                    showNotification('Please enter a valid workout name and duration.', 'error');
                    return;
                }
                
                const exerciseElements = document.querySelectorAll('#editExerciseList .exercise-item');
                const exercises = [];
                
                let hasValidExercise = false;
                
                exerciseElements.forEach(element => {
                    const inputs = element.querySelectorAll('input');
                    const exerciseName = inputs[0].value.trim();
                    const supersetChecked = element.querySelector('.superset-checkbox') ? element.querySelector('.superset-checkbox').checked : false;
                    const supersetPartner = element.querySelector('.superset-partner-input') ? element.querySelector('.superset-partner-input').value.trim() : '';
                    
                    if (exerciseName) {
                        hasValidExercise = true;
                        const exercise = {
                            name: exerciseName
                        };
                        
                        if (inputs[1] && inputs[1].value) exercise.duration = parseInt(inputs[1].value);
                        if (inputs[2] && inputs[2].value.trim()) exercise.reps = inputs[2].value.trim();
                        if (inputs[3] && inputs[3].value) exercise.sets = parseInt(inputs[3].value);
                        if (inputs[4] && inputs[4].value) exercise.rest = parseInt(inputs[4].value);
                        if (inputs[5] && inputs[5].value.trim()) exercise.weight = inputs[5].value.trim();
                        
                        if (!exercise.duration && !exercise.reps) {
                            exercise.reps = '10-12';
                        }
                        if (!exercise.sets) exercise.sets = 1;
                        if (!exercise.rest) exercise.rest = 30;
                        
                        // Handle superset as property of main exercise
                        if (supersetChecked && supersetPartner) {
                            exercise.superset = {
                                name: supersetPartner,
                                reps: exercise.reps,
                                weight: exercise.weight || ''
                            };
                        }
                        
                        exercises.push(exercise);
                    }
                });
                
                if (!hasValidExercise) {
                    showNotification('Please add at least one exercise with a name.', 'error');
                    return;
                }
                
                // Find and update the workout
                const workoutIndex = customWorkouts.findIndex(w => w.id === workoutId);
                if (workoutIndex !== -1) {
                    customWorkouts[workoutIndex] = {
                        ...customWorkouts[workoutIndex],
                        name: workoutName,
                        type: workoutType,
                        difficulty: workoutDifficulty,
                        duration: workoutDuration,
                        calories: calculateCalories(workoutType, workoutDuration, workoutDifficulty),
                        exercises: exercises
                    };
                }
                
                saveData();
                closeModal('editModal');
                showHomeTab();
                showNotification(`Workout "${workoutName}" updated successfully!`);
            } catch (error) {
                console.error('Edit workout failed:', error);
                showNotification('Failed to update workout. Please check your inputs and try again.', 'error');
            }
        }

        function handleImportWorkout() {
            const shareCode = document.getElementById('share-code-input').value.trim();
            
            if (!shareCode) {
                showNotification('Please enter a share code.');
                return;
            }
            
            try {
                const importedWorkout = importWorkout(shareCode);
                closeModal('importModal');
                showHomeTab();
                showNotification(`Successfully imported "${importedWorkout.name}"!`);
            } catch (error) {
                showNotification(`Import failed: ${error.message}`);
            }
        }

        function handleBodyUpdate() {
            const weight = parseFloat(document.getElementById('body-weight').value);
            const feet = parseInt(document.getElementById('body-height-feet').value) || 0;
            const inches = parseInt(document.getElementById('body-height-inches').value) || 0;
            
            // Enhanced validation
            if (!weight || weight < 50 || weight > 1000) {
                showNotification('Please enter a valid weight between 50-1000 lbs.', 'error');
                return;
            }
            
            if (feet < 3 || feet > 8 || inches < 0 || inches > 11) {
                showNotification('Please enter a valid height.', 'error');
                return;
            }
            
            userBody.weight = Math.round(weight * 10) / 10; // Round to 1 decimal
            userBody.height = (feet * 12) + inches;
            
            refreshWorkoutData();
            saveData();
            closeModal('bodyModal');
            showProfileTab();
            showNotification('Measurements updated! Workout calories have been recalculated.');
        }

        function handleWeightUpdate() {
            const commonExercises = [
                'Bench Press', 'Squats', 'Deadlifts', 'Overhead Press', 
                'Bent-over Rows', 'Bicep Curls', 'Dumbbell Bench Press', 'Leg Press'
            ];
            
            commonExercises.forEach(exercise => {
                const input = document.getElementById(`weight-${exercise.replace(/\s+/g, '-')}`);
                if (input && input.value) {
                    userWeights[exercise] = parseInt(input.value);
                }
            });
            
            updateAIWorkoutWeights();
            
            saveData();
            closeModal('weightModal');
            showProfileTab();
            showNotification('Weights updated! AI workout weights have been automatically adjusted.');
        }

        function handleProgressiveOverloadUpdate() {
            progressiveOverload = {
                enabled: document.getElementById('progressive-enabled').value === 'true',
                percentage: parseFloat(document.getElementById('progressive-percentage').value),
                weeks: parseInt(document.getElementById('progressive-weeks').value)
            };
            
            saveData();
            closeModal('progressiveModal');
            showProfileTab();
            showNotification('Progressive overload settings updated!');
        }

        function updateAIWorkoutWeights() {
            customWorkouts.forEach(workout => {
                if (workout.aiGenerated) {
                    workout.exercises.forEach(exercise => {
                        const recommendedWeight = getRecommendedWeight(exercise.name, null, workout.type, workout.difficulty);
                        if (recommendedWeight) {
                            exercise.weight = recommendedWeight;
                        }
                    });
                }
            });
        }

        function selectText(element) {
            if (document.selection) {
                const range = document.body.createTextRange();
                range.moveToElementText(element);
                range.select();
            } else if (window.getSelection) {
                const range = document.createRange();
                range.selectNode(element);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                // Clean up any event listeners
                const buttons = modal.querySelectorAll('button');
                buttons.forEach(btn => {
                    btn.onclick = null;
                });
                
                // Clean up form listeners
                const forms = modal.querySelectorAll('form');
                forms.forEach(form => {
                    const newForm = form.cloneNode(true);
                    form.parentNode.replaceChild(newForm, form);
                });
                
                modal.remove();
            }
        }

        // Drag and drop functionality
        function setupDragAndDrop(container) {
            let draggedElement = null;
            let touchTimeout = null;
            let longPressTriggered = false;

            // Clear existing event listeners and setup fresh ones
            container.querySelectorAll('.exercise-item').forEach(item => {
                // Clone element to remove all existing event listeners
                const newItem = item.cloneNode(true);
                item.parentNode.replaceChild(newItem, item);
            });

            // Re-query after cloning and add event listeners to fresh elements
            container.querySelectorAll('.exercise-item').forEach(item => {
                item.draggable = true;
                
                // Add drag event listeners
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                
                // Add touch event listeners for mobile
                item.addEventListener('touchstart', handleTouchStart, { passive: false });
                item.addEventListener('touchmove', handleTouchMove, { passive: false });
                item.addEventListener('touchend', handleTouchEnd);
            });

            function handleDragStart(e) {
                draggedElement = this;
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.outerHTML);
            }

            function handleDragEnd(e) {
                this.classList.remove('dragging');
                container.querySelectorAll('.exercise-item').forEach(item => {
                    item.classList.remove('drag-over');
                });
                draggedElement = null;
            }

            function handleDragOver(e) {
                if (e.preventDefault) {
                    e.preventDefault();
                }
                e.dataTransfer.dropEffect = 'move';
                
                // Remove drag-over from all items first
                container.querySelectorAll('.exercise-item').forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                // Add to current item
                if (this !== draggedElement) {
                    this.classList.add('drag-over');
                }
                return false;
            }

            function handleDrop(e) {
                if (e.stopPropagation) {
                    e.stopPropagation();
                }
                
                if (draggedElement && draggedElement !== this) {
                    // Get parent and sibling references
                    const draggedParent = draggedElement.parentNode;
                    const thisParent = this.parentNode;
                    const draggedNext = draggedElement.nextSibling;
                    const thisNext = this.nextSibling;
                    
                    // Swap the elements
                    if (draggedNext) {
                        draggedParent.insertBefore(this, draggedNext);
                    } else {
                        draggedParent.appendChild(this);
                    }
                    
                    if (thisNext) {
                        thisParent.insertBefore(draggedElement, thisNext);
                    } else {
                        thisParent.appendChild(draggedElement);
                    }
                    
                    // Re-setup drag and drop for the new arrangement
                    setTimeout(() => setupDragAndDrop(container), 100);
                }
                
                this.classList.remove('drag-over');
                return false;
            }

            function handleTouchStart(e) {
                const touch = e.touches[0];
                longPressTriggered = false;
                
                // Clear any existing timeout
                if (touchTimeout) {
                    clearTimeout(touchTimeout);
                }
                
                touchTimeout = setTimeout(() => {
                    longPressTriggered = true;
                    this.style.opacity = '0.5';
                    this.style.transform = 'scale(0.95)';
                    this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.3)';
                    
                    // Haptic feedback if available
                    if ('vibrate' in navigator) {
                        navigator.vibrate(50);
                    }
                }, 500);
            }

            function handleTouchMove(e) {
                if (longPressTriggered) {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                    const targetItem = elementBelow ? elementBelow.closest('.exercise-item') : null;
                    
                    // Remove previous drag-over classes
                    container.querySelectorAll('.exercise-item').forEach(item => {
                        item.classList.remove('drag-over');
                    });
                    
                    if (targetItem && targetItem !== this) {
                        targetItem.classList.add('drag-over');
                    }
                }
            }

            function handleTouchEnd(e) {
                if (touchTimeout) {
                    clearTimeout(touchTimeout);
                    touchTimeout = null;
                }
                
                if (longPressTriggered) {
                    const touch = e.changedTouches[0];
                    const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                    const targetItem = elementBelow ? elementBelow.closest('.exercise-item') : null;
                    
                    if (targetItem && targetItem !== this) {
                        // Perform the swap
                        const thisParent = this.parentNode;
                        const targetParent = targetItem.parentNode;
                        const thisNext = this.nextSibling;
                        const targetNext = targetItem.nextSibling;
                        
                        // Insert elements in swapped positions
                        if (thisNext) {
                            thisParent.insertBefore(targetItem, thisNext);
                        } else {
                            thisParent.appendChild(targetItem);
                        }
                        
                        if (targetNext) {
                            targetParent.insertBefore(this, targetNext);
                        } else {
                            targetParent.appendChild(this);
                        }
                        
                        // Re-setup drag and drop
                        setTimeout(() => setupDragAndDrop(container), 100);
                    }
                    
                    // Reset styles
                    this.style.opacity = '';
                    this.style.transform = '';
                    this.style.boxShadow = '';
                    
                    // Remove drag-over classes
                    container.querySelectorAll('.exercise-item').forEach(item => {
                        item.classList.remove('drag-over');
                    });
                }
                
                longPressTriggered = false;
            }
        }

        function resetProgress() {
            if (confirm('Reset all progress? This will delete all workout history, custom workouts, and settings. This cannot be undone.')) {
                userStats = { totalWorkouts: 0, totalTime: 0, streak: 0 };
                workoutHistory = [];
                customWorkouts = [];
                exerciseHistory = {};
                userWeights = {};
                userBody = { weight: 0, height: 0 };
                progressiveOverload = { enabled: false, percentage: 5, weeks: 2 };
                
                localStorage.removeItem('fitflow-workout-calories');
                localStorage.removeItem('fitflow-workout-minutes');
                localStorage.removeItem('fitflow-workout-date');
                updateWorkoutCaloriesAndMinutes();
                
                saveData();
                showProfileTab();
                showNotification('All progress has been reset. Start fresh with your fitness journey!');
            }
        }

        // Initialize app
        window.addEventListener('load', init);

        // Enhanced mobile interactions
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });

        // Prevent double-tap zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Handle app visibility changes
        document.addEventListener('visibilitychange', function() {
            updateWorkoutCaloriesAndMinutes();
            
            // Pause workout if app goes to background
            if (document.hidden && workoutInProgress && isTimerRunning) {
                isTimerRunning = false;
                showNotification('Workout paused - app in background');
            }
        });

        // Add keyboard shortcuts for workout
        document.addEventListener('keydown', function(e) {
            if (!workoutInProgress) return;
            
            switch(e.key) {
                case ' ': // Spacebar - toggle timer
                    e.preventDefault();
                    if (!isResting) toggleTimer();
                    break;
                case 'Enter': // Enter - complete exercise
                    e.preventDefault();
                    if (!isResting) completeExercise();
                    break;
                case 'Escape': // Escape - end workout
                    e.preventDefault();
                    confirmEndWorkout();
                    break;
                case 'ArrowRight': // Right arrow - next exercise
                    e.preventDefault();
                    if (!isResting) nextExercise();
                    break;
                case 'ArrowLeft': // Left arrow - previous exercise
                    e.preventDefault();
                    if (!isResting) previousExercise();
                    break;
                case 's': // S - skip rest
                    e.preventDefault();
                    if (isResting) skipRest();
                    break;
            }
        });

        // Add swipe gestures for mobile
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        });

        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        });

        function handleSwipe() {
            if (!workoutInProgress || isResting) return;
            
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            const minSwipeDistance = 50;
            
            // Only handle horizontal swipes
            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > minSwipeDistance) {
                if (deltaX > 0 && currentExercise > 0) {
                    // Swipe right - previous exercise
                    previousExercise();
                } else if (deltaX < 0 && currentExercise < currentWorkout.exercises.length - 1) {
                    // Swipe left - next exercise
                    nextExercise();
                }
            }
        }

        // Add haptic feedback for supported devices
        function vibrate(pattern = [100]) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }

        // Enhanced button feedback
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn') ||
                e.target.classList.contains('btn-play') ||
                e.target.classList.contains('nav-item')) {
                vibrate([50]);
            }
        });

        // Improve workout completion with celebration
        function celebrateWorkoutCompletion() {
            // Create confetti effect
            const colors = ['#667eea', '#764ba2', '#22c55e', '#f59e0b', '#ec4899'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    createConfetti(colors[Math.floor(Math.random() * colors.length)]);
                }, i * 20);
            }
            
            // Haptic feedback
            vibrate([200, 100, 200, 100, 200]);
        }

        function createConfetti(color) {
            const confetti = document.createElement('div');
            confetti.style.cssText = `
                position: fixed;
                width: 10px;
                height: 10px;
                background: ${color};
                top: -10px;
                left: ${Math.random() * 100}vw;
                z-index: 1000;
                border-radius: 50%;
                pointer-events: none;
                animation: confettiFall 3s linear forwards;
            `;
            
            document.body.appendChild(confetti);
            
            setTimeout(() => confetti.remove(), 3000);
        }

        // Add confetti animation
        const confettiStyle = document.createElement('style');
        confettiStyle.textContent = `
            @keyframes confettiFall {
                to {
                    transform: translateY(100vh) rotate(720deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(confettiStyle);
    </script>
</body>
</html>
